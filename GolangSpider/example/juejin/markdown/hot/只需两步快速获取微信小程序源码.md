# 只需两步快速获取微信小程序源码 #

第一次在掘金这样高大上的社区写文章，忐忑地敲下我获取小程序源码过程中的经验分享。

最近在学习微信小程序开发，半个月学习下来，很想实战一下踩踩坑，于是就仿写了某个小程序的前端实现，过程一言难尽，差不多两周时间过去了，发现小程序的坑远比想象的要多的多！！在实际练手中，完全是黑盒的，纯靠推测，部分效果在各种尝试后能能做出大致的实现，但是有些细节，实在不知道如何去实现。这种时候，真的很想一窥源码，查看究竟，看看大厂的前端大神们是如何规避了小程序的一些比较奇葩的坑。

于是就想到获取到小程序地源文件，然后尝试对其进行反编译还原为源代码，来作为学习参考。我百度了各种关于小程序地反编译教程，但是感觉都不太适合像我这样地初学小白，踩了挺多坑。在这里把我重新简化好的， **快速地获取一个微信小程序源码** 的方式记录下来。

# 简单聊一下 ` xxxxx.wxapkg` #

**先来想想一个很简单的问题， **小程序的源文件存放在哪** ？**

* 在微信的服务器上。

**普通用户想要直接获取到在微信服务器去获取，肯定是十分困难的，有没有别的办法呢？**

* 简单思考一下我们使用小程序的场景就会明白，当我们点开一个微信小程序的时候，其实是微信已经将它的从服务器上下载到了手机，然后再来运行的。
* 所以我们应该可以从 ` 手机本地` 找到到已经下载过的小程序文件

**那么小程序文件存储在手机的什么位置呢？**

* 这里只以安卓手机为例，毕竟穷逼不曾拥有过苹果手机
* 具体目录位置直接给出：
* ` /data/data/com.tencent.mm/MicroMsg/{{一串32位的16进制字符串名文件夹}}/appbrand/pkg/`
* 在这个目录下，会发现一些 ` xxxxxxx.wxapkg` 类型的文件，这些就是微信小程序的包

**微信小程序的格式就是: `.wxapkg`**

* 

.wxapkg是一个二进制文件，有其自己的一套结构。

* 

[微信小程序源码阅读笔记]( https://link.juejin.im?target=http%3A%2F%2Flrdcq.com%2Fme%2Fread.php%2F66.htm ) lrdcq大神的这篇博文有对.wxapkg的详细介绍，当然你也不可以不看

* 

这里有个 **小坑** ，想要进入到上面这个目录的话，用手机自带的文件管理器是不行的，需要使用到第三方的文件管理器，比如： ` RE文件管理器` ，并且安卓需要取得root权限，苹果手机要求越狱，且 **iphone的越狱难度>>安卓获取root** ，不管越狱还是root，这都太费劲，当然有能力的同学可以直接从手机上来操作，但是在这里 **不推荐从真机上获取** 。

# 准备材料 #

* node.js运行环境

* 如果没有安装nodejs，请先安装一下
* 下载地址： [nodejs.org/en/]( https://link.juejin.im?target=https%3A%2F%2Fnodejs.org%2Fen%2F )

* 反编译的脚本

* 这里提供一个Github上 ` qwerty472123` 大神写的node.js版本的，当然也有其它版本的，例如 ` python` 版本，这里我只是简单地用node.js版本举例
* 地址： [github.com/qwerty47212…]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fqwerty472123%2FwxappUnpacker )

* 安卓模拟器（要求自带root权限）

* 我使用的是 ` 夜神模拟器` ，你也可以自选
* 下载地址： [www.yeshen.com/cn/download…]( https://link.juejin.im?target=https%3A%2F%2Fwww.yeshen.com%2Fcn%2Fdownload%2FfullPackage )

# 详细步骤： #

## 使用安卓模拟器获取到.wxapkg文件 ##

不用越狱，不用root，使用电脑端的 **安卓模拟器** 来获取是一个 **非常简单快捷的** 获取方式，具体步骤如下：

* 打开安装好的安卓模拟器，并在模拟器中安装 ` QQ` 、 ` 微信` 、 ` RE管理器`

* ` QQ` 、 ` 微信` 在模拟器自带的应用商店里搜索下载安装即可
* ` RE管理器` 的下载地址： [pan.baidu.com/s/1PPBx08rN…]( https://link.juejin.im?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1PPBx08rNutXxhlMMJbuTpQ )
* 下载好后直接拖拽进打开的模拟器窗口就会自动安装

* 设置一下模拟器

* 以我个人认为比较好用的 ` 夜神模拟器` 举例
* 首先到模拟器内部设置超级用户权限

![](https://user-gold-cdn.xitu.io/2018/6/8/163ddb3a306eb5e0?imageView2/0/w/1280/h/960/ignore-error/1) ![](https://user-gold-cdn.xitu.io/2018/5/31/163b4a57d73e7627?imageView2/0/w/1280/h/960/ignore-error/1)

* 这些操作的目的都是为了能让 ` RE管理器` 顺利的获取到ROOT权限

* 接下来在模拟器里打开微信，然后在微信中运行你想要获取的小程序（这一步微信就会把目标小程序的源文件包从服务器下载到了本地）

* 就以我说的这款共享单车的小程序举例
* 在模拟器微信中运行一下后， **切回模拟器桌面，运行RE浏览器** 来到目录
* ` /data/data/com.tencent.mm/MicroMsg/{{一串32位的16进制字符串文件夹}}/appbrand/pkg/`
* 就抵达了目的文件夹 ![](https://user-gold-cdn.xitu.io/2018/5/31/163b1d9e47defe2d?imageView2/0/w/1280/h/960/ignore-error/1)
* 你会看到发现里面的一些.wxapkg后缀的文件，就是它们没错啦，可以根据时间来判断那个是你刚才从服务器下载过来的
* 一般小程序的文件不会太大，长按，然后点右上角选项将其 **压缩为zip包** ,然后再将压缩好的包通过QQ发送到 **我的电脑**
* 注： **如果不进行压缩的话，QQ会提示文件不可用** ![](https://user-gold-cdn.xitu.io/2018/5/31/163b1dca0c225daa?imageView2/0/w/1280/h/960/ignore-error/1)
* 所以QQ的这个功能可以让我们很方便的拿到源文件，而不必到电脑目录去找模拟器的文件目录。
* 解压。这样几步简单操作，就成功拿到了小程序的源文件了。

## 使用反编译脚本解包 wxapkg ##

* 到这里你应该已经将反编译脚本从github下载 或者 clone 到本地某个目录
* 打开nodejs命令窗口，如果有vscode的直接使用vscode更方便，没有安装的，打开如下这个命令行窗口
* 

![](https://user-gold-cdn.xitu.io/2018/6/26/1643ac62f831b893?imageView2/0/w/1280/h/960/ignore-error/1)

* 

用cd命令进入到你clone或者下载好的 **反编译脚本目录** 下

* 

在node命令窗口中依次 **安装** 如下依赖（依次把每条安装命令复制到命令行回车就可以）：

` npm install esprima npm install css-tree npm install cssbeautify npm install vm2 npm install uglify-es npm install js-beautify 复制代码`
* 

安装好依赖之后，就是最后一步了，反编译 .wxapkg 文件

* 

在当前目录下输入

` node wuWxapkg.js [-d] <files...> //files 就是你想要反编译的文件名 复制代码`

例如：我有一个需要反编译的文件 ` _163200311_32.wxapkg` 已经解压到了D盘根目录下,那么就输出命令

` node .\wuWxapkg.js D:\_163200311_32.wxapkg 复制代码`

> 
> 
> 
> 小技巧：注意这里 **斜杆别打反** 了，你可以输入文件名前几个字符，然后 **Tab键** 会自动补全文件名
> 
> 

* 回车运行

![](https://user-gold-cdn.xitu.io/2018/6/8/163ddbade4a979db?imageView2/0/w/1280/h/960/ignore-error/1)

* 

反编译脚本就能一步将.wxapkg 文件还原为微信开发者工具能够运行的源文件， **目录地址和你反编译的文件地址是一样的**

![](https://user-gold-cdn.xitu.io/2018/5/31/163b1e8c7ccb8878?imageView2/0/w/1280/h/960/ignore-error/1)

* 

看到这些文件结构，是不是非常熟悉！我们在微信开发者工具新增项目即可打开

![](https://user-gold-cdn.xitu.io/2018/5/31/163b1ec00dd5b4e0?imageView2/0/w/1280/h/960/ignore-error/1)

* 

运行成功，源码获取完成

![](https://user-gold-cdn.xitu.io/2018/6/8/163ddbd72f5ae515?imageView2/0/w/1280/h/960/ignore-error/1)

> 
> 
> 
> 如果运行出现了点问题：可以试试，点击开发者工具 详情 **去掉 es6转es5 的勾** ， **勾上不校验安全域名**
> 
> 

> 
> 
> 
> 勾选了还是无法运行？那么请在详情里把 **基础版本库** 调低至1.8左右，再试试
> 
> 

> 
> 
> 
> 出现找不到某些文件的情况怎么办？我只能告诉： **删！删！删** ！app.json里面,提示找不到那个文件，就将pages下注册的该页面语句暂时删除掉。删到可以运行为止
> 
> 
> 

> 
> 
> 
> 还是无法运行？那你可以在我的博客里找到我的联系方式，申请加我好友，我会尝试帮你解决，这是免费的，就当交个朋友
> 
> 

# 两步即可完成 #

至此我们就通过非常简单的方式获取到了一个想要的小程序源文件，并对其进行了反编译还原 以后想要再反编译其他的小程序，非常快速， **只需要两步**

* **使用模拟器找到小程序.wxapkg文件**
* **使用nodejs 反编译脚本将.wxapkg文件反编译**

> 
> 
> 
> 使用此方法，绝大部分的小程序都能正常反编译出来，但是也会有一些特殊的情况，具体可以查看 ` qwerty472123` 大神Github的 `
> readme.md` 文件
> 
> 

# 写在后面的话 #

早在跳一跳小游戏火的时候，就有人通过小程序的appid和版本号，构造URL直接从服务器端下载该小程序的源码wxapkg文件。但是这种方法很快就被封了。

上线的源代码能如此简单的被获取到，不得不说小程序的源码安全存在一些隐患，不过现在的小程序开发框架会用babel这样的打包工具把js逻辑代码揉在一个js文件里，转编译成看不懂的代码，这样，即使被获取了源码，也很难窥得蛛丝马迹。

> 
> 
> 
> 这里介绍的方法只想提供给像我一样的小程序新手用来学习和仿写练手，获取仿写素材。
> 
> 

小程序作为微信生态内的新生力量，不仅被官方，也被很多开发者和内容创业者寄予厚望，处于对代码的安全性的考虑，这里的获取方式，不确定以后是否还行得通。

原文链接： [行无忌的成长小屋：只需两步快速获取微信小程序源码]( https://link.juejin.im?target=https%3A%2F%2Fhx-dl.github.io%2Fhx-dl.github.io%2F2018%2F05%2F30%2F%25E5%258F%25AA%25E9%259C%2580%25E4%25B8%25A4%25E6%25AD%25A5%25E8%258E%25B7%25E5%258F%2596%25E4%25BB%25BB%25E4%25BD%2595%25E5%25B0%258F%25E7%25A8%258B%25E5%25BA%258F%25E6%25BA%2590%25E7%25A0%2581 )