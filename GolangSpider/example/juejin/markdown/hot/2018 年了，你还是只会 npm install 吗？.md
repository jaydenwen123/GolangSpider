# 2018 å¹´äº†ï¼Œä½ è¿˜æ˜¯åªä¼š npm install å—ï¼Ÿ #

> 
> 
> 
> æœ¬æ–‡åŒæ­¥å‘è¡¨äºä½œè€…åšå®¢: [2018 å¹´äº†ï¼Œä½ è¿˜æ˜¯åªä¼š npm install å—ï¼Ÿ](
> https://link.juejin.im?target=http%3A%2F%2Fmyan.im%2F2018%2F03%2F24%2Fyou-dont-know-npm%2F
> )
> 
> 

nodejs ç¤¾åŒºä¹ƒè‡³ Web å‰ç«¯å·¥ç¨‹åŒ–é¢†åŸŸå‘å±•åˆ°ä»Šå¤©ï¼Œä½œä¸º node è‡ªå¸¦çš„åŒ…ç®¡ç†å·¥å…·çš„ npm å·²ç»æˆä¸ºæ¯ä¸ªå‰ç«¯å¼€å‘è€…å¿…å¤‡çš„å·¥å…·ã€‚ä½†æ˜¯ç°å®çŠ¶å†µæ˜¯ï¼Œæˆ‘ä»¬å¾ˆå¤šäººå¯¹è¿™ä¸ªnodejsåŸºç¡€è®¾æ–½çš„ä½¿ç”¨å’Œäº†è§£è¿˜åœç•™åœ¨: ä¼šç”¨ ` npm install` è¿™é‡Œï¼ˆä¸€è¨€ä¸åˆå°±åˆ é™¤æ•´ä¸ª node_modules ç›®å½•ç„¶åé‡æ–° install è¿™ç§äº‹ä½ æ²¡åšè¿‡å—ï¼Ÿï¼‰

å½“ç„¶ npm èƒ½æˆä¸ºç°åœ¨ä¸–ç•Œä¸Šæœ€å¤§è§„æ¨¡çš„ **åŒ…ç®¡ç†ç³»ç»Ÿ** ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šç¡®å®å½’åŠŸäºå®ƒè¶³å¤Ÿ **ç”¨æˆ·å‹å¥½** ï¼Œä½ çœ‹å³ä½¿æˆ‘åªä¼šæ‰§è¡Œ install ä¹Ÿä¸å¿…å¤ªæ‹…å¿ƒå‡ºä»€ä¹ˆå¤§å²”å­. ä½†æ˜¯ npm çš„åŠŸèƒ½è¿œä¸æ­¢äº install ä¸€ä¸‹é‚£ä¹ˆç®€å•ï¼Œè¿™ç¯‡æ–‡ç« å¸®ä½ æ‰’ä¸€æ‰’é‚£äº›ä½ å¯èƒ½ä¸çŸ¥é“çš„ npm åŸç†ã€ç‰¹æ€§ã€æŠ€å·§ï¼Œä»¥åŠï¼ˆæˆ‘è®¤ä¸ºçš„ï¼‰æœ€ä½³å®è·µã€‚

ä½ æ‡’å¾—è¯»çš„ npm æ–‡æ¡£ï¼Œæˆ‘å¸®ä½ ç¿»è¯‘ç„¶åè¯•éªŒæ•´ç†è¿‡æ¥äº†ğŸ¶ğŸ¶ğŸ¶

## 1. npm init ##

æˆ‘ä»¬éƒ½çŸ¥é“ package.json æ–‡ä»¶æ˜¯ç”¨æ¥å®šä¹‰ä¸€ä¸ª package çš„æè¿°æ–‡ä»¶, ä¹ŸçŸ¥é“ ` npm init` å‘½ä»¤ç”¨æ¥åˆå§‹åŒ–ä¸€ä¸ªç®€å•çš„ package.json æ–‡ä»¶ï¼Œæ‰§è¡Œè¯¥å‘½ä»¤åç»ˆç«¯ä¼šä¾æ¬¡è¯¢é—® name, version, description ç­‰å­—æ®µã€‚

### 1.1 npm init æ‰§è¡Œé»˜è®¤è¡Œä¸º ###

 è€Œå¦‚æœæƒ³è¦å·æ‡’æ­¥å…å»ä¸€ç›´æŒ‰ enterï¼Œåœ¨å‘½ä»¤åè¿½åŠ  --yes å‚æ•°å³å¯ï¼Œå…¶ä½œç”¨ä¸ä¸€è·¯ä¸‹ä¸€æ­¥ç›¸åŒã€‚

` npm init --yes`

### 1.2 è‡ªå®šä¹‰ npm init è¡Œä¸º ###

npm init å‘½ä»¤çš„åŸç†å¹¶ä¸å¤æ‚ï¼Œè°ƒç”¨è„šæœ¬ï¼Œè¾“å‡ºä¸€ä¸ªåˆå§‹åŒ–çš„ package.json æ–‡ä»¶å°±æ˜¯äº†ã€‚æ‰€ä»¥ç›¸åº”åœ°ï¼Œå®šåˆ¶ npm init å‘½ä»¤çš„å®ç°æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨ Home ç›®å½•åˆ›å»ºä¸€ä¸ª `.npm-init.js` å³å¯ï¼Œè¯¥æ–‡ä»¶çš„ module.exports å³ä¸º package.json é…ç½®å†…å®¹ï¼Œéœ€è¦è·å–ç”¨æˆ·è¾“å…¥æ—¶å€™ï¼Œä½¿ç”¨ ` prompt()` æ–¹æ³•å³å¯ã€‚

ä¾‹å¦‚ç¼–å†™è¿™æ ·çš„ ~/.npm-init.js

` const desc = prompt( 'description?' , 'A new package...' ) const bar = prompt( 'bar?' , '' ) const count = prompt( 'count?' , '42' ) module.exports = { key : 'value' , foo : { bar : bar, count : count }, name : prompt( 'name?' , process.cwd().split( '/' ).pop()), version : prompt( 'version?' , '0.1.0' ), description : desc, main : 'index.js' , } å¤åˆ¶ä»£ç `

æ­¤æ—¶åœ¨ ~/hello ç›®å½•ä¸‹æ‰§è¡Œ ` npm init` å°†ä¼šå¾—åˆ°è¿™æ ·çš„ package.json:

` { "key" : "value" , "foo" : { "bar" : "" , "count" : "42" }, "name" : "hello" , "version" : "0.1.0" , "description" : "A new package..." , "main" : "index.js" } å¤åˆ¶ä»£ç `

é™¤äº†ç”Ÿæˆ package.json, å› ä¸º .npm-init.js æ˜¯ä¸€ä¸ªå¸¸è§„çš„æ¨¡å—ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ‰§è¡Œéšä¾¿ä»€ä¹ˆ node è„šæœ¬å¯ä»¥æ‰§è¡Œçš„ä»»åŠ¡ã€‚ä¾‹å¦‚é€šè¿‡ fs åˆ›å»º README, .eslintrc ç­‰é¡¹ç›®å¿…éœ€æ–‡ä»¶ï¼Œå®ç°é¡¹ç›®è„šæ‰‹æ¶çš„ä½œç”¨ã€‚

## 2. ä¾èµ–åŒ…å®‰è£… ##

ä¾èµ–ç®¡ç†æ˜¯ npm çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŸç†å°±æ˜¯æ‰§è¡Œ ` npm install` ä» package.json ä¸­çš„ dependencies, devDependencies å°†ä¾èµ–åŒ…å®‰è£…åˆ°å½“å‰ç›®å½•çš„ ./node_modules æ–‡ä»¶å¤¹ä¸­ã€‚

### 2.1 packageå®šä¹‰ ###

æˆ‘ä»¬éƒ½çŸ¥é“è¦æ‰‹åŠ¨å®‰è£…ä¸€ä¸ªåŒ…æ—¶ï¼Œæ‰§è¡Œ ` npm install <package>` å‘½ä»¤å³å¯ã€‚è¿™é‡Œçš„ç¬¬ä¸‰ä¸ªå‚æ•° package é€šå¸¸å°±æ˜¯æˆ‘ä»¬æ‰€è¦å®‰è£…çš„åŒ…åï¼Œé»˜è®¤é…ç½®ä¸‹ npm ä¼šä»é»˜è®¤çš„æº (Registry) ä¸­æŸ¥æ‰¾è¯¥åŒ…åå¯¹åº”çš„åŒ…åœ°å€ï¼Œå¹¶ä¸‹è½½å®‰è£…ã€‚ä½†åœ¨ npm çš„ä¸–ç•Œé‡Œï¼Œé™¤äº†ç®€å•çš„æŒ‡å®šåŒ…å, package è¿˜å¯ä»¥æ˜¯ä¸€ä¸ªæŒ‡å‘æœ‰æ•ˆåŒ…åçš„ http url/git url/æ–‡ä»¶å¤¹è·¯å¾„ã€‚

é˜…è¯» [npmçš„æ–‡æ¡£]( https://link.juejin.im?target=https%3A%2F%2Fdocs.npmjs.com%2Fgetting-started%2Fpackages%23what-is-a-package- ) ï¼Œ æˆ‘ä»¬ä¼šå‘ç°package å‡†ç¡®çš„å®šä¹‰ï¼Œåªè¦ç¬¦åˆä»¥ä¸‹ a) åˆ° g) å…¶ä¸­ä¹‹ä¸€æ¡ä»¶ï¼Œå°±æ˜¯ä¸€ä¸ª package:

+----+--------------------------------+--------------------------------------------------------+
| #  |              è¯´æ˜              |                          ä¾‹å­                          |
+----+--------------------------------+--------------------------------------------------------+
| a) | ä¸€ä¸ªåŒ…å«äº†ç¨‹åºå’Œæè¿°è¯¥ç¨‹åºçš„   | ./local-module/                                        |
|    | package.json æ–‡ä»¶ çš„           |                                                        |
|    | **æ–‡ä»¶å¤¹**                     |                                                        |
| b) | ä¸€ä¸ªåŒ…å«äº† (a) çš„              | ./module.tar.gz                                        |
|    | **gzip å‹ç¼©æ–‡ä»¶**              |                                                        |
| c) | ä¸€ä¸ªå¯ä»¥ä¸‹è½½å¾—åˆ° (b) èµ„æºçš„    | https://registry.npmjs.org/webpack/-/webpack-4.1.0.tgz |
|    | **url** (é€šå¸¸æ˜¯ http(s)        |                                                        |
|    | url)                           |                                                        |
| d) | ä¸€ä¸ªæ ¼å¼ä¸º ` <name>@<version>` | webpack@4.1.0                                          |
|    | çš„å­—ç¬¦ä¸²ï¼Œå¯æŒ‡å‘               |                                                        |
|    | npm æº(é€šå¸¸æ˜¯å®˜æ–¹æº            |                                                        |
|    | npmjs.org)ä¸Šå·²å‘å¸ƒçš„å¯è®¿é—®     |                                                        |
|    | urlï¼Œä¸”è¯¥ url æ»¡è¶³æ¡ä»¶ (c)     |                                                        |
| e) | ä¸€ä¸ªæ ¼å¼ä¸º `                   | webpack@latest                                         |
|    | <name>@<tag>`                  |                                                        |
|    | çš„å­—ç¬¦ä¸²ï¼Œåœ¨ npm               |                                                        |
|    | æºä¸Šè¯¥ ` <tag>` æŒ‡å‘æŸ         |                                                        |
|    | ` <version>` å¾—åˆ°              |                                                        |
|    | ` <name>@<version>`            |                                                        |
|    | ï¼Œåè€…æ»¡è¶³æ¡ä»¶ (d)             |                                                        |
| f) | ä¸€ä¸ªæ ¼å¼ä¸º                     | webpack                                                |
|    | ` <name>`                      |                                                        |
|    | çš„å­—ç¬¦ä¸²ï¼Œé»˜è®¤æ·»åŠ              |                                                        |
|    | ` latest`                      |                                                        |
|    | æ ‡ç­¾æ‰€å¾—åˆ°çš„ `                 |                                                        |
|    | <name>@latest`                 |                                                        |
|    | æ»¡è¶³æ¡ä»¶ (e)                   |                                                        |
| g) | ä¸€ä¸ª **git url** , è¯¥ url      | git@github.com:webpack/webpack.git                     |
|    | æ‰€æŒ‡å‘çš„ä»£ç åº“æ»¡è¶³æ¡ä»¶ (a)     |                                                        |
+----+--------------------------------+--------------------------------------------------------+

### 2.2 å®‰è£…æœ¬åœ°åŒ…/è¿œç¨‹gitä»“åº“åŒ… ###

ä¸Šé¢è¡¨æ ¼çš„å®šä¹‰æ„å‘³ç€ï¼Œæˆ‘ä»¬åœ¨å…±äº«ä¾èµ–åŒ…æ—¶ï¼Œå¹¶ä¸æ˜¯éè¦å°†åŒ…å‘è¡¨åˆ° npm æºä¸Šæ‰å¯ä»¥æä¾›ç»™ä½¿ç”¨è€…æ¥å®‰è£…ã€‚è¿™å¯¹äºç§æœ‰çš„ä¸æ–¹ä¾¿ publish åˆ°è¿œç¨‹æºï¼ˆå³ä½¿æ˜¯ç§æœ‰æºï¼‰ï¼Œæˆ–è€…éœ€è¦å¯¹æŸå®˜æ–¹æºè¿›è¡Œæ”¹é€ ï¼Œä½†ä¾ç„¶éœ€è¦æŠŠåŒ…å…±äº«å‡ºå»çš„åœºæ™¯æ¥è¯´éå¸¸å®ç”¨ã€‚

**åœºæ™¯1: æœ¬åœ°æ¨¡å—å¼•ç”¨**

nodejs åº”ç”¨å¼€å‘ä¸­ä¸å¯é¿å…æœ‰æ¨¡å—é—´è°ƒç”¨ï¼Œä¾‹å¦‚åœ¨å®è·µä¸­ç»å¸¸ä¼šæŠŠéœ€è¦è¢«é¢‘ç¹å¼•ç”¨çš„é…ç½®æ¨¡å—æ”¾åˆ°åº”ç”¨æ ¹ç›®å½•ï¼›äºæ˜¯åœ¨åˆ›å»ºäº†å¾ˆå¤šå±‚çº§çš„ç›®å½•ã€æ–‡ä»¶åï¼Œå¾ˆå¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„ä»£ç :

` const config = require ( '../../../../config.js' ); å¤åˆ¶ä»£ç `

é™¤äº†çœ‹ä¸Šå»å¾ˆä¸‘ä»¥å¤–ï¼Œè¿™æ ·çš„è·¯å¾„å¼•ç”¨ä¹Ÿä¸åˆ©äºä»£ç çš„é‡æ„ã€‚å¹¶ä¸”èº«ä¸ºç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»å‘Šè¯‰æˆ‘ä»¬ï¼Œè¿™æ ·é‡å¤çš„ä»£ç å¤šäº†ä¹Ÿå°±æ„å‘³ç€æ˜¯æ—¶å€™æŠŠè¿™ä¸ªæ¨¡å—åˆ†ç¦»å‡ºæ¥ä¾›åº”ç”¨å†…å…¶ä»–æ¨¡å—å…±äº«äº†ã€‚ä¾‹å¦‚è¿™ä¸ªä¾‹å­é‡Œçš„ config.js éå¸¸é€‚åˆå°è£…ä¸º package æ”¾åˆ° node_modules ç›®å½•ä¸‹ï¼Œå…±äº«ç»™åŒåº”ç”¨å†…å…¶ä»–æ¨¡å—ã€‚

æ— éœ€æ‰‹åŠ¨æ‹·è´æ–‡ä»¶æˆ–è€…åˆ›å»ºè½¯é“¾æ¥åˆ° node_modules ç›®å½•ï¼Œnpm æœ‰æ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚

**æ–¹æ¡ˆï¼š**

* 

åˆ›å»º config åŒ…:
æ–°å¢ config æ–‡ä»¶å¤¹; é‡å‘½å config.js ä¸º config/index.js æ–‡ä»¶; åˆ›å»º package.json å®šä¹‰ config åŒ…

` { "name" : "config" , "main" : "index.js" , "version" : "0.1.0" } å¤åˆ¶ä»£ç `
* 

åœ¨åº”ç”¨å±‚ package.json æ–‡ä»¶ä¸­æ–°å¢ä¾èµ–é¡¹ï¼Œç„¶åæ‰§è¡Œ ` npm install` ; æˆ–ç›´æ¥æ‰§è¡Œç¬¬ 3 æ­¥

` { "dependencies" : { "config" : "file:./config" } } å¤åˆ¶ä»£ç `
* 

ï¼ˆç­‰ä»·äºç¬¬ 2 æ­¥ï¼‰ç›´æ¥åœ¨åº”ç”¨ç›®å½•æ‰§è¡Œ ` npm install file:./config`

æ­¤æ—¶ï¼ŒæŸ¥çœ‹ ` node_modules` ç›®å½•æˆ‘ä»¬ä¼šå‘ç°å¤šå‡ºæ¥ä¸€ä¸ªåä¸º ` config` ï¼ŒæŒ‡å‘ä¸Šå±‚ ` config/` æ–‡ä»¶å¤¹çš„è½¯é“¾æ¥ã€‚è¿™æ˜¯å› ä¸º npm è¯†åˆ« ` file:` åè®®çš„urlï¼Œå¾—çŸ¥è¿™ä¸ªåŒ…éœ€è¦ç›´æ¥ä»æ–‡ä»¶ç³»ç»Ÿä¸­è·å–ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºè½¯é“¾æ¥åˆ° node_modules ä¸­ï¼Œå®Œæˆâ€œå®‰è£…â€è¿‡ç¨‹ã€‚

ç›¸æ¯”æ‰‹åŠ¨è½¯é“¾ï¼Œæˆ‘ä»¬æ—¢ä¸éœ€è¦å…³å¿ƒ windows å’Œ linux å‘½ä»¤å·®å¼‚ï¼Œåˆå¯ä»¥æ˜¾å¼åœ°å°†ä¾èµ–ä¿¡æ¯å›ºåŒ–åˆ° dependencies å­—æ®µä¸­ï¼Œå¼€å‘å›¢é˜Ÿå…¶ä»–æˆå‘˜å¯ä»¥æ‰§è¡Œ ` npm install` åç›´æ¥ä½¿ç”¨ã€‚

**åœºæ™¯2: ç§æœ‰ git å…±äº« package**

æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€ä¸ªå›¢é˜Ÿå†…ä¼šæœ‰ä¸€äº›ä»£ç /å…¬ç”¨åº“éœ€è¦åœ¨å›¢é˜Ÿå†… **ä¸åŒé¡¹ç›®é—´** å…±äº«ï¼Œä½†å¯èƒ½ç”±äºåŒ…å«äº†æ•æ„Ÿå†…å®¹ï¼Œæˆ–è€…ä»£ç å¤ªçƒ‚æ‹¿ä¸å‡ºæ‰‹ç­‰åŸå› ï¼Œä¸æ–¹ä¾¿å‘å¸ƒåˆ°æºã€‚

è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†è¢«ä¾èµ–çš„åŒ…æ‰˜ç®¡åœ¨ç§æœ‰çš„ git ä»“åº“ä¸­ï¼Œç„¶åå°†è¯¥ git url ä¿å­˜åˆ° dependencies ä¸­. npm ä¼šç›´æ¥è°ƒç”¨ç³»ç»Ÿçš„ git å‘½ä»¤ä» git ä»“åº“æ‹‰å–åŒ…çš„å†…å®¹åˆ° node_modules ä¸­ã€‚

[npm æ”¯æŒçš„ git url æ ¼å¼]( https://link.juejin.im?target=https%3A%2F%2Fdocs.npmjs.com%2Ffiles%2Fpackage.json%23git-urls-as-dependencies ) :

` <protocol>://[<user>[:<password>]@]<hostname>[:<port>][:][/]<path>[ #<commit-ish> | #semver:<semver>] å¤åˆ¶ä»£ç `

git è·¯å¾„åå¯ä»¥ä½¿ç”¨ # æŒ‡å®šç‰¹å®šçš„ git branch/commit/tag, ä¹Ÿå¯ä»¥ #semver: æŒ‡å®šç‰¹å®šçš„ semver range.

ä¾‹å¦‚ï¼š

` git+ssh://git@github.com:npm/npm.git #v1.0.27 git+ssh://git@github.com:npm/npm #semver:^5.0 git+https://isaacs@github.com/npm/npm.git git://github.com/npm/npm.git #v1.0.27 å¤åˆ¶ä»£ç `

**åœºæ™¯3: å¼€æº package é—®é¢˜ä¿®å¤**

ä½¿ç”¨æŸä¸ª npm åŒ…æ—¶å‘ç°å®ƒæœ‰æŸä¸ªä¸¥é‡bugï¼Œä½†ä¹Ÿè®¸æœ€åˆä½œè€…å·²ä¸å†ç»´æŠ¤ä»£ç äº†ï¼Œä¹Ÿè®¸æˆ‘ä»¬å·¥ä½œç´§æ€¥ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´æ issue ç»™ä½œè€…å†æ…¢æ…¢ç­‰ä½œè€…å‘å¸ƒæ–°çš„ä¿®å¤ç‰ˆæœ¬åˆ° npm æºã€‚

æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è¿›å…¥ node_modules ç›®å½•ä¸‹ä¿®æ”¹ç›¸åº”çš„åŒ…å†…å®¹ï¼Œä¹Ÿè®¸ä¿®æ”¹äº†ä¸€è¡Œä»£ç å°±ä¿®å¤äº†é—®é¢˜ã€‚ä½†æ˜¯è¿™ç§åšæ³•éå¸¸ä¸æ˜æ™ºï¼

é¦–å…ˆ node_modules æœ¬èº«ä¸åº”è¯¥æ”¾è¿›ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå¯¹ node_modules æ–‡ä»¶å¤¹ä¸­å†…å®¹çš„ä¿®æ”¹ä¸ä¼šè¢«è®°å½•è¿› git æäº¤è®°å½•ï¼›å…¶æ¬¡ï¼Œå°±ç®—æˆ‘ä»¬éè¦åæ¨¡å¼ï¼ŒæŠŠ node_modules æ”¾è¿›ç‰ˆæœ¬æ§åˆ¶ä¸­ï¼Œä½ çš„ä¿®æ”¹å†…å®¹ä¹Ÿå¾ˆå®¹æ˜“åœ¨ä¸‹æ¬¡ team ä¸­æŸä½æˆå‘˜æ‰§è¡Œ ` npm install` æˆ– ` npm update` æ—¶è¢«è¦†ç›–ï¼Œè€Œè¿™æ ·çš„ä¸€æ¬¡æäº¤å¾ˆå¯èƒ½åŒ…å«äº†å‡ åå‡ ç™¾ä¸ªåŒ…çš„æ›´æ–°ï¼Œä½ è‡ªå·±æ‰€åšçš„ä¿®æ”¹å¾ˆå®¹æ˜“å°±è¢«æ·¹æ²¡åœ¨åºå¤§çš„ diff æ–‡ä»¶åˆ—è¡¨ä¸­äº†ã€‚

**æ–¹æ¡ˆ** :

æœ€å¥½çš„åŠæ³•åº”å½“æ˜¯ fork åŸä½œè€…çš„ git åº“ï¼Œåœ¨è‡ªå·±æ‰€å±çš„ repo ä¸‹ä¿®å¤é—®é¢˜åï¼Œå°† dependencies ä¸­ç›¸åº”çš„ä¾èµ–é¡¹æ›´æ”¹ä¸ºè‡ªå·±ä¿®å¤åç‰ˆæœ¬çš„ git url å³å¯è§£å†³é—®é¢˜ã€‚ï¼ˆFork ä»£ç åº“åï¼Œä¹Ÿä¾¿äºå‘åŸä½œè€…æäº¤ PR ä¿®å¤é—®é¢˜ã€‚ä¸Šæ¸¸ä»£ç åº“ä¿®å¤é—®é¢˜åï¼Œå†æ¬¡æ›´æ–°æˆ‘ä»¬çš„ä¾èµ–é…ç½®ä¹Ÿä¸è¿Ÿã€‚ï¼‰

## 3. npm install å¦‚ä½•å·¥ä½œ â€”â€” node_modules ç›®å½•ç»“æ„ ##

npm install æ‰§è¡Œå®Œæ¯•åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ node_modules ä¸­çœ‹åˆ°æ‰€æœ‰ä¾èµ–çš„åŒ…ã€‚è™½ç„¶ä½¿ç”¨è€…æ— éœ€å…³æ³¨è¿™ä¸ªç›®å½•é‡Œçš„æ–‡ä»¶å¤¹ç»“æ„ç»†èŠ‚ï¼Œåªç®¡åœ¨ä¸šåŠ¡ä»£ç ä¸­å¼•ç”¨ä¾èµ–åŒ…å³å¯ï¼Œä½†äº†è§£ node_modules çš„å†…å®¹å¯ä»¥å¸®æˆ‘ä»¬æ›´å¥½ç†è§£ npm å¦‚ä½•å·¥ä½œï¼Œäº†è§£ä» npm 2 åˆ° npm 5 æœ‰å“ªäº›å˜åŒ–å’Œæ”¹è¿›ã€‚

ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬å‡è®¾åº”ç”¨ç›®å½•ä¸º app, ç”¨ä¸¤ä¸ªæµè¡Œçš„åŒ… ` webpack` , ` nconf` ä½œä¸ºä¾èµ–åŒ…åšç¤ºä¾‹è¯´æ˜ã€‚å¹¶ä¸”ä¸ºäº†æ­£å¸¸å®‰è£…ï¼Œä½¿ç”¨äº†â€œä¸Šå¤â€ npm 2 æ—¶æœŸçš„ç‰ˆæœ¬ ` webpack@1.15.0` , ` nconf@0.8.5`.

### 3.1 npm 2 ###

npm 2 åœ¨å®‰è£…ä¾èµ–åŒ…æ—¶ï¼Œé‡‡ç”¨ç®€å•çš„é€’å½’å®‰è£…æ–¹æ³•ã€‚æ‰§è¡Œ ` npm install` åï¼Œnpm 2 ä¾æ¬¡é€’å½’å®‰è£… ` webpack` å’Œ ` nconf` ä¸¤ä¸ªåŒ…åˆ° node_modules ä¸­ã€‚æ‰§è¡Œå®Œæ¯•åï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ° ./node_modules è¿™å±‚ç›®å½•åªå«æœ‰è¿™ä¸¤ä¸ªå­ç›®å½•ã€‚

` node_modules/ â”œâ”€â”€ nconf/ â””â”€â”€ webpack/ å¤åˆ¶ä»£ç `

è¿›å…¥æ›´æ·±ä¸€å±‚ nconf æˆ– webpack ç›®å½•ï¼Œå°†çœ‹åˆ°è¿™ä¸¤ä¸ªåŒ…å„è‡ªçš„ node_modules ä¸­ï¼Œå·²ç»ç”± npm é€’å½’åœ°å®‰è£…å¥½è‡ªèº«çš„ä¾èµ–åŒ…ã€‚åŒ…æ‹¬ `./node_modules/webpack/node_modules/webpack-core` , `./node_modules/conf/node_modules/async` ç­‰ç­‰ã€‚è€Œæ¯ä¸€ä¸ªåŒ…éƒ½æœ‰è‡ªå·±çš„ä¾èµ–åŒ…ï¼Œæ¯ä¸ªåŒ…è‡ªå·±çš„ä¾èµ–éƒ½å®‰è£…åœ¨äº†è‡ªå·±çš„ node_modules ä¸­ã€‚ä¾èµ–å…³ç³»å±‚å±‚é€’è¿›ï¼Œæ„æˆäº†ä¸€æ•´ä¸ªä¾èµ–æ ‘ï¼Œè¿™ä¸ªä¾èµ–æ ‘ä¸æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶ç»“æ„æ ‘åˆšå¥½å±‚å±‚å¯¹åº”ã€‚

æœ€æ–¹ä¾¿çš„æŸ¥çœ‹ä¾èµ–æ ‘çš„æ–¹å¼æ˜¯ç›´æ¥åœ¨ app ç›®å½•ä¸‹æ‰§è¡Œ ` npm ls` å‘½ä»¤ã€‚

` app@0.1.0 â”œâ”€â”¬ nconf@0.8.5 â”‚ â”œâ”€â”€ async@1.5.2 â”‚ â”œâ”€â”€ ini@1.3.5 â”‚ â”œâ”€â”€ secure-keys@1.0.0 â”‚ â””â”€â”€ yargs@3.32.0 â””â”€â”¬ webpack@1.15.0 â”œâ”€â”€ acorn@3.3.0 â”œâ”€â”€ async@1.5.2 â”œâ”€â”€ clone @1.0.3 â”œâ”€â”€ ... â”œâ”€â”€ optimist@0.6.1 â”œâ”€â”€ supports-color@3.2.3 â”œâ”€â”€ tapable@0.1.10 â”œâ”€â”€ uglify-js@2.7.5 â”œâ”€â”€ watchpack@0.2.9 â””â”€â”¬ webpack-core@0.6.9 â”œâ”€â”€ source -list-map@0.1.8 â””â”€â”€ source -map@0.4.4 å¤åˆ¶ä»£ç `

è¿™æ ·çš„ç›®å½•ç»“æ„ä¼˜ç‚¹åœ¨äºå±‚çº§ç»“æ„æ˜æ˜¾ï¼Œä¾¿äºè¿›è¡Œå‚»ç“œå¼çš„ç®¡ç†:

* ä¾‹å¦‚æ–°è£…ä¸€ä¸ªä¾èµ–åŒ…ï¼Œå¯ä»¥ç«‹å³åœ¨ç¬¬ä¸€å±‚ node_modules ä¸­çœ‹åˆ°å­ç›®å½•
* åœ¨å·²çŸ¥æ‰€éœ€åŒ…åå’Œç‰ˆæœ¬å·æ—¶ï¼Œç”šè‡³å¯ä»¥ä»åˆ«çš„æ–‡ä»¶å¤¹æ‰‹åŠ¨æ‹·è´éœ€è¦çš„åŒ…åˆ° node_modules æ–‡ä»¶å¤¹ä¸­ï¼Œå†æ‰‹åŠ¨ä¿®æ”¹ package.json ä¸­çš„ä¾èµ–é…ç½®
* è¦åˆ é™¤è¿™ä¸ªåŒ…ï¼Œä¹Ÿå¯ä»¥ç®€å•åœ°æ‰‹åŠ¨åˆ é™¤è¿™ä¸ªåŒ…çš„å­ç›®å½•ï¼Œå¹¶åˆ é™¤ package.json æ–‡ä»¶ä¸­ç›¸åº”çš„ä¸€è¡Œå³å¯

å®é™…ä¸Šï¼Œå¾ˆå¤šäººåœ¨ npm 2 æ—¶ä»£ä¹Ÿçš„ç¡®éƒ½è¿™ä¹ˆå®è·µè¿‡ï¼Œçš„ç¡®ä¹Ÿéƒ½å¯ä»¥å®‰è£…å’Œåˆ é™¤æˆåŠŸï¼Œå¹¶ä¸ä¼šå¯¼è‡´ä»€ä¹ˆå·®é”™ã€‚

ä½†è¿™æ ·çš„æ–‡ä»¶ç»“æ„ä¹Ÿæœ‰å¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼š

* å¯¹å¤æ‚çš„å·¥ç¨‹, node_modules å†…ç›®å½•ç»“æ„å¯èƒ½ä¼šå¤ªæ·±ï¼Œå¯¼è‡´æ·±å±‚çš„æ–‡ä»¶è·¯å¾„è¿‡é•¿è€Œè§¦å‘ windows æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶è·¯å¾„ä¸èƒ½è¶…è¿‡ 260 ä¸ªå­—ç¬¦é•¿çš„é”™è¯¯
* éƒ¨åˆ†è¢«å¤šä¸ªåŒ…æ‰€ä¾èµ–çš„åŒ…ï¼Œå¾ˆå¯èƒ½åœ¨åº”ç”¨ node_modules ç›®å½•ä¸­çš„å¾ˆå¤šåœ°æ–¹è¢«é‡å¤å®‰è£…ã€‚éšç€å·¥ç¨‹è§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œä¾èµ–æ ‘è¶Šæ¥è¶Šå¤æ‚ï¼Œè¿™æ ·çš„åŒ…æƒ…å†µä¼šè¶Šæ¥è¶Šå¤šï¼Œé€ æˆå¤§é‡çš„å†—ä½™ã€‚

â€”â€”åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­å°±æœ‰è¿™ä¸ªé—®é¢˜ï¼Œ ` webpack` å’Œ ` nconf` éƒ½ä¾èµ– ` async` è¿™ä¸ªåŒ…ï¼Œæ‰€ä»¥åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œwebpack å’Œ nconf çš„ node_modules å­ç›®å½•ä¸­éƒ½å®‰è£…äº†ç›¸åŒçš„ async åŒ…ï¼Œå¹¶ä¸”æ˜¯ç›¸åŒçš„ç‰ˆæœ¬ã€‚

` +-------------------------------------------+ | app/ | +----------+------------------------+-------+ | | | | +----------v------+ +---------v-------+ | | | | | webpack@1.15.0 | | nconf@0.8.5 | | | | | +--------+--------+ +--------+--------+ | | +-----v-----+ +-----v-----+ |async@1.5.2| |async@1.5.2| +-----------+ +-----------+ å¤åˆ¶ä»£ç `

### 3.2 npm 3 - æ‰å¹³ç»“æ„ ###

ä¸»è¦ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œnpm 3 çš„ node_modules ç›®å½•æ”¹æˆäº†æ›´åŠ æ‰å¹³çŠ¶çš„å±‚çº§ç»“æ„ã€‚æ–‡ä»¶ç³»ç»Ÿä¸­ ` webpack` , ` nconf` , ` async` çš„å±‚çº§å…³ç³»å˜æˆäº†å¹³çº§å…³ç³»ï¼Œå¤„äºåŒä¸€çº§ç›®å½•ä¸­ã€‚

` +-------------------------------------------+ | app/ | +-+---------------------------------------+-+ | | | | +----------v------+ +-------------+ +---------v-------+ | | | | | | | webpack@1.15.0 | | async@1.5.2 | | nconf@0.8.5 | | | | | | | +-----------------+ +-------------+ +-----------------+ å¤åˆ¶ä»£ç `

è™½ç„¶è¿™æ ·ä¸€æ¥ webpack/node_modules å’Œ nconf/node_modules ä¸­éƒ½ä¸å†æœ‰ async æ–‡ä»¶å¤¹ï¼Œä½†å¾—ç›Šäº node çš„æ¨¡å—åŠ è½½æœºåˆ¶ï¼Œä»–ä»¬éƒ½å¯ä»¥åœ¨ä¸Šä¸€çº§ node_modules ç›®å½•ä¸­æ‰¾åˆ° async åº“ã€‚æ‰€ä»¥ webpack å’Œ nconf çš„åº“ä»£ç ä¸­ ` require('async')` è¯­å¥çš„æ‰§è¡Œéƒ½ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ã€‚

è¿™åªæ˜¯æœ€ç®€å•çš„ä¾‹å­ï¼Œå®é™…çš„å·¥ç¨‹é¡¹ç›®ä¸­ï¼Œä¾èµ–æ ‘ä¸å¯é¿å…åœ°ä¼šæœ‰å¾ˆå¤šå±‚çº§ï¼Œå¾ˆå¤šä¾èµ–åŒ…ï¼Œå…¶ä¸­ä¼šæœ‰å¾ˆå¤šåŒåä½†ç‰ˆæœ¬ä¸åŒçš„åŒ…å­˜åœ¨äºä¸åŒçš„ä¾èµ–å±‚çº§ï¼Œå¯¹è¿™äº›å¤æ‚çš„æƒ…å†µ, npm 3 éƒ½ä¼šåœ¨å®‰è£…æ—¶éå†æ•´ä¸ªä¾èµ–æ ‘ï¼Œè®¡ç®—å‡ºæœ€åˆç†çš„æ–‡ä»¶å¤¹å®‰è£…æ–¹å¼ï¼Œä½¿å¾—æ‰€æœ‰è¢«é‡å¤ä¾èµ–çš„åŒ…éƒ½å¯ä»¥å»é‡å®‰è£…ã€‚

npm æ–‡æ¡£æä¾›äº†æ›´ç›´è§‚çš„ä¾‹å­è§£é‡Šè¿™ç§æƒ…å†µï¼š

> 
> 
> 
> å‡å¦‚ ` package{dep}` å†™æ³•ä»£è¡¨åŒ…å’ŒåŒ…çš„ä¾èµ–ï¼Œé‚£ä¹ˆ ` A{B,C}` , ` B{C}` , ` C{D}` çš„ä¾èµ–ç»“æ„åœ¨å®‰è£…ä¹‹åçš„
> node_modules æ˜¯è¿™æ ·çš„ç»“æ„ï¼š
> 
> 

` A +-- B +-- C +-- D å¤åˆ¶ä»£ç `

è¿™é‡Œä¹‹æ‰€ä»¥ D ä¹Ÿå®‰è£…åˆ°äº†ä¸ B C åŒä¸€çº§ç›®å½•ï¼Œæ˜¯å› ä¸º npm ä¼šé»˜è®¤ä¼šåœ¨æ— å†²çªçš„å‰æä¸‹ï¼Œå°½å¯èƒ½å°†åŒ…å®‰è£…åˆ°è¾ƒé«˜çš„å±‚çº§ã€‚

> 
> 
> 
> å¦‚æœæ˜¯ ` A{B,C}` , ` B{C,D@1}` , ` C{D@2}` çš„ä¾èµ–å…³ç³»ï¼Œå¾—åˆ°çš„å®‰è£…åç»“æ„æ˜¯ï¼š
> 
> 

` A +-- B +-- C `-- D@2 +-- D@1 å¤åˆ¶ä»£ç `

è¿™é‡Œæ˜¯å› ä¸ºï¼Œå¯¹äº npm æ¥è¯´åŒåä½†ä¸åŒç‰ˆæœ¬çš„åŒ…æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„åŒ…ï¼Œè€ŒåŒå±‚ä¸èƒ½æœ‰ä¸¤ä¸ªåŒåå­ç›®å½•ï¼Œæ‰€ä»¥å…¶ä¸­çš„ D@2 æ”¾åˆ°äº† C çš„å­ç›®å½•è€Œå¦ä¸€ä¸ª D@1 è¢«æ”¾åˆ°äº†å†ä¸Šä¸€å±‚ç›®å½•ã€‚

å¾ˆæ˜æ˜¾åœ¨ npm 3 ä¹‹å npm çš„ä¾èµ–æ ‘ç»“æ„ä¸å†ä¸æ–‡ä»¶å¤¹å±‚çº§ä¸€ä¸€å¯¹åº”äº†ã€‚æƒ³è¦æŸ¥çœ‹ app çš„ç›´æ¥ä¾èµ–é¡¹ï¼Œè¦é€šè¿‡ ` npm ls` å‘½ä»¤æŒ‡å®š ` --depth` å‚æ•°æ¥æŸ¥çœ‹ï¼š

` npm ls --depth 1 å¤åˆ¶ä»£ç `
> 
> 
> 
> PS: ä¸æœ¬åœ°ä¾èµ–åŒ…ä¸åŒï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡ ` npm install --global` å…¨å±€å®‰è£…åŒ…åˆ°å…¨å±€ç›®å½•æ—¶ï¼Œå¾—åˆ°çš„ç›®å½•ä¾ç„¶æ˜¯â€œä¼ ç»Ÿçš„â€ç›®å½•ç»“æ„ã€‚è€Œå¦‚æœä½¿ç”¨
> npm 3 æƒ³è¦å¾—åˆ°â€œä¼ ç»Ÿâ€å½¢å¼çš„æœ¬åœ° node_modules ç›®å½•ï¼Œä½¿ç”¨ ` npm install --global-style` å‘½ä»¤å³å¯ã€‚
> 
> 
> 

### 3.3 npm 5 - package-lock æ–‡ä»¶ ###

npm 5 å‘å¸ƒäº 2017 å¹´ä¹Ÿæ˜¯ç›®å‰æœ€æ–°çš„ npm ç‰ˆæœ¬ï¼Œè¿™ä¸€ç‰ˆæœ¬ä¾ç„¶æ²¿ç”¨ npm 3 ä¹‹åæ‰å¹³åŒ–çš„ä¾èµ–åŒ…å®‰è£…æ–¹å¼ï¼Œæ­¤å¤–æœ€å¤§çš„å˜åŒ–æ˜¯å¢åŠ äº† ` package-lock.json` æ–‡ä»¶ã€‚

package-lock.json çš„ä½œç”¨æ˜¯ **é”å®š** ä¾èµ–å®‰è£…ç»“æ„ï¼Œå¦‚æœæŸ¥çœ‹è¿™ä¸ª json çš„ç»“æ„ï¼Œä¼šå‘ç°ä¸ node_modules ç›®å½•çš„æ–‡ä»¶å±‚çº§ç»“æ„æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚

ä»¥ä¾èµ–å…³ç³»ä¸º: ` app{webpack}` çš„ 'app' é¡¹ç›®ä¸ºä¾‹, å…¶ package-lock æ–‡ä»¶åŒ…å«äº†è¿™æ ·çš„ç‰‡æ®µã€‚

` { "name": "app", "version": "0.1.0", "lockfileVersion": 1, "requires": true, "dependencies": { // ... å…¶ä»–ä¾èµ–åŒ… "webpack": { "version": "1.8.11", "resolved": "https://registry.npmjs.org/webpack/-/webpack-1.8.11.tgz", "integrity": "sha1-Yu0hnstBy/qcKuanu6laSYtgkcI=", "requires": { "async": "0.9.2", "clone": "0.1.19", "enhanced-resolve": "0.8.6", "esprima": "1.2.5", "interpret": "0.5.2", "memory-fs": "0.2.0", "mkdirp": "0.5.1", "node-libs-browser": "0.4.3", "optimist": "0.6.1", "supports-color": "1.3.1", "tapable": "0.1.10", "uglify-js": "2.4.24", "watchpack": "0.2.9", "webpack-core": "0.6.9" } }, "webpack-core": { "version": "0.6.9", "resolved": "https://registry.npmjs.org/webpack-core/-/webpack-core-0.6.9.tgz", "integrity": "sha1-/FcViMhVjad76e+23r3Fo7FyvcI=", "requires": { "source-list-map": "0.1.8", "source-map": "0.4.4" }, "dependencies": { "source-map": { "version": "0.4.4", "resolved": "https://registry.npmjs.org/source-map/-/source-map-0.4.4.tgz", "integrity": "sha1-66T12pwNyZneaAMti092FzZSA2s=", "requires": { "amdefine": "1.0.1" } } } }, //... å…¶ä»–ä¾èµ–åŒ… } } å¤åˆ¶ä»£ç `

çœ‹æ‡‚ package-lock æ–‡ä»¶å¹¶ä¸éš¾ï¼Œå…¶ç»“æ„æ˜¯åŒæ ·ç±»å‹çš„å‡ ä¸ªå­—æ®µåµŒå¥—èµ·æ¥çš„ï¼Œä¸»è¦æ˜¯ ` version` , ` resolved` , ` integrity` , ` requires` , ` dependencies` è¿™å‡ ä¸ªå­—æ®µè€Œå·²ã€‚

* ` version` , ` resolved` , ` integrity` ç”¨æ¥è®°å½•åŒ…çš„å‡†ç¡®ç‰ˆæœ¬å·ã€å†…å®¹hashã€å®‰è£…æºçš„ï¼Œå†³å®šäº†è¦å®‰è£…çš„åŒ…çš„å‡†ç¡®â€œèº«ä»½â€ä¿¡æ¯
* å‡è®¾ç›–ä½å…¶ä»–å­—æ®µï¼Œåªå…³æ³¨æ–‡ä»¶ä¸­çš„ ` dependencies: {}` æˆ‘ä»¬ä¼šå‘ç°ï¼Œæ•´ä¸ªæ–‡ä»¶çš„ JSON é…ç½®é‡Œçš„ dependencies å±‚æ¬¡ç»“æ„ä¸æ–‡ä»¶ç³»ç»Ÿä¸­ node_modules çš„æ–‡ä»¶å¤¹å±‚æ¬¡ç»“æ„æ˜¯å®Œå…¨å¯¹ç…§çš„
* åªå…³æ³¨ ` requires: {}` å­—æ®µåˆä¼šå‘ç°ï¼Œé™¤æœ€å¤–å±‚çš„ ` requires` å±æ€§ä¸º true ä»¥å¤–, å…¶ä»–å±‚çš„ requires å±æ€§éƒ½å¯¹åº”ç€è¿™ä¸ªåŒ…çš„ package.json é‡Œè®°å½•çš„è‡ªå·±çš„ä¾èµ–é¡¹

å› ä¸ºè¿™ä¸ªæ–‡ä»¶è®°å½•äº† node_modules é‡Œæ‰€æœ‰åŒ…çš„ç»“æ„ã€å±‚çº§å’Œç‰ˆæœ¬å·ç”šè‡³å®‰è£…æºï¼Œå®ƒä¹Ÿå°±äº‹å®ä¸Šæä¾›äº† â€œä¿å­˜â€ node_modules çŠ¶æ€çš„èƒ½åŠ›ã€‚åªè¦æœ‰è¿™æ ·ä¸€ä¸ª lock æ–‡ä»¶ï¼Œä¸ç®¡åœ¨é‚£ä¸€å°æœºå™¨ä¸Šæ‰§è¡Œ npm install éƒ½ä¼šå¾—åˆ°å®Œå…¨ç›¸åŒçš„ node_modules ç»“æœã€‚

è¿™å°±æ˜¯ package-lock æ–‡ä»¶è‡´åŠ›äºä¼˜åŒ–çš„åœºæ™¯ï¼šåœ¨ä»å‰ä»…ä»…ç”¨ package.json è®°å½•ä¾èµ–ï¼Œç”±äº semver range çš„æœºåˆ¶ï¼›ä¸€ä¸ªæœˆå‰ç”± A ç”Ÿæˆçš„ package.json æ–‡ä»¶ï¼ŒB åœ¨ä¸€ä¸ªæœˆåæ ¹æ®å®ƒæ‰§è¡Œ npm install æ‰€å¾—åˆ°çš„ node_modules ç»“æœå¾ˆå¯èƒ½è®¸å¤šåŒ…éƒ½å­˜åœ¨ä¸åŒçš„å·®å¼‚ï¼Œè™½ç„¶ semver æœºåˆ¶çš„é™åˆ¶ä½¿å¾—åŒä¸€ä»½ package.json ä¸ä¼šå¾—åˆ°å¤§ç‰ˆæœ¬ä¸åŒçš„ä¾èµ–åŒ…ï¼Œä½†åŒä¸€ä»½ä»£ç åœ¨ä¸åŒç¯å¢ƒå®‰è£…å‡ºä¸åŒçš„ä¾èµ–åŒ…ï¼Œä¾ç„¶æ˜¯å¯èƒ½å¯¼è‡´æ„å¤–çš„æ½œåœ¨å› ç´ ã€‚

ç›¸åŒä½œç”¨çš„æ–‡ä»¶åœ¨ npm 5 ä¹‹å‰å°±æœ‰ï¼Œç§°ä¸º npm shrinkwrap æ–‡ä»¶ï¼ŒäºŒè€…ä½œç”¨å®Œå…¨ç›¸åŒï¼Œä¸åŒçš„æ˜¯åè€…éœ€è¦æ‰‹åŠ¨ç”Ÿæˆï¼Œè€Œ npm 5 é»˜è®¤ä¼šåœ¨æ‰§è¡Œ npm install åå°±ç”Ÿæˆ package-lock æ–‡ä»¶ï¼Œå¹¶ä¸”å»ºè®®ä½ æäº¤åˆ° git/svn ä»£ç åº“ä¸­ã€‚

package-lock.json æ–‡ä»¶åœ¨æœ€åˆ npm 5.0 é»˜è®¤å¼•å…¥æ—¶ä¹Ÿå¼•èµ·äº†ç›¸å½“å¤§çš„ [äº‰è®®]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fnpm%2Fnpm%2Fissues%2F16866 ) ã€‚åœ¨ npm 5.0 ä¸­ï¼Œå¦‚æœå·²æœ‰ package-lock æ–‡ä»¶å­˜åœ¨ï¼Œè‹¥æ‰‹åŠ¨åœ¨ package.json æ–‡ä»¶æ–°å¢ä¸€æ¡ä¾èµ–ï¼Œå†æ‰§è¡Œ npm install, æ–°å¢çš„ä¾èµ–å¹¶ä¸ä¼šè¢«å®‰è£…åˆ° node_modules ä¸­, package-lock.json ä¹Ÿä¸ä¼šåšç›¸åº”çš„æ›´æ–°ã€‚è¿™æ ·çš„è¡¨ç°ä¸ä½¿ç”¨è€…çš„è‡ªç„¶æœŸæœ›è¡¨ç°ä¸ç¬¦ã€‚åœ¨ npm 5.1 çš„é¦–ä¸ª [Release]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fnpm%2Fnpm%2Fissues%2F16866 ) ç‰ˆæœ¬ä¸­è¿™ä¸ªé—®é¢˜å¾—ä»¥ä¿®å¤ã€‚è¿™ä¸ªäº‹æƒ…å‘Šè¯‰æˆ‘ä»¬ï¼Œè¦å‡çº§ï¼Œä¸è¦ä½¿ç”¨ 5.0ã€‚

â€”â€”ä½†ä¾ç„¶æœ‰åå¯¹çš„å£°éŸ³è®¤ä¸º package-lock å¤ªå¤æ‚ï¼Œå¯¹æ­¤ npm ä¹Ÿæä¾›äº†ç¦ç”¨é…ç½®ï¼š

` npm config set package-lock false å¤åˆ¶ä»£ç `

## 4. ä¾èµ–åŒ…ç‰ˆæœ¬ç®¡ç† ##

ä¾èµ–åŒ…å®‰è£…å®Œå¹¶ä¸æ„å‘³ç€å°±ä¸‡äº‹å¤§å‰äº†ï¼Œç‰ˆæœ¬çš„ç»´æŠ¤å’Œæ›´æ–°ä¹Ÿå¾ˆé‡è¦ã€‚è¿™ä¸€ç« ä»‹ç»ä¾èµ–åŒ…å‡çº§ç®¡ç†ç›¸å…³çŸ¥è¯†ï¼Œå¤ªé•¿ä¸çœ‹ç‰ˆæœ¬è¯·ç›´æ¥è·³åˆ° [4.3 æœ€ä½³å®è·µ].

### 4.1 semver ###

npm ä¾èµ–ç®¡ç†çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯é‡‡ç”¨äº† [è¯­ä¹‰åŒ–ç‰ˆæœ¬ (semver)]( https://link.juejin.im?target=https%3A%2F%2Fsemver.org%2Flang%2Fzh-CN%2F ) è§„èŒƒï¼Œä½œä¸ºä¾èµ– **ç‰ˆæœ¬** ç®¡ç†æ–¹æ¡ˆã€‚

semver çº¦å®šä¸€ä¸ªåŒ…çš„ç‰ˆæœ¬å·å¿…é¡»åŒ…å«3ä¸ªæ•°å­—ï¼Œæ ¼å¼å¿…é¡»ä¸º ` MAJOR.MINOR.PATCH` , æ„ä¸º ` ä¸»ç‰ˆæœ¬å·.å°ç‰ˆæœ¬å·.ä¿®è®¢ç‰ˆæœ¬å·`.

* MAJOR å¯¹åº”å¤§çš„ç‰ˆæœ¬å·è¿­ä»£ï¼Œåšäº†ä¸å…¼å®¹æ—§ç‰ˆçš„ä¿®æ”¹æ—¶è¦æ›´æ–° MAJOR ç‰ˆæœ¬å·
* MINOR å¯¹åº”å°ç‰ˆæœ¬è¿­ä»£ï¼Œå‘ç”Ÿå…¼å®¹æ—§ç‰ˆAPIçš„ä¿®æ”¹æˆ–åŠŸèƒ½æ›´æ–°æ—¶ï¼Œæ›´æ–°MINORç‰ˆæœ¬å·
* PATCH å¯¹åº”ä¿®è®¢ç‰ˆæœ¬å·ï¼Œä¸€èˆ¬é’ˆå¯¹ä¿®å¤ BUG çš„ç‰ˆæœ¬å·

å¯¹äºåŒ…ä½œè€…ï¼ˆå‘å¸ƒè€…ï¼‰ï¼Œnpm è¦æ±‚åœ¨ publish ä¹‹å‰ï¼Œå¿…é¡»æ›´æ–°ç‰ˆæœ¬å·ã€‚npm æä¾›äº† ` npm version` å·¥å…·ï¼Œæ‰§è¡Œ ` npm version major|minor|patch` å¯ä»¥ç®€å•åœ°å°†ç‰ˆæœ¬å·ä¸­ç›¸åº”çš„æ•°å­—åŠ 1.

> 
> 
> 
> å¦‚æœåŒ…æ˜¯ä¸€ä¸ª git ä»“åº“ï¼Œ ` npm version` è¿˜ä¼šè‡ªåŠ¨åˆ›å»ºä¸€æ¡æ³¨é‡Šä¸ºæ›´æ–°åç‰ˆæœ¬å·çš„ git commit å’Œåä¸ºè¯¥ç‰ˆæœ¬å·çš„ tag
> 
> 

å¯¹äºåŒ…çš„å¼•ç”¨è€…æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ dependencies ä¸­ä½¿ç”¨ semver çº¦å®šçš„ semver range æŒ‡å®šæ‰€éœ€ä¾èµ–åŒ…çš„ç‰ˆæœ¬å·æˆ–ç‰ˆæœ¬èŒƒå›´ã€‚npm æä¾›äº†ç½‘ç«™ https://semver.npmjs.com å¯æ–¹ä¾¿åœ°è®¡ç®—æ‰€è¾“å…¥çš„è¡¨è¾¾å¼çš„åŒ¹é…èŒƒå›´ã€‚å¸¸ç”¨çš„è§„åˆ™ç¤ºä¾‹å¦‚ä¸‹è¡¨ï¼š

+------------------+--------------------------------+-----------+
|      RANGE       |              å«ä¹‰              |    ä¾‹     |
+------------------+--------------------------------+-----------+
| ` ^2.2.1`        | æŒ‡å®šçš„ MAJOR ç‰ˆæœ¬å·ä¸‹,         | åŒ¹é… `    |
|                  | æ‰€æœ‰æ›´æ–°çš„ç‰ˆæœ¬                 | 2.2.3` ,  |
|                  |                                | ` 2.3.0`  |
|                  |                                | ; ä¸åŒ¹é…  |
|                  |                                | ` 1.0.3`  |
|                  |                                | , `       |
|                  |                                | 3.0.1`    |
| ` ~2.2.1`        | æŒ‡å®š MAJOR.MINOR               | åŒ¹é… `    |
|                  | ç‰ˆæœ¬å·ä¸‹ï¼Œæ‰€æœ‰æ›´æ–°çš„ç‰ˆæœ¬       | 2.2.3` ,  |
|                  |                                | ` 2.2.9`  |
|                  |                                | ; ä¸åŒ¹é…  |
|                  |                                | ` 2.3.0`  |
|                  |                                | , `       |
|                  |                                | 2.4.5`    |
| ` >=2.1`         | ç‰ˆæœ¬å·å¤§äºæˆ–ç­‰äº               | åŒ¹é… `    |
|                  | ` 2.1.0`                       | 2.1.2` ,  |
|                  |                                | ` 3.1`    |
| ` <=2.2`         | ç‰ˆæœ¬å·å°äºæˆ–ç­‰äº               | åŒ¹é… `    |
|                  | ` 2.2`                         | 1.0.0` ,  |
|                  |                                | ` 2.2.1`  |
|                  |                                | , `       |
|                  |                                | 2.2.11`   |
| ` 1.0.0 - 2.0.0` | ç‰ˆæœ¬å·ä» 1.0.0 (å«) åˆ° 2.0.0   | åŒ¹é… `    |
|                  | (å«)                           | 1.0.0` ,  |
|                  |                                | ` 1.3.4`  |
|                  |                                | , `       |
|                  |                                | 2.0.0`    |
+------------------+--------------------------------+-----------+

ä»»æ„ä¸¤æ¡è§„åˆ™ï¼Œç”¨ç©ºæ ¼è¿æ¥èµ·æ¥ï¼Œè¡¨ç¤ºâ€œä¸â€é€»è¾‘ï¼Œå³ä¸¤æ¡è§„åˆ™çš„äº¤é›†:

å¦‚ ` >=2.3.1 <=2.8.0` å¯ä»¥è§£è¯»ä¸º: ` >=2.3.1` ä¸” ` <=2.8.0`

* å¯ä»¥åŒ¹é… ` 2.3.1` , ` 2.4.5` , ` 2.8.0`
* ä½†ä¸åŒ¹é… ` 1.0.0` , ` 2.3.0` , ` 2.8.1` , ` 3.0.0`

ä»»æ„ä¸¤æ¡è§„åˆ™ï¼Œé€šè¿‡ ` ||` è¿æ¥èµ·æ¥ï¼Œè¡¨ç¤ºâ€œæˆ–â€é€»è¾‘ï¼Œå³ä¸¤æ¡è§„åˆ™çš„å¹¶é›†:

å¦‚ ` ^2 >=2.3.1 || ^3 >3.2`

* å¯ä»¥åŒ¹é… ` 2.3.1` , ` 2,8.1` , ` 3.3.1`
* ä½†ä¸åŒ¹é… ` 1.0.0` , ` 2.2.0` , ` 3.1.0` , ` 4.0.0`

PS: é™¤äº†è¿™å‡ ç§ï¼Œè¿˜æœ‰å¦‚ä¸‹æ›´ç›´è§‚çš„è¡¨ç¤ºç‰ˆæœ¬å·èŒƒå›´çš„å†™æ³•:

* ` *` æˆ– ` x` åŒ¹é…æ‰€æœ‰ä¸»ç‰ˆæœ¬
* ` 1` æˆ– ` 1.x` åŒ¹é… ä¸»ç‰ˆæœ¬å·ä¸º 1 çš„æ‰€æœ‰ç‰ˆæœ¬
* ` 1.2` æˆ– ` 1.2.x` åŒ¹é… ç‰ˆæœ¬å·ä¸º 1.2 å¼€å¤´çš„æ‰€æœ‰ç‰ˆæœ¬

PPS: åœ¨å¸¸è§„ä»…åŒ…å«æ•°å­—çš„ç‰ˆæœ¬å·ä¹‹å¤–ï¼Œsemver è¿˜å…è®¸åœ¨ ` MAJOR.MINOR.PATCH` åè¿½åŠ  ` -` åè·Ÿç‚¹å·åˆ†éš”çš„æ ‡ç­¾ï¼Œä½œä¸ºé¢„å‘å¸ƒç‰ˆæœ¬æ ‡ç­¾ - [Prerelese Tags]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fnpm%2Fnode-semver%23prerelease-tags ) ï¼Œé€šå¸¸è¢«è§†ä¸ºä¸ç¨³å®šã€ä¸å»ºè®®ç”Ÿäº§ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼š

* ` 1.0.0-alpha`
* ` 1.0.0-beta.1`
* ` 1.0.0-rc.3`

ä¸Šè¡¨ä¸­æˆ‘ä»¬æœ€å¸¸è§çš„æ˜¯ ` ^1.8.11` è¿™ç§æ ¼å¼çš„ range, å› ä¸ºæˆ‘ä»¬åœ¨ä½¿ç”¨ ` npm install <package name>` å®‰è£…åŒ…æ—¶ï¼Œnpm é»˜è®¤å®‰è£…å½“å‰æœ€æ–°ç‰ˆæœ¬ï¼Œä¾‹å¦‚ ` 1.8.11` , ç„¶ååœ¨æ‰€å®‰è£…çš„ç‰ˆæœ¬å·å‰åŠ  ` ^` å·, å°† ` ^1.8.11` å†™å…¥ package.json ä¾èµ–é…ç½®ï¼Œæ„å‘³ç€å¯ä»¥åŒ¹é… 1.8.11 ä»¥ä¸Šï¼Œ2.0.0 ä»¥ä¸‹çš„æ‰€æœ‰ç‰ˆæœ¬ã€‚

### 4.2 ä¾èµ–ç‰ˆæœ¬å‡çº§ ###

é—®é¢˜æ¥äº†ï¼Œåœ¨å®‰è£…å®Œä¸€ä¸ªä¾èµ–åŒ…ä¹‹åæœ‰æ–°ç‰ˆæœ¬å‘å¸ƒäº†ï¼Œå¦‚ä½•ä½¿ç”¨ npm è¿›è¡Œç‰ˆæœ¬å‡çº§å‘¢ï¼Ÿâ€”â€”ç­”æ¡ˆæ˜¯ç®€å•çš„ ` npm install` æˆ– ` npm update` ï¼Œä½†åœ¨ä¸åŒçš„ npm ç‰ˆæœ¬ï¼Œä¸åŒçš„ package.json, package-lock.json æ–‡ä»¶ï¼Œå®‰è£…/å‡çº§çš„è¡¨ç°ä¹Ÿä¸åŒã€‚

æˆ‘ä»¬ä¸å¦¨è¿˜ä»¥ webpack ä¸¾ä¾‹ï¼Œåšå¦‚ä¸‹çš„ **å‰æå‡è®¾** :

* æˆ‘ä»¬çš„å·¥ç¨‹é¡¹ç›® ` app` ä¾èµ– webpack
* é¡¹ç›®æœ€åˆåˆå§‹åŒ–æ—¶ï¼Œå®‰è£…äº†å½“æ—¶æœ€æ–°çš„åŒ… webpack@1.8.0ï¼Œå¹¶ä¸” package.json ä¸­çš„ä¾èµ–é…ç½®ä¸º: ` "webpack": "^1.8.0"`
* å½“å‰ï¼ˆ2018å¹´3æœˆï¼‰ webpack æœ€æ–°ç‰ˆæœ¬ä¸º ` 4.2.0` , webpack 1.x æœ€æ–°å­ç‰ˆæœ¬ä¸º ` 1.15.0`

å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ npm 3, å¹¶ä¸”é¡¹ç›®ä¸å« package-lock.json, é‚£ä¹ˆæ ¹æ® node_modules æ˜¯å¦ä¸ºç©ºï¼Œæ‰§è¡Œ install/update çš„ç»“æœå¦‚ä¸‹ ( **node 6.13.1, npm 3.10.10** ç¯å¢ƒä¸‹è¯•éªŒ):

+----+-----------------------+-----------------------+-----------------+----------------------+----------------------+
| #  | PACKAGE JSON (BEFORE) | NODE MODULES (BEFORE) | COMMAND (NPM 3) | PACKAGE JSON (AFTER) | NODE MODULES (AFTER) |
+----+-----------------------+-----------------------+-----------------+----------------------+----------------------+
| a) | ` webpack: ^1.8.0`    | webpack@1.8.0         | ` install`      | ` webpack: ^1.8.0`   | webpack@1.8.0        |
| b) | ` webpack: ^1.8.0`    | ç©º                    | ` install`      | ` webpack: ^1.8.0`   | webpack@1.15.0       |
| c) | ` webpack: ^1.8.0`    | webpack@1.8.0         | ` update`       | ` webpack: ^1.8.0`   | webpack@1.15.0       |
| d) | ` webpack: ^1.8.0`    | ç©º                    | ` update`       | ` webpack: ^1.8.0`   | webpack@1.15.0       |
+----+-----------------------+-----------------------+-----------------+----------------------+----------------------+

æ ¹æ®è¿™ä¸ªè¡¨æˆ‘ä»¬å¯ä»¥å¯¹ npm 3 å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š

* å¦‚æœæœ¬åœ° node_modules å·²å®‰è£…ï¼Œå†æ¬¡æ‰§è¡Œ install ä¸ä¼šæ›´æ–°åŒ…ç‰ˆæœ¬, æ‰§è¡Œ update æ‰ä¼šæ›´æ–°; è€Œå¦‚æœæœ¬åœ° node_modules ä¸ºç©ºæ—¶ï¼Œæ‰§è¡Œ install/update éƒ½ä¼šç›´æ¥å®‰è£…æ›´æ–°åŒ…;
* npm update æ€»æ˜¯ä¼šæŠŠåŒ…æ›´æ–°åˆ°ç¬¦åˆ package.json ä¸­æŒ‡å®šçš„ semver çš„ **æœ€æ–°** ç‰ˆæœ¬å·â€”â€”æœ¬ä¾‹ä¸­ç¬¦åˆ ` ^1.8.0` çš„æœ€æ–°ç‰ˆæœ¬ä¸º ` 1.15.0`
* ä¸€æ—¦ç»™å®š package.json, æ— è®ºåé¢æ‰§è¡Œ npm install è¿˜æ˜¯ update, package.json ä¸­çš„ webpack ç‰ˆæœ¬ä¸€ç›´é¡½å›ºåœ°ä¿æŒ ä¸€å¼€å§‹çš„ ` ^1.8.0` å²¿ç„¶ä¸åŠ¨

è¿™é‡Œä¸åˆç†çš„åœ°æ–¹åœ¨äºï¼Œå¦‚æœæœ€å¼€å§‹å›¢é˜Ÿä¸­ç¬¬ä¸€ä¸ªäººå®‰è£…äº† ` webpack@1.8.0` , è€Œæ–°åŠ å…¥é¡¹ç›®çš„æˆå‘˜, checkout å·¥ç¨‹ä»£ç åæ‰§è¡Œ ` npm install` ä¼šå®‰è£…å¾—åˆ°ä¸å¤ªä¸€æ ·çš„ ` 1.15.0` ç‰ˆæœ¬ã€‚è™½ç„¶ semver çº¦å®šäº†å°ç‰ˆæœ¬å·åº”å½“ä¿æŒå‘ä¸‹å…¼å®¹ï¼ˆç›¸åŒå¤§ç‰ˆæœ¬å·ä¸‹çš„å°ç‰ˆæœ¬å·ï¼‰å…¼å®¹ï¼Œä½†ä¸‡ä¸€æœ‰ä¸ç†Ÿæ‚‰ä¸éµå¾ªæ­¤çº¦å®šçš„åŒ…å‘å¸ƒè€…ï¼Œå‘å¸ƒäº†ä¸å…¼å®¹çš„åŒ…ï¼Œæ­¤æ—¶å°±å¯èƒ½å‡ºç°å› ä¾èµ–ç¯å¢ƒä¸åŒå¯¼è‡´çš„ bugã€‚

ä¸‹é¢ç”± npm 5 å¸¦ç€ package-lock.json é—ªäº®ç™»åœºï¼Œæ‰§è¡Œ install/update çš„æ•ˆæœæ˜¯è¿™æ ·çš„ ( **node 9.8.0, npm 5.7.1** ç¯å¢ƒä¸‹è¯•éªŒ):

> 
> 
> 
> ä¸‹è¡¨ä¸ºè¡¨è¿°ç®€å•ï¼Œçœç•¥äº†åŒ…å webpack, install ç®€å†™ i, update ç®€å†™ä¸º up
> 
> 

+----+-----------------------+-----------------------+-----------------------+-----------+----------------------+----------------------+
| #  | PACKAGE JSON (BEFORE) | NODE MODULES (BEFORE) | PACKAGE-LOCK (BEFORE) |  COMMAND  | PACKAGE JSON (AFTER) | NODE MODULES (AFTER) |
+----+-----------------------+-----------------------+-----------------------+-----------+----------------------+----------------------+
| a) | ` ^1.8.0`             | @1.8.0                | @1.8.0                | ` i`      | ` ^1.8.0`            | @1.8.0               |
| b) | ` ^1.8.0`             | ç©º                    | @1.8.0                | ` i`      | ` ^1.8.0`            | @1.8.0               |
| c) | ` ^1.8.0`             | @1.8.0                | @1.8.0                | **` up`** | **` ^1.15.0`**       | **@1.15.0**          |
| d) | ` ^1.8.0`             | ç©º                    | @1.8.0                | ` up`     | ` ^1.8.0`            | @1.15.0              |
| e) | ` ^1.15.0`            | @1.8.0 (æ—§)           | @1.15.0               | **` i`**  | **` ^1.15.0`**       | **@1.15.0**          |
| f) | ` ^1.15.0`            | @1.8.0 (æ—§)           | @1.15.0               | **` up`** | **` ^1.15.0`**       | **@1.15.0**          |
+----+-----------------------+-----------------------+-----------------------+-----------+----------------------+----------------------+

ä¸ npm 3 ç›¸æ¯”ï¼Œåœ¨å®‰è£…å’Œæ›´æ–°ä¾èµ–ç‰ˆæœ¬ä¸Šä¸»è¦çš„åŒºåˆ«ä¸ºï¼š

* æ— è®ºä½•æ—¶æ‰§è¡Œ install, npm éƒ½ä¼šä¼˜å…ˆæŒ‰ç…§ package-lock ä¸­æŒ‡å®šçš„ç‰ˆæœ¬æ¥å®‰è£… webpack; é¿å…äº† npm 3 è¡¨ä¸­æƒ…å½¢ b) çš„çŠ¶å†µ;
* æ— è®ºä½•æ—¶å®Œæˆå®‰è£…/æ›´æ–°, package-lock æ–‡ä»¶æ€»ä¼šè·Ÿç€ node_modules æ›´æ–° â€”â€” (å› æ­¤å¯ä»¥è§† package-lock æ–‡ä»¶ä¸º node_modules çš„ JSON è¡¨è¿°)
* å·²å®‰è£… node_modules åè‹¥æ‰§è¡Œ npm updateï¼Œpackage.json ä¸­çš„ç‰ˆæœ¬å·ä¹Ÿä¼šéšä¹‹æ›´æ”¹ä¸º ` ^1.15.0`

ç”±æ­¤å¯è§ npm 5.1 ä½¿å¾— package.json å’Œ package-lock.json ä¸­æ‰€ä¿å­˜çš„ç‰ˆæœ¬å·æ›´åŠ ç»Ÿä¸€ï¼Œè§£å†³äº† npm ä¹‹å‰çš„å„ç§é—®é¢˜ã€‚åªè¦éµå¾ªå¥½çš„å®è·µä¹ æƒ¯ï¼Œå›¢é˜Ÿæˆå‘˜å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç»´æŠ¤ä¸€å¥—åº”ç”¨ä»£ç å’Œ node_modules ä¾èµ–éƒ½ä¸€è‡´çš„ç¯å¢ƒã€‚

çš†å¤§æ¬¢å–œã€‚

### 4.3 æœ€ä½³å®è·µ ###

æ€»ç»“èµ·æ¥ï¼Œåœ¨ 2018 å¹´ (node 9.8.0, npm 5.7.1) æ—¶ä»£ï¼Œæˆ‘è®¤ä¸ºçš„ä¾èµ–ç‰ˆæœ¬ç®¡ç†åº”å½“æ˜¯:

* 

ä½¿ç”¨ npm: ` >=5.1` ç‰ˆæœ¬, ä¿æŒ ` package-lock.json` æ–‡ä»¶é»˜è®¤å¼€å¯é…ç½®

* 

åˆå§‹åŒ–ï¼šç¬¬ä¸€ä½œè€…åˆå§‹åŒ–é¡¹ç›®æ—¶ä½¿ç”¨ ` npm install <package>` å®‰è£…ä¾èµ–åŒ…, é»˜è®¤ä¿å­˜ ` ^X.Y.Z` ä¾èµ– range åˆ° package.jsonä¸­; æäº¤ ` package.json` , ` package-lock.json` , **ä¸è¦æäº¤** ` node_modules` ç›®å½•

* 

åˆå§‹åŒ–ï¼šé¡¹ç›®æˆå‘˜ **é¦–æ¬¡** checkout/clone é¡¹ç›®ä»£ç åï¼Œæ‰§è¡Œ **ä¸€æ¬¡** ` npm install` å®‰è£…ä¾èµ–åŒ…

* 

**ä¸è¦** æ‰‹åŠ¨ä¿®æ”¹ package-lock.json

* 

å‡çº§ä¾èµ–åŒ…:

* å‡çº§å°ç‰ˆæœ¬: æœ¬åœ°æ‰§è¡Œ ` npm update` å‡çº§åˆ°æ–°çš„å°ç‰ˆæœ¬
* å‡çº§å¤§ç‰ˆæœ¬: æœ¬åœ°æ‰§è¡Œ ` npm install <package-name>@<version>` å‡çº§åˆ°æ–°çš„å¤§ç‰ˆæœ¬
* ä¹Ÿå¯æ‰‹åŠ¨ä¿®æ”¹ package.json ä¸­ç‰ˆæœ¬å·ä¸ºè¦ **å‡çº§** çš„ç‰ˆæœ¬(å¤§äºç°æœ‰ç‰ˆæœ¬å·)å¹¶æŒ‡å®šæ‰€éœ€çš„ semver, ç„¶åæ‰§è¡Œ ` npm install`
* æœ¬åœ°éªŒè¯å‡çº§åæ–°ç‰ˆæœ¬æ— é—®é¢˜åï¼Œ **æäº¤** æ–°çš„ ` package.json` , ` package-lock.json` æ–‡ä»¶

* 

é™çº§ä¾èµ–åŒ…:

* **æ­£ç¡®** : ` npm install <package-name>@<old-version>` éªŒè¯æ— é—®é¢˜åï¼Œ **æäº¤** package.json å’Œ package-lock.json æ–‡ä»¶
* **é”™è¯¯** : æ‰‹åŠ¨ä¿®æ”¹ ` package.json` ä¸­çš„ç‰ˆæœ¬å·ä¸ºæ›´ä½ç‰ˆæœ¬çš„ semver, è¿™æ ·ä¿®æ”¹å¹¶ä¸ä¼šç”Ÿæ•ˆï¼Œå› ä¸ºå†æ¬¡æ‰§è¡Œ ` npm install` ä¾ç„¶ä¼šå®‰è£… ` package-lock.json` ä¸­çš„é”å®šç‰ˆæœ¬

* 

åˆ é™¤ä¾èµ–åŒ…:

* Plan A: ` npm uninstall <package>` å¹¶æäº¤ ` package.json` å’Œ ` package-lock.json`
* Plan B: æŠŠè¦å¸è½½çš„åŒ…ä» package.json ä¸­ dependencies å­—æ®µåˆ é™¤, ç„¶åæ‰§è¡Œ ` npm install` å¹¶æäº¤ ` package.json` å’Œ ` package-lock.json`

* 

ä»»ä½•æ—¶å€™æœ‰äººæäº¤äº† package.json, package-lock.json æ›´æ–°åï¼Œå›¢é˜Ÿå…¶ä»–æˆå‘˜åº”åœ¨ svn update/git pull æ‹‰å–æ›´æ–°åæ‰§è¡Œ ` npm install` è„šæœ¬å®‰è£…æ›´æ–°åçš„ä¾èµ–åŒ…

æ­å–œä½ ç»ˆäºå¯ä»¥è·Ÿ **` rm -rf node_modules` && ` npm install`** è¿™æ³¢æ“ä½œè¯´æ‹œæ‹œäº†ï¼ˆå…¶å®å¹¶ä¸ä¼šï¼‰

## 5. npm scripts ##

### 5.1 åŸºæœ¬ä½¿ç”¨ ###

npm scripts æ˜¯ npm å¦ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ã€‚é€šè¿‡åœ¨ package.json ä¸­ scripts å­—æ®µå®šä¹‰ä¸€ä¸ªè„šæœ¬ï¼Œä¾‹å¦‚ï¼š

` { "scripts" : { "echo" : "echo HELLO WORLD" } } å¤åˆ¶ä»£ç `

æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ ` npm run echo` å‘½ä»¤æ¥æ‰§è¡Œè¿™æ®µè„šæœ¬ï¼Œåƒåœ¨ shell ä¸­æ‰§è¡Œè¯¥å‘½ä»¤ ` echo HELLO WORLD` ä¸€æ ·ï¼Œçœ‹åˆ°ç»ˆç«¯è¾“å‡º ` HELLO WORLD`.

â€”â€” npm scripts çš„åŸºæœ¬ä½¿ç”¨å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç®€å•çš„æ¥å£ç”¨æ¥è°ƒç”¨å·¥ç¨‹ç›¸å…³çš„è„šæœ¬ã€‚å…³äºæ›´è¯¦ç»†çš„ç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒé˜®ä¸€å³°è€å¸ˆçš„æ–‡ç«  [npm script ä½¿ç”¨æŒ‡å— (2016å¹´10æœˆ)]( https://link.juejin.im?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2016%2F10%2Fnpm_scripts.html ).

ç®€è¦æ€»ç»“é˜®è€å¸ˆæ–‡ç« å†…å®¹ï¼š

* ` npm run` å‘½ä»¤æ‰§è¡Œæ—¶ï¼Œä¼šæŠŠ `./node_modules/.bin/` ç›®å½•æ·»åŠ åˆ°æ‰§è¡Œç¯å¢ƒçš„ ` PATH` å˜é‡ä¸­ï¼Œå› æ­¤å¦‚æœæŸä¸ª **å‘½ä»¤è¡ŒåŒ…** æœªå…¨å±€å®‰è£…ï¼Œè€Œåªå®‰è£…åœ¨äº†å½“å‰é¡¹ç›®çš„ node_modules ä¸­ï¼Œé€šè¿‡ ` npm run` ä¸€æ ·å¯ä»¥è°ƒç”¨è¯¥å‘½ä»¤ã€‚
* æ‰§è¡Œ npm è„šæœ¬æ—¶è¦ä¼ å…¥å‚æ•°ï¼Œéœ€è¦åœ¨å‘½ä»¤ååŠ  ` --` æ ‡æ˜, å¦‚ ` npm run test -- --grep="pattern"` å¯ä»¥å°† ` --grep="pattern"` å‚æ•°ä¼ ç»™ ` test` å‘½ä»¤
* npm æä¾›äº† pre å’Œ post ä¸¤ç§é’©å­æœºåˆ¶ï¼Œå¯ä»¥å®šä¹‰æŸä¸ªè„šæœ¬å‰åçš„æ‰§è¡Œè„šæœ¬
* è¿è¡Œæ—¶å˜é‡ï¼šåœ¨ ` npm run` çš„è„šæœ¬æ‰§è¡Œç¯å¢ƒå†…ï¼Œå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡çš„æ–¹å¼è·å–è®¸å¤šè¿è¡Œæ—¶ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¸‹éƒ½å¯ä»¥é€šè¿‡ ` process.env` å¯¹è±¡è®¿é—®è·å¾—ï¼š

* ` npm_lifecycle_event` - æ­£åœ¨è¿è¡Œçš„è„šæœ¬åç§°
* ` npm_package_<key>` - è·å–å½“å‰åŒ… package.json ä¸­æŸä¸ªå­—æ®µçš„é…ç½®å€¼ï¼šå¦‚ ` npm_package_name` è·å–åŒ…å
* ` npm_package_<key>_<sub-key>` - package.json ä¸­åµŒå¥—å­—æ®µå±æ€§ï¼šå¦‚ ` npm_pacakge_dependencies_webpack` å¯ä»¥è·å–åˆ° package.json ä¸­çš„ ` dependencies.webpack` å­—æ®µçš„å€¼ï¼Œå³ webpack çš„ç‰ˆæœ¬å·

### 5.2 node_modules/.bin ç›®å½• ###

ä¸Šé¢æ‰€è¯´çš„ ` node_modules/.bin` ç›®å½•ï¼Œä¿å­˜äº†ä¾èµ–ç›®å½•ä¸­æ‰€å®‰è£…çš„å¯ä¾›è°ƒç”¨çš„å‘½ä»¤è¡ŒåŒ…ã€‚

ä½•è°“å‘½ä»¤è¡ŒåŒ…ï¼Ÿä¾‹å¦‚ ` webpack` å°±å±äºä¸€ä¸ªå‘½ä»¤è¡ŒåŒ…ã€‚å¦‚æœæˆ‘ä»¬åœ¨å®‰è£… webpack æ—¶æ·»åŠ  ` --global` å‚æ•°ï¼Œå°±å¯ä»¥åœ¨ç»ˆç«¯ç›´æ¥è¾“å…¥ ` webpack` è¿›è¡Œè°ƒç”¨ã€‚ä½†å¦‚æœä¸åŠ  ` --global` å‚æ•°ï¼Œæˆ‘ä»¬ä¼šåœ¨ ` node_modules/.bin` ç›®å½•é‡Œçœ‹åˆ°åä¸º webpack çš„æ–‡ä»¶ï¼Œå¦‚æœåœ¨ç»ˆç«¯ç›´æ¥è¾“å…¥ `./node_modules/.bin/webpack` å‘½ä»¤ï¼Œä¸€æ ·å¯ä»¥æ‰§è¡Œã€‚

è¿™æ˜¯å› ä¸º ` webpack` åœ¨ ` package.json` æ–‡ä»¶ä¸­å®šä¹‰äº† ` bin` å­—æ®µä¸º:

` { "bin" : { "webpack" : "./bin/webpack.js" } } å¤åˆ¶ä»£ç `

bin å­—æ®µçš„é…ç½®æ ¼å¼ä¸º: ` <command>: <file>` , å³ ` å‘½ä»¤å: å¯æ‰§è¡Œæ–‡ä»¶`. npm æ‰§è¡Œ install æ—¶ï¼Œä¼šåˆ†ææ¯ä¸ªä¾èµ–åŒ…çš„ package.json ä¸­çš„ ` bin` å­—æ®µï¼Œå¹¶å°†å…¶åŒ…å«çš„æ¡ç›®å®‰è£…åˆ° `./node_modules/.bin` ç›®å½•ä¸­ï¼Œæ–‡ä»¶åä¸º ` <command>` ã€‚è€Œå¦‚æœæ˜¯å…¨å±€æ¨¡å¼å®‰è£…ï¼Œåˆ™ä¼šåœ¨ npm å…¨å±€å®‰è£…è·¯å¾„çš„ bin ç›®å½•ä¸‹åˆ›å»ºæŒ‡å‘ ` <file>` åä¸º ` <command>` çš„è½¯é“¾ã€‚å› æ­¤ï¼Œ `./node_modules/.bin/webpack` æ–‡ä»¶åœ¨é€šè¿‡å‘½ä»¤è¡Œè°ƒç”¨æ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨æ‰§è¡Œ ` node ./node_modules/.bin/webpack.js` å‘½ä»¤ã€‚

æ­£å¦‚ä¸Šä¸€èŠ‚æ‰€è¯´ï¼Œ ` npm run` å‘½ä»¤åœ¨æ‰§è¡Œæ—¶ä¼šæŠŠ `./node_modules/.bin` åŠ å…¥åˆ° ` PATH` ä¸­ï¼Œä½¿æˆ‘ä»¬å¯ç›´æ¥è°ƒç”¨æ‰€æœ‰æä¾›äº†å‘½ä»¤è¡Œè°ƒç”¨æ¥å£çš„ä¾èµ–åŒ…ã€‚æ‰€ä»¥è¿™é‡Œå°±å¼•å‡ºäº†ä¸€ä¸ªæœ€ä½³å®è·µï¼š

> 
> 
> 
> å°†é¡¹ç›®ä¾èµ–çš„å‘½ä»¤è¡Œå·¥å…·å®‰è£…åˆ°é¡¹ç›®ä¾èµ–æ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åé€šè¿‡ npm scripts è°ƒç”¨ï¼›è€Œéå…¨å±€å®‰è£…
> 
> 

ä¸¾ä¾‹è€Œè¨€ ` webpack` ä½œä¸ºå‰ç«¯å·¥ç¨‹æ ‡é…çš„æ„å»ºå·¥å…·ï¼Œè™½ç„¶æˆ‘ä»¬éƒ½ä¹ æƒ¯äº†å…¨å±€å®‰è£…å¹¶ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œè°ƒç”¨ï¼Œä½†ä¸åŒçš„é¡¹ç›®ä¾èµ–çš„ webpack ç‰ˆæœ¬å¯èƒ½ä¸åŒï¼Œç›¸åº”çš„ ` webpack.config.js` é…ç½®æ–‡ä»¶ä¹Ÿå¯èƒ½åªå…¼å®¹äº†ç‰¹å®šç‰ˆæœ¬çš„ webpack. å¦‚æœæˆ‘ä»¬ä»…å…¨å±€å®‰è£…äº†æœ€æ–°çš„ webpack 4.x å¹¶ä½¿ç”¨ webpack å‘½ä»¤è°ƒç”¨ï¼Œåœ¨ä¸€ä¸ªä¾èµ– webpack 3.x çš„å·¥ç¨‹ä¸­å°±ä¼šæ— æ³•æˆåŠŸæ‰§è¡Œæ„å»ºã€‚

ä½†å¦‚æœè¿™ç±»å·¥å…·æ€»æ˜¯æœ¬åœ°å®‰è£…ï¼Œæˆ‘ä»¬è¦è°ƒç”¨ä¸€ä¸ªå‘½ä»¤ï¼Œè¦æ‰‹åŠ¨æ·»åŠ  `./node_modules/.bin` è¿™ä¸ªé•¿é•¿çš„å‰ç¼€ï¼Œæœªå…ä¹Ÿå¤ªéº»çƒ¦äº†ï¼Œæˆ‘ä»¬ nodejs å¼€å‘è€…éƒ½å¾ˆæ‡’çš„ã€‚äºæ˜¯ npm ä»5.2 å¼€å§‹è‡ªå¸¦äº†ä¸€ä¸ªæ–°çš„å·¥å…· ` npx`.

### 5.3 npx ###

npx çš„ä½¿ç”¨å¾ˆç®€å•ï¼Œå°±æ˜¯æ‰§è¡Œ ` npx <command>` å³å¯ï¼Œè¿™é‡Œçš„ ` <command>` é»˜è®¤å°±æ˜¯ `./node_modules` ç›®å½•ä¸­å®‰è£…çš„å¯æ‰§è¡Œè„šæœ¬åã€‚ä¾‹å¦‚ä¸Šé¢æœ¬åœ°å®‰è£…å¥½çš„ webpack åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ ` npx webpack` æ‰§è¡Œå³å¯ã€‚

é™¤äº†è¿™ç§æœ€ç®€å•çš„åœºæ™¯, npm cli å›¢é˜Ÿå¼€å‘è€… Kat MarchÃ¡n è¿˜åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä»‹ç»äº†å…¶ä»–å‡ ç§ npx çš„ç¥å¥‡ç”¨æ³•: [Introducing npx: an npm package runner]( https://link.juejin.im?target=https%3A%2F%2Fbit.ly%2F2uzuIHv ) , å›½å†…æœ‰ä½å¼€å‘è€… robin.law å°†åŸæ–‡ç¿»è¯‘ä¸ºä¸­æ–‡ [npxæ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆéœ€è¦npx?]( https://link.juejin.im?target=https%3A%2F%2Frobin-front.github.io%2F2017%2F07%2F14%2Fintroducing-npx-an-npm-package-runner%2F ).

æœ‰å…´è¶£çš„å¯ä»¥æˆ³é“¾æ¥äº†è§£ï¼Œæ‡’å¾—ç‚¹é“¾æ¥çš„ï¼Œçœ‹æ€»ç»“ï¼š

#### åœºæ™¯a) ä¸€é”®æ‰§è¡Œè¿œç¨‹ npm æºçš„äºŒè¿›åˆ¶åŒ… ####

é™¤äº†åœ¨ package ä¸­æ‰§è¡Œ ./node_modules/.bin ä¸­å·²å®‰è£…çš„å‘½ä»¤, è¿˜å¯ä»¥ç›´æ¥æŒ‡å®šæœªå®‰è£…çš„äºŒè¿›åˆ¶åŒ…åæ‰§è¡Œã€‚ä¾‹å¦‚æˆ‘ä»¬åœ¨ä¸€ä¸ªæ²¡æœ‰ package.json ä¹Ÿæ²¡æœ‰ node_modules çš„ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ:

` npx cowsay hello å¤åˆ¶ä»£ç `

npx å°†ä¼šä» npm æºä¸‹è½½ ` cowsay` è¿™ä¸ªåŒ…ï¼ˆä½†å¹¶ä¸å®‰è£…ï¼‰å¹¶æ‰§è¡Œï¼š

` _______ < hello > ------- \ ^__^ \ (oo)\_______ (__)\ )\/\ ||----w | || || å¤åˆ¶ä»£ç `

è¿™ç§ç”¨é€”éå¸¸é€‚åˆ 1. åœ¨æœ¬åœ°ç®€å•æµ‹è¯•æˆ–è°ƒè¯• npm æºä¸Šè¿™äº›äºŒè¿›åˆ¶åŒ…çš„åŠŸèƒ½ï¼›2. è°ƒç”¨ create-react-app æˆ– yeoman è¿™ç±»å¾€å¾€æ¯ä¸ªé¡¹ç›®åªéœ€è¦ä½¿ç”¨ä¸€æ¬¡çš„è„šæ‰‹æ¶å·¥å…·

PS: æ­¤å¤„æœ‰å½©è›‹ï¼Œæ‰§è¡Œè¿™æ¡å‘½ä»¤è¯•è¯•:

` npx workin-hard å¤åˆ¶ä»£ç `

#### åœºæ™¯b) ä¸€é”®æ‰§è¡Œ GitHub Gist ####

è¿˜è®°å¾—å‰é¢æåˆ°çš„ [2.1 packageå®šä¹‰] ä¹ˆï¼Œ ` npm install <package>` å¯ä»¥æ˜¯åŒ…å«äº†æœ‰æ•ˆ package.json çš„ git url.

åˆšå¥½ GitHub Gist ä¹Ÿæ˜¯ git ä»“åº“ çš„ä¸€ç§ï¼Œé›†åˆ npx å°±å¯ä»¥æ–¹ä¾¿åœ°å°†ç®€å•çš„è„šæœ¬å…±äº«ç»™å…¶ä»–äººï¼Œæ‹¥æœ‰è¯¥é“¾æ¥çš„äººæ— éœ€å°†è„šæœ¬å®‰è£…åˆ°æœ¬åœ°å·¥ä½œç›®å½•å³å¯æ‰§è¡Œã€‚å°† package.json å’Œ éœ€æ‰§è¡Œçš„äºŒè¿›åˆ¶è„šæœ¬ä¸Šä¼ è‡³ gist, åœ¨è¿è¡Œ ` npx <gist url>` å°±å¯ä»¥æ–¹ä¾¿åœ°æ‰§è¡Œè¯¥ gist å®šä¹‰çš„å‘½ä»¤ã€‚

åŸæ–‡ä½œè€… Kat MarchÃ¡n æä¾›äº† [è¿™ä¸ª]( https://link.juejin.im?target=https%3A%2F%2Fgist.github.com%2Fzkat%2F4bc19503fe9e9309e2bfaa2c58074d32 ) ç¤ºä¾‹ gist, æ‰§è¡Œï¼š

` npx https://gist.github.com/zkat/4bc19503fe9e9309e2bfaa2c58074d32 å¤åˆ¶ä»£ç `

å¯å¾—åˆ°ä¸€ä¸ªæ¥è‡ª GitHubGist çš„ hello world é—®å€™ã€‚

#### åœºæ™¯c) ä½¿ç”¨ä¸åŒç‰ˆæœ¬ node æ‰§è¡Œå‘½ä»¤ ####

å°† npx ä¸ Aria Stewart åˆ›å»ºçš„ ` node` åŒ… (https://www.npmjs.com/package/node) ç»“åˆï¼Œå¯ä»¥å®ç°åœ¨ä¸€è¡Œå‘½ä»¤ä¸­ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„ node æ‰§è¡Œå‘½ä»¤ã€‚

ä¾‹å¦‚å…ˆåæ‰§è¡Œï¼š

` npx node@4 -e "console.log(process.version)" npx node@6 -e "console.log(process.version)" å¤åˆ¶ä»£ç `

å°†åˆ†åˆ«è¾“å‡º ` v4.8.7` å’Œ ` v6.13.0`.

å¾€å¸¸è¿™ç§å·¥ä½œæ˜¯ç”± ` nvm` è¿™ç±» node ç‰ˆæœ¬ç®¡ç†å·¥å…·æ¥åšçš„ï¼Œä½† ` npx node@4` è¿™ç§æ–¹å¼å…å» nvm æ‰‹åŠ¨åˆ‡æ¢é…ç½®çš„æ­¥éª¤ï¼Œæ›´åŠ ç®€æ´ç®€å•ã€‚

## 6. npm é…ç½® ##

### 6.1 npm config ###

npm cli æä¾›äº† ` npm config` å‘½ä»¤è¿›è¡Œ npm ç›¸å…³é…ç½®ï¼Œé€šè¿‡ ` npm config ls -l` å¯æŸ¥çœ‹ npm çš„æ‰€æœ‰é…ç½®ï¼ŒåŒ…æ‹¬é»˜è®¤é…ç½®ã€‚npm æ–‡æ¡£é¡µä¸ºæ¯ä¸ªé…ç½®é¡¹æä¾›äº†è¯¦ç»†çš„è¯´æ˜ https://docs.npmjs.com/misc/config .

ä¿®æ”¹é…ç½®çš„å‘½ä»¤ä¸º ` npm config set <key> <value>` , æˆ‘ä»¬ä½¿ç”¨ç›¸å…³çš„å¸¸è§é‡è¦é…ç½®:

* ` proxy` , ` https-proxy` : æŒ‡å®š npm ä½¿ç”¨çš„ä»£ç†
* ` registry` æŒ‡å®š npm ä¸‹è½½å®‰è£…åŒ…æ—¶çš„æºï¼Œé»˜è®¤ä¸º ` https://registry.npmjs.org/` å¯ä»¥æŒ‡å®šä¸ºç§æœ‰ Registry æº
* ` package-lock` æŒ‡å®šæ˜¯å¦é»˜è®¤ç”Ÿæˆ package-lock æ–‡ä»¶ï¼Œå»ºè®®ä¿æŒé»˜è®¤ true
* ` save` true/false æŒ‡å®šæ˜¯å¦åœ¨ npm install åä¿å­˜åŒ…ä¸º dependencies, npm 5 èµ·é»˜è®¤ä¸º true

åˆ é™¤æŒ‡å®šçš„é…ç½®é¡¹å‘½ä»¤ä¸º ` npm config delete <key>`.

### 6.2 npmrc æ–‡ä»¶ ###

é™¤äº†ä½¿ç”¨ CLI çš„ ` npm config` å‘½ä»¤æ˜¾ç¤ºæ›´æ”¹ npm é…ç½®ï¼Œè¿˜å¯ä»¥é€šè¿‡ npmrc æ–‡ä»¶ç›´æ¥ä¿®æ”¹é…ç½®ã€‚

è¿™æ ·çš„ npmrc æ–‡ä»¶ä¼˜å…ˆçº§ç”±é«˜åˆ°ä½åŒ…æ‹¬ï¼š

* å·¥ç¨‹å†…é…ç½®æ–‡ä»¶: ` /path/to/my/project/.npmrc`
* ç”¨æˆ·çº§é…ç½®æ–‡ä»¶: ` ~/.npmrc`
* å…¨å±€é…ç½®æ–‡ä»¶: ` $PREFIX/etc/npmrc` (å³ ` npm config get globalconfig` è¾“å‡ºçš„è·¯å¾„)
* npmå†…ç½®é…ç½®æ–‡ä»¶: ` /path/to/npm/npmrc`

é€šè¿‡è¿™ä¸ªæœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°åœ¨å·¥ç¨‹è·Ÿç›®å½•åˆ›å»ºä¸€ä¸ª `.npmrc` æ–‡ä»¶æ¥å…±äº«éœ€è¦åœ¨å›¢é˜Ÿé—´å…±äº«çš„ npm è¿è¡Œç›¸å…³é…ç½®ã€‚æ¯”å¦‚å¦‚æœæˆ‘ä»¬åœ¨å…¬å¸å†…ç½‘ç¯å¢ƒä¸‹éœ€é€šè¿‡ä»£ç†æ‰å¯è®¿é—® registry.npmjs.org æºï¼Œæˆ–éœ€è®¿é—®å†…ç½‘çš„ registry, å°±å¯ä»¥åœ¨å·¥ä½œé¡¹ç›®ä¸‹æ–°å¢ .npmrc æ–‡ä»¶å¹¶æäº¤ä»£ç åº“ã€‚

` proxy = http://proxy.example.com/ https-proxy = http://proxy.example.com/ registry = http://registry.example.com/ å¤åˆ¶ä»£ç `

å› ä¸ºé¡¹ç›®çº§ .npmrc æ–‡ä»¶çš„ä½œç”¨åŸŸåªåœ¨æœ¬é¡¹ç›®ä¸‹ï¼Œæ‰€ä»¥åœ¨éæœ¬ç›®å½•ä¸‹ï¼Œè¿™äº›é…ç½®å¹¶ä¸ç”Ÿæ•ˆã€‚å¯¹äºä½¿ç”¨ç¬”è®°æœ¬å·¥ä½œçš„å¼€å‘è€…ï¼Œå¯ä»¥å¾ˆå¥½åœ°éš”ç¦»å…¬å¸çš„å·¥ä½œé¡¹ç›®ã€åœ¨å®¶å­¦ä¹ ç ”ç©¶é¡¹ç›®ä¸¤ç§ä¸åŒçš„ç¯å¢ƒã€‚

å°†è¿™ä¸ªåŠŸèƒ½ä¸ ` ~/.npm-init.js` é…ç½®ç›¸ç»“åˆï¼Œå¯ä»¥å°†ç‰¹å®šé…ç½®çš„ .npmrc è·Ÿ .gitignore, README ä¹‹ç±»æ–‡ä»¶ä¸€èµ·åšåˆ° npm init è„šæ‰‹æ¶ä¸­ï¼Œè¿›ä¸€æ­¥å‡å°‘æ‰‹åŠ¨é…ç½®ã€‚

### 6.3 node ç‰ˆæœ¬çº¦æŸ ###

è™½ç„¶ä¸€ä¸ªé¡¹ç›®çš„å›¢é˜Ÿéƒ½å…±äº«äº†ç›¸åŒçš„ä»£ç ï¼Œä½†æ¯ä¸ªäººçš„å¼€å‘æœºå™¨å¯èƒ½å®‰è£…äº†ä¸åŒçš„ node ç‰ˆæœ¬ï¼Œæ­¤å¤–æœåŠ¡å™¨ç«¯çš„ä¹Ÿå¯èƒ½ä¸æœ¬åœ°å¼€å‘æœºä¸ä¸€è‡´ã€‚

è¿™åˆæ˜¯ä¸€ä¸ªå¯èƒ½å¸¦æ¥ä¸ä¸€è‡´æ€§çš„å› ç´  â€”â€” ä½†ä¹Ÿä¸æ˜¯å¾ˆéš¾è§£å†³ï¼Œå£°æ˜å¼çº¦æŸ+è„šæœ¬é™åˆ¶å³å¯ã€‚

**å£°æ˜** ï¼šé€šè¿‡ ` package.json` çš„ ` engines` å±æ€§å£°æ˜åº”ç”¨è¿è¡Œæ‰€éœ€çš„ç‰ˆæœ¬è¿è¡Œæ—¶è¦æ±‚ã€‚ä¾‹å¦‚æˆ‘ä»¬çš„é¡¹ç›®ä¸­ä½¿ç”¨äº† ` async` , ` await` ç‰¹æ€§ï¼Œ [æŸ¥é˜…å…¼å®¹æ€§è¡¨æ ¼]( https://link.juejin.im?target=https%3A%2F%2Fnode.green ) å¾—çŸ¥æœ€ä½æ”¯æŒç‰ˆæœ¬ä¸º 7.6.0ï¼Œå› æ­¤æŒ‡å®š engines é…ç½®ä¸º:

` { "engines" : { "node" : ">=7.6.0" } } å¤åˆ¶ä»£ç `

**å¼ºçº¦æŸ** (å¯é€‰)ï¼šåœ¨ npm ä¸­ä»¥ä¸Šå­—æ®µå†…å®¹ä»…ä½œä¸ºå»ºè®®å­—æ®µä½¿ç”¨ï¼Œè‹¥è¦åœ¨ç§æœ‰é¡¹ç›®ä¸­æ·»åŠ å¼ºçº¦æŸï¼Œéœ€è¦è‡ªå·±å†™è„šæœ¬é’©å­ï¼Œè¯»å–å¹¶è§£æ engines å­—æ®µçš„ semver range å¹¶ä¸è¿è¡Œæ—¶ç¯å¢ƒåšå¯¹æ¯”æ ¡éªŒå¹¶é€‚å½“æé†’ã€‚

## 7. å°ç»“ npm æœ€ä½³å®è·µ ##

* ä½¿ç”¨ npm-init åˆå§‹åŒ–æ–°é¡¹ç›®
* ç»Ÿä¸€é¡¹ç›®é…ç½®: éœ€å›¢é˜Ÿå…±äº«çš„ npm config é…ç½®é¡¹ï¼Œå›ºåŒ–åˆ° .npmrc æ–‡ä»¶ä¸­
* ç»Ÿä¸€è¿è¡Œç¯å¢ƒï¼Œç»Ÿä¸€ package.jsonï¼Œç»Ÿä¸€ package-lock æ–‡ä»¶
* åˆç†ä½¿ç”¨å¤šæ ·åŒ–çš„æºå®‰è£…ä¾èµ–åŒ…: ` npm install <git url>|<local file>`
* ä½¿ç”¨ npm: >=5.2 ç‰ˆæœ¬
* ä½¿ç”¨ npm scripts ä¸ npx (npm: >=5.2) è„šæœ¬ç®¡ç†åº”ç”¨ç›¸å…³è„šæœ¬

## 8. æ›´å¤šèµ„æ–™ ##

**å‚è€ƒ**

* npm team æˆå‘˜ Ashley Williams åœ¨ 2016 å¹´ Node.js Live ä¸Šçš„ talk: You Don't Know npm , å½“æ—¶è¿˜æ²¡æœ‰ npm 5

* YouTube è§†é¢‘é“¾æ¥: [Node.js Live (Paris) - Ashley Williams, You Don't Know npm]( https://link.juejin.im?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DhopWbVKmiVQ%26amp%3Bt%3D537s )
* æ¼”è®²ç”¨çš„ slides: [the ag_deck]( https://link.juejin.im?target=http%3A%2F%2Fashleygwilliams.github.io%2Fyou-dont-know-npm )

* è¿™ç¯‡ 2015 å¹´çš„æ–‡ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨æŠŠæœ¬åœ°æ¨¡å—æ‰“åŒ…åˆ° node_modules ä¾èµ–ä¸­: [Build modular application with npm local modules]( https://link.juejin.im?target=https%3A%2F%2Fbit.ly%2F2DLnaCd )
* ä¸€ç¯‡å¾ˆå¥½çš„ä»‹ç» package-lock.json çš„æ–‡ç« : [Everything you wanted to know about package-lock.json]( https://link.juejin.im?target=https%3A%2F%2Fbit.ly%2F2Fiok9Z )
* é˜®ä¸€å³° [npm scripts ä½¿ç”¨æŒ‡å—]( https://link.juejin.im?target=http%3A%2F%2Fruanyifeng.com%2Fblog%2F2016%2F10%2Fnpm_scripts.html )
* Kat MarchÃ¡n ä»‹ç»npx:

* åŸæ–‡ [Introducing npx: an npm package runner]( https://link.juejin.im?target=http%3A%2F%2Ft.cn%2FRKIYHBA )
* ä¸­æ–‡ [npxæ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆéœ€è¦npx?]( https://link.juejin.im?target=https%3A%2F%2Frobin-front.github.io%2F2017%2F07%2F14%2Fintroducing-npx-an-npm-package-runner%2F )

**æ–‡æ¡£**

* npm å®˜æ–¹æ–‡æ¡£, æ— ä¸­æ–‡ç¿»è¯‘

* [package.json æ–‡ä»¶]( https://link.juejin.im?target=https%3A%2F%2Fdocs.npmjs.com%2Ffiles%2Fpackage.json )
* [npm config é…ç½®]( https://link.juejin.im?target=https%3A%2F%2Fdocs.npmjs.com%2Fmisc%2Fconfig )
* [npm semver è®¡ç®—å™¨]( https://link.juejin.im?target=https%3A%2F%2Fsemver.npmjs.com )
* [node_modules ç›®å½•æ‰å¹³åŒ–]( https://link.juejin.im?target=https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Finstall )

* yarn ä¸­æ–‡æ–‡æ¡£ï¼Œè™½ç„¶æ˜¯ npm ç«äº‰è€…ä½†å…¼å®¹ package.json å’Œ node_modules ç›®å½•ï¼Œå› æ­¤è¿™ä¸¤éƒ¨åˆ†ä¸€æ ·å¯å‚è€ƒï¼š

* [package.json - ä¸­æ–‡]( https://link.juejin.im?target=https%3A%2F%2Fyarnpkg.com%2Fzh-Hans%2Fdocs%2Fpackage-json )
* [ä¾èµ–ä¸ç‰ˆæœ¬ - ä¸­æ–‡]( https://link.juejin.im?target=https%3A%2F%2Fyarnpkg.com%2Fzh-Hans%2Fdocs%2Fdependencies )

**å»¶ä¼¸é˜…è¯»**

* sam boyer ã€Šæ‰€ä»¥ä½ æƒ³å¼€å‘ä¸€ä¸ªåŒ…ç®¡ç†ç³»ç»Ÿã€‹ï¼Œä»æ— å…³ç‰¹å®šè¯­è¨€çš„è§’åº¦ï¼Œä»‹ç»ä¸€ä¸ªåŒ…ç®¡ç†ç³»ç»Ÿçš„æ–¹æ–¹é¢é¢:  [So you want to write a package manager]( https://link.juejin.im?target=https%3A%2F%2Fbit.ly%2F2G36U1e )