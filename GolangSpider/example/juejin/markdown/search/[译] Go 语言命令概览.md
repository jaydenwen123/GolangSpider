# [è¯‘] Go è¯­è¨€å‘½ä»¤æ¦‚è§ˆ #

> 
> 
> 
> * åŸæ–‡åœ°å€ï¼š [An Overview of Go's Tooling](
> https://link.juejin.im?target=https%3A%2F%2Fwww.alexedwards.net%2Fblog%2Fan-overview-of-go-tooling
> )
> * åŸæ–‡ä½œè€…ï¼š [Alex Edwards](
> https://link.juejin.im?target=https%3A%2F%2Fwww.alexedwards.net%2F )
> * è¯‘æ–‡å‡ºè‡ªï¼š [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fxitu%2Fgold-miner
> )
> * æœ¬æ–‡æ°¸ä¹…é“¾æ¥ï¼š [github.com/xitu/gold-mâ€¦](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fxitu%2Fgold-miner%2Fblob%2Fmaster%2FTODO1%2Fan-overview-of-go-tooling.md
> )
> * è¯‘è€…ï¼š [iceytea](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Ficeytea )
> * æ ¡å¯¹è€…ï¼š [jianboy](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fjianboy ) , [cyril](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fshixi-li )
> 
> 
> 

æˆ‘å¶å°”ä¼šè¢«äººé—®åˆ°ï¼š **â€œä½ ä¸ºä»€ä¹ˆå–œæ¬¢ä½¿ç”¨ Go è¯­è¨€ï¼Ÿâ€** æˆ‘ç»å¸¸ä¼šæåˆ°çš„å°±æ˜¯ ` go` å·¥å…·å‘½ä»¤ï¼Œå®ƒæ˜¯ä¸è¯­è¨€ä¸€åŒå­˜åœ¨çš„ä¸€éƒ¨åˆ†ã€‚æœ‰ä¸€äº›å‘½ä»¤ â€”â€” æ¯”å¦‚ ` go fmt` å’Œ ` go build` â€”â€” æˆ‘æ¯å¤©éƒ½ä¼šç”¨åˆ°ï¼Œè¿˜æœ‰ä¸€äº›å‘½ä»¤ â€”â€” å°±åƒ ` go tool pprof` â€”â€” æˆ‘ç”¨å®ƒä»¬è§£å†³ç‰¹å®šçš„é—®é¢˜ã€‚ä½†åœ¨æ‰€æœ‰çš„åœºæ™¯ä¸‹ï¼Œæˆ‘éƒ½å¾ˆæ„Ÿè°¢ go å‘½ä»¤è®©æˆ‘çš„é¡¹ç›®ç®¡ç†å’Œç»´æŠ¤å˜å¾—æ›´åŠ å®¹æ˜“ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å¸Œæœ›æä¾›ä¸€äº›å…³äºæˆ‘è®¤ä¸ºæœ€æœ‰ç”¨çš„å‘½ä»¤çš„èƒŒæ™¯å’Œä¸Šä¸‹æ–‡ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œè§£é‡Šå®ƒä»¬å¦‚ä½•é€‚åº”å…¸å‹é¡¹ç›®çš„å·¥ä½œæµç¨‹ã€‚å¦‚æœä½ åˆšåˆšæ¥è§¦ Go è¯­è¨€ï¼Œæˆ‘å¸Œæœ›è¿™æ˜¯ä¸€ä¸ªè‰¯å¥½çš„å¼€ç«¯ã€‚

å¦‚æœä½ ä½¿ç”¨ Go è¯­è¨€å·²ç»æœ‰ä¸€æ®µæ—¶é—´ï¼Œè¿™ç¯‡æ–‡ç« å¯èƒ½ä¸é€‚åˆä½ ï¼Œä½†åŒæ ·å¸Œæœ›ä½ èƒ½åœ¨è¿™é‡Œå‘ç°ä¹‹å‰ä¸äº†è§£çš„å‘½ä»¤å’Œå‚æ•°ğŸ˜€

æœ¬æ–‡ä¸­çš„ä¿¡æ¯æ˜¯é’ˆå¯¹ Go 1.12 ç¼–å†™çš„ï¼Œå¹¶å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª [module-enabled]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fwiki%2FModules%23quick-start ) çš„é¡¹ç›®ã€‚

## å®‰è£…å‘½ä»¤ ##

è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä¸»è¦å…³æ³¨ go å‘½ä»¤è¿™éƒ¨åˆ†ã€‚ä½†è¿™é‡Œä¹Ÿå°†æåˆ°ä¸€äº›ä¸å±äº Go 1.12 æ ‡å‡†å‘è¡Œç‰ˆçš„å†…å®¹ã€‚

å½“ä½ åœ¨ Go 1.12 ç‰ˆæœ¬ä¸‹å®‰è£…å‘½ä»¤æ—¶ï¼Œä½ é¦–å…ˆéœ€è¦ç¡®ä¿å½“å‰åœ¨ module-enabled çš„ç›®å½• **ä¹‹å¤–** ï¼ˆæˆ‘é€šå¸¸è·³è½¬åˆ° ` /tmp` ç›®å½•ä¸‹ï¼‰ã€‚ä¹‹åä½ å¯ä»¥ä½¿ç”¨ ` GO111MODULE=on go get` å‘½ä»¤æ¥å®‰è£…ã€‚ä¾‹å¦‚ï¼š

` $ cd /tmp $ GO111MODULE=on go get golang.org/x/tools/cmd/stress å¤åˆ¶ä»£ç `

è¿™æ¡å‘½ä»¤å°†ä¼šä¸‹è½½ç›¸å…³çš„åŒ…å’Œä¾èµ–é¡¹ã€æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶å°†å®ƒæ·»åŠ åˆ°ä½ è®¾ç½®çš„ ` GOBIN` ç›®å½•ä¸‹ã€‚å¦‚æœä½ æ²¡æœ‰æ˜¾å¼è®¾å®š ` GOBIN` ç›®å½•ï¼Œå¯æ‰§è¡Œæ–‡ä»¶å°†ä¼šè¢«æ·»åŠ åˆ° ` GOPATH/bin` ç›®å½•ä¸‹ã€‚ä½†æ— è®ºå“ªç§æ–¹å¼ï¼Œä½ éƒ½åº”å½“ç¡®ä¿ç³»ç»Ÿè·¯å¾„ä¸Šæœ‰å¯¹åº”çš„ç›®å½•ã€‚

æ³¨æ„ï¼šè¿™ä¸ªè¿‡ç¨‹æœ‰äº›ç¬¨æ‹™ï¼Œå¸Œæœ›èƒ½åœ¨å°†æ¥çš„ Go ç‰ˆæœ¬ä¸­æœ‰æ‰€æ”¹è¿›ã€‚ä½ å¯ä»¥åœ¨ [Issue 30515]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fissues%2F30515 ) è·Ÿè¸ªæœ‰å…³æ­¤é—®é¢˜çš„è®¨è®ºã€‚

## æŸ¥çœ‹ç¯å¢ƒä¿¡æ¯ ##

ä½ å¯ä»¥ä½¿ç”¨ ` go env` å‘½ä»¤æ˜¾ç¤ºå½“å‰ Go å·¥ä½œç¯å¢ƒã€‚å¦‚æœä½ åœ¨ä¸ç†Ÿæ‚‰çš„è®¡ç®—æœºä¸Šå·¥ä½œï¼Œè¿™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚

` $ go env GOARCH="amd64" GOBIN="" GOCACHE="/home/alex/.cache/go-build" GOEXE="" GOFLAGS="" GOHOSTARCH="amd64" GOHOSTOS="linux" GOOS="linux" GOPATH="/home/alex/go" GOPROXY="" GORACE="" GOROOT="/usr/local/go" GOTMPDIR="" GOTOOLDIR="/usr/local/go/pkg/tool/linux_amd64" GCCGO="gccgo" CC="gcc" CXX="g++" CGO_ENABLED="1" GOMOD="" CGO_CFLAGS="-g -O2" CGO_CPPFLAGS="" CGO_CXXFLAGS="-g -O2" CGO_FFLAGS="-g -O2" CGO_LDFLAGS="-g -O2" PKG_CONFIG="pkg-config" GOGCCFLAGS="-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build245740092=/tmp/go-build -gno-record-gcc-switches" å¤åˆ¶ä»£ç `

å¦‚æœä½ å¯¹æŸäº›ç‰¹å®šå€¼æ„Ÿå…´è¶£ï¼Œåˆ™å¯ä»¥å°†è¿™äº›å€¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™ ` go env` ã€‚ä¾‹å¦‚ï¼š

` $ go env GOPATH GOOS GOARCH /home/alex/go linux amd64 å¤åˆ¶ä»£ç `

è¦æ˜¾ç¤º ` go env` å‘½ä»¤çš„æ‰€æœ‰å˜é‡å’Œå€¼çš„å†…å®¹ï¼Œä½ å¯ä»¥è¿è¡Œï¼š

` $ go help environment å¤åˆ¶ä»£ç `

## å¼€å‘ ##

### è¿è¡Œä»£ç  ###

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç”¨ ` go run` å‘½ä»¤æ‰§è¡Œä»£ç ååˆ†æ–¹ä¾¿ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç¼–è¯‘ä»£ç çš„å¿«æ·æ–¹å¼ï¼Œåœ¨ ` /tmp` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä¸€æ­¥è¿è¡Œå®ƒã€‚

` $ go run . # è¿è¡Œå½“å‰ç›®å½•ä¸‹çš„åŒ… $ go run ./cmd/foo # è¿è¡Œ ./cmd/foo ç›®å½•ä¸‹çš„åŒ… å¤åˆ¶ä»£ç `

æ³¨æ„ï¼šåœ¨ Go 1.11 ç‰ˆæœ¬ï¼Œå½“ä½ æ‰§è¡Œ ` go run` å‘½ä»¤æ—¶ï¼Œä½ å¯ä»¥ [ä¼ å…¥åŒ…çš„è·¯å¾„]( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fdoc%2Fgo1.11%23run ) ï¼Œå°±åƒæˆ‘ä»¬ä¸Šé¢æåˆ°çš„é‚£æ ·ã€‚è¿™æ„å‘³ç€ä¸å†éœ€è¦ä½¿ç”¨åƒ ` go run *.go` è¿™æ ·åŒ…å«é€šé…ç¬¦æ‰©å±•çš„å˜é€šæ–¹æ³•è¿è¡Œå¤šä¸ªæ–‡ä»¶ã€‚æˆ‘éå¸¸å–œæ¬¢è¿™ä¸ªæ”¹è¿›ã€‚

### è·å–ä¾èµ–å…³ç³» ###

å‡è®¾ä½ å·²ç» [å¯ç”¨äº†æ¨¡å—]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fwiki%2FModules%23quick-start ) ï¼Œé‚£å½“ä½ è¿è¡Œ ` go run` ã€ ` go test` æˆ–è€… ` go build` ç±»ä¼¼çš„å‘½ä»¤æ—¶ï¼Œæ‰€æœ‰å¤–éƒ¨ä¾èµ–é¡¹å°†ä¼šè‡ªåŠ¨ï¼ˆæˆ–é€’å½’ï¼‰ä¸‹è½½ï¼Œä»¥å®ç°ä»£ç ä¸­çš„ ` import` è¯­å¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ä¸‹è½½ä¾èµ–é¡¹çš„æœ€æ–° tagï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨çš„ tagï¼Œåˆ™ä½¿ç”¨æœ€æ–°æäº¤çš„ä¾èµ–é¡¹ã€‚

å¦‚æœä½ äº‹å…ˆçŸ¥é“éœ€è¦ç‰¹å®šç‰ˆæœ¬çš„ä¾èµ–é¡¹ï¼ˆè€Œä¸æ˜¯ Go é»˜è®¤è·å–çš„ä¾èµ–é¡¹ï¼‰ï¼Œåˆ™å¯ä»¥åœ¨ä½¿ç”¨ ` go get` åŒæ—¶å¸¦ä¸Šç›¸å…³ç‰ˆæœ¬å·æˆ– commit hashã€‚ä¾‹å¦‚ï¼š

` $ go get github.com/foo/bar@v1.2.3 $ go get github.com/foo/bar@8e1b8d3 å¤åˆ¶ä»£ç `

å¦‚æœè·å–åˆ°çš„ä¾èµ–é¡¹åŒ…å«ä¸€ä¸ª ` go.mod` æ–‡ä»¶ï¼Œé‚£ä¹ˆ **å®ƒçš„ä¾èµ–é¡¹** å°†ä¸ä¼šåˆ—åœ¨ **ä½ çš„** ` go.mod` æ–‡ä»¶ä¸­ã€‚ç›¸åï¼Œå¦‚æœä½ æ­£åœ¨ä¸‹è½½çš„ä¾èµ–é¡¹ä¸åŒ…å« ` go.mod` æ–‡ä»¶ï¼Œé‚£ä¹ˆå®ƒçš„ä¾èµ–é¡¹ **å°†ä¼š** åœ¨ä½ çš„ ` go.mod` æ–‡ä»¶ä¸­åˆ—å‡ºï¼Œå¹¶ä¸”ä¼šä¼´éšç€ä¸€ä¸ª ` //indirect` æ³¨é‡Šã€‚

è¿™å°±æ„å‘³ç€ä½ çš„ ` go.mod` æ–‡ä»¶ä¸ä¸€å®šä¼šåœ¨ä¸€ä¸ªåœ°æ–¹æ˜¾ç¤ºé¡¹ç›®çš„æ‰€æœ‰ä¾èµ–é¡¹ï¼Œä½†æ˜¯ä½ å¯ä»¥ä½¿ç”¨ ` go list` å·¥å…·æŸ¥çœ‹å®ƒä»¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

` $ go list -m all å¤åˆ¶ä»£ç `

æœ‰æ—¶å€™ä½ å¯èƒ½ä¼šæƒ³çŸ¥é“**ä¸ºä»€ä¹ˆå®ƒæ˜¯ä¸€ä¸ªä¾èµ–ï¼Ÿ**ä½ å¯ä»¥ä½¿ç”¨ ` go mod why` å‘½ä»¤å›ç­”è¿™ä¸ªé—®é¢˜ã€‚è¿™æ¡å‘½ä»¤ä¼šæ˜¾ç¤ºä»ä¸»æ¨¡å—çš„åŒ…åˆ°ç»™å®šä¾èµ–é¡¹çš„æœ€çŸ­è·¯å¾„ã€‚ä¾‹å¦‚ï¼š

` $ go mod why -m golang.org/x/sys # golang.org/x/sys github.com/alexedwards/argon2id golang.org/x/crypto/argon2 golang.org/x/sys/cpu å¤åˆ¶ä»£ç `

æ³¨æ„ï¼š ` go mod why` å‘½ä»¤å°†è¿”å›å¤§å¤šæ•°ï¼ˆä½†ä¸æ˜¯æ‰€æœ‰ä¾èµ–é¡¹ï¼‰çš„åº”ç­”ã€‚ä½ å¯ä»¥åœ¨ [Issue 27900]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fissues%2F27900 ) è·Ÿè¸ªè¿™ä¸ªé—®é¢˜ã€‚

å¦‚æœä½ å¯¹åˆ†æåº”ç”¨ç¨‹åºçš„ä¾èµ–å…³ç³»æˆ–å°†å…¶å¯è§†åŒ–æ„Ÿå…´è¶£ï¼Œä½ å¯èƒ½è¿˜æƒ³æŸ¥çœ‹ ` go mod graph` å·¥å…·ã€‚åœ¨ [è¿™é‡Œ]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fgo-modules-by-example%2Findex%2Ftree%2Fmaster%2F018_go_list_mod_graph_why ) æœ‰ä¸€ä¸ªå¾ˆæ£’çš„ç”Ÿæˆå¯è§†åŒ–ä¾èµ–å…³ç³»çš„æ•™ç¨‹å’Œç¤ºä¾‹ä»£ç ã€‚

æœ€åï¼Œä¸‹è½½çš„ä¾èµ–é¡¹å­˜å‚¨åœ¨ä½äº ` GOPATH/pkg/mod` çš„ **æ¨¡å—ç¼“å­˜** ä¸­ã€‚å¦‚æœä½ éœ€è¦æ¸…é™¤æ¨¡å—ç¼“å­˜ï¼Œå¯ä»¥ä½¿ç”¨ ` go clean` å·¥å…·ã€‚ä½†è¯·æ³¨æ„ï¼šè¿™å°†åˆ é™¤è®¡ç®—æœºä¸Š **æ‰€æœ‰é¡¹ç›®** çš„å·²ä¸‹è½½ä¾èµ–é¡¹ã€‚

` $ go clean -modcache å¤åˆ¶ä»£ç `

### é‡æ„ä»£ç  ###

ä½ å¯èƒ½ç†Ÿæ‚‰ä½¿ç”¨ ` gofmt` å·¥å…·ã€‚å®ƒå¯ä»¥è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼Œä½†æ˜¯å®ƒä¹Ÿæ”¯æŒå» **é‡å†™è§„åˆ™** ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥å¸®åŠ©é‡æ„ä»£ç ã€‚æˆ‘å°†åœ¨ä¸‹é¢è¯æ˜è¿™ä¸€ç‚¹ã€‚

å‡è®¾ä½ æœ‰ä»¥ä¸‹ä»£ç ï¼Œä½ å¸Œæœ›å°† ` foo` å˜é‡æ›´æ”¹ä¸º ` Foo` ï¼Œä»¥ä¾¿å°†å…¶å¯¼å‡ºã€‚

` var foo int func bar () { foo = 1 fmt.Println( "foo" ) } å¤åˆ¶ä»£ç `

è¦å®ç°è¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥ä½¿ç”¨ ` gofmt` çš„ ` -r` å‚æ•°å®ç°é‡å†™è§„åˆ™ï¼Œ ` -d` å‚æ•°æ˜¾ç¤ºæ›´æ”¹å·®å¼‚ï¼Œ ` -w` å‚æ•°å®ç° **å°±åœ°** æ›´æ”¹ï¼Œåƒè¿™æ ·ï¼š

` $ gofmt -d -w -r 'foo -> Foo'. -var foo int +var Foo int func bar() { - foo = 1 + Foo = 1 fmt.Println("foo") } å¤åˆ¶ä»£ç `

æ³¨æ„åˆ°è¿™æ¯”å•çº¯çš„æŸ¥æ‰¾å’Œæ›¿æ¢æ›´æ™ºèƒ½äº†å—ï¼Ÿ ` foo` å˜é‡å·²è¢«æ›´æ”¹ï¼Œä½† ` fmt.Println()` è¯­å¥ä¸­çš„ ` "foo"` å­—ç¬¦ä¸²æ²¡æœ‰è¢«æ›¿æ¢ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ ` gofmt` å‘½ä»¤æ˜¯é€’å½’å·¥ä½œçš„ï¼Œå› æ­¤ä¸Šé¢çš„å‘½ä»¤ä¼šåœ¨å½“å‰ç›®å½•å’Œå­ç›®å½•ä¸­çš„æ‰€æœ‰ ` *.go` æ–‡ä»¶ä¸Šæ‰§è¡Œã€‚

å¦‚æœä½ æƒ³ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘å»ºè®®ä½ é¦–å…ˆä¸å¸¦ ` -w` å‚æ•°è¿è¡Œé‡å†™è§„åˆ™ï¼Œå¹¶å…ˆæ£€æŸ¥å·®å¼‚ï¼Œä»¥ç¡®ä¿ä»£ç çš„æ›´æ”¹å¦‚ä½ æ‰€æ„¿ã€‚

è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç¨å¤æ‚çš„ä¾‹å­ã€‚å‡è®¾ä½ è¦æ›´æ–°ä»£ç ï¼Œä»¥ä½¿ç”¨æ–°çš„ Go 1.12 ç‰ˆæœ¬ä¸­æºå¸¦çš„ [strings.ReplaceAll()]( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fpkg%2Fstrings%2F%23ReplaceAll ) æ–¹æ³•æ›¿æ¢æ‰ä¹‹å‰çš„ [strings.Replace()]( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fpkg%2Fstrings%2F%23Replace ) æ–¹æ³•ã€‚è¦è¿›è¡Œæ­¤æ›´æ”¹ï¼Œä½ å¯ä»¥è¿è¡Œï¼š

` $ gofmt -w -r 'strings.Replace(a, b, c, -1) -> strings.ReplaceAll(a, b, c)'. å¤åˆ¶ä»£ç `

åœ¨é‡å†™è§„åˆ™ä¸­ï¼Œå•ä¸ªå°å†™å­—ç¬¦ç”¨ä½œåŒ¹é…ä»»æ„è¡¨è¾¾å¼çš„é€šé…ç¬¦ï¼Œè¿™äº›è¢«åŒ¹é…åˆ°çš„è¡¨è¾¾å¼å°†ä¼šè¢«æ›¿æ¢ã€‚

### æŸ¥çœ‹ Go æ–‡æ¡£ ###

ä½ å¯ä»¥ä½¿ç”¨ ` go doc` å·¥å…·ï¼Œåœ¨ç»ˆç«¯ä¸­æŸ¥çœ‹æ ‡å‡†åº“çš„æ–‡æ¡£ã€‚æˆ‘ç»å¸¸åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨å®ƒæ¥å¿«é€ŸæŸ¥è¯¢æŸäº›ä¸œè¥¿ â€”â€” æ¯”å¦‚ç‰¹å®šåŠŸèƒ½çš„åç§°æˆ–ç­¾åã€‚æˆ‘è§‰å¾—è¿™æ¯”æµè§ˆ [ç½‘é¡µæ–‡æ¡£]( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fpkg ) æ›´å¿«ï¼Œè€Œä¸”å®ƒå¯ä»¥ç¦»çº¿æŸ¥é˜…ã€‚

` $ go doc strings # æŸ¥çœ‹ string åŒ…çš„ç®€ç•¥ç‰ˆæ–‡æ¡£ $ go doc -all strings # æŸ¥çœ‹ string åŒ…çš„å®Œæ•´ç‰ˆæ–‡æ¡£ $ go doc strings.Replace # æŸ¥çœ‹ strings.Replace å‡½æ•°çš„æ–‡æ¡£ $ go doc sql.DB # æŸ¥çœ‹ database/sql.DB ç±»å‹çš„æ–‡æ¡£ $ go doc sql.DB.Query # æŸ¥çœ‹ database/sql.DB.Query æ–¹æ³•çš„æ–‡æ¡£ å¤åˆ¶ä»£ç `

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ ` -src` å‚æ•°æ¥å±•ç¤ºç›¸å…³çš„ Go æºç ã€‚ä¾‹å¦‚ï¼š

` $ go doc -src strings.Replace # æŸ¥çœ‹ strings.Replace å‡½æ•°çš„æºç  å¤åˆ¶ä»£ç `

## æµ‹è¯• ##

### è¿è¡Œæµ‹è¯• ###

ä½ å¯ä»¥ä½¿ç”¨ ` go test` å·¥å…·æµ‹è¯•é¡¹ç›®ä¸­çš„ä»£ç ï¼Œåƒè¿™æ ·ï¼š

` $ go test. # è¿è¡Œå½“å‰ç›®å½•ä¸‹çš„å…¨éƒ¨æµ‹è¯• $ go test./... # è¿è¡Œå½“å‰ç›®å½•å’Œå­ç›®å½•ä¸‹çš„å…¨éƒ¨æµ‹è¯• $ go test./foo/bar # è¿è¡Œ ./foo/bar ç›®å½•ä¸‹çš„å…¨éƒ¨æµ‹è¯• å¤åˆ¶ä»£ç `

æˆ‘ä¼šåœ¨è¿è¡Œæµ‹è¯•æ—¶å¯ç”¨ Go çš„ [ç«äº‰æ£€æµ‹å™¨]( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fdoc%2Farticles%2Frace_detector.html ) ï¼Œè¿™å¯ä»¥å¸®åŠ©æˆ‘æ‰¾åˆ°åœ¨å®é™…ä½¿ç”¨ä¸­å¯èƒ½å‡ºç°çš„ä¸€äº›æ•°æ®ç«äº‰æƒ…å†µã€‚å°±åƒè¿™æ ·ï¼š

` $ go test -race ./... å¤åˆ¶ä»£ç `

è¿™é‡Œæœ‰å¾ˆé‡è¦çš„ä¸€ç‚¹è¦ç‰¹åˆ«æ³¨æ„ï¼Œå¯ç”¨ç«äº‰æ£€æµ‹å°†å¢åŠ æµ‹è¯•çš„æ€»ä½“è¿è¡Œæ—¶é—´ã€‚å› æ­¤ï¼Œå¦‚æœä½ ç»å¸¸åœ¨ TDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰å·¥ä½œæµä¸­è¿è¡Œæµ‹è¯•ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨æ­¤æ–¹æ³•è¿›è¡Œé¢„æäº¤æµ‹è¯•è¿è¡Œã€‚

ä» 1.10 ç‰ˆæœ¬èµ·ï¼ŒGo åœ¨åŒ…çº§åˆ« [ç¼“å­˜æµ‹è¯•ç»“æœ]( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fdoc%2Fgo1.10%23test ) ã€‚å¦‚æœä¸€ä¸ªåŒ…åœ¨æµ‹è¯•è¿è¡ŒæœŸé—´æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œå¹¶ä¸”ä½ æ­£åœ¨ä½¿ç”¨ç›¸åŒçš„ã€å¯ç¼“å­˜çš„ ` go test` å·¥å…·ï¼Œé‚£ä¹ˆå°†ä¼šå±•ç¤ºç¼“å­˜çš„æµ‹è¯•ç»“æœï¼Œå¹¶ç”¨ ` "(cached)"` æ ‡è®°æ³¨æ˜ã€‚è¿™å¯¹äºåŠ é€Ÿå¤§å‹ä»£ç åº“çš„æµ‹è¯•è¿è¡Œéå¸¸æœ‰ç”¨ã€‚å¦‚æœè¦å¼ºåˆ¶æµ‹è¯•å®Œå…¨è¿è¡Œï¼ˆå¹¶é¿å…ç¼“å­˜ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ ` -count=1` å‚æ•°ï¼Œæˆ–ä½¿ç”¨ ` go clean` å·¥å…·æ¸…é™¤æ‰€æœ‰ç¼“å­˜çš„æµ‹è¯•ç»“æœã€‚

` $ go test -count=1 ./... # è¿è¡Œæµ‹è¯•æ—¶ç»•è¿‡æµ‹è¯•ç¼“å­˜ $ go clean -testcache # åˆ é™¤æ‰€æœ‰çš„æµ‹è¯•ç»“æœç¼“å­˜ å¤åˆ¶ä»£ç `

æ³¨æ„ï¼šç¼“å­˜çš„æµ‹è¯•ç»“æœä¸æ„å»ºç»“æœè¢«ä¸€åŒå­˜å‚¨åœ¨ä½ çš„ ` GOCACHE` ç›®å½•ä¸­ã€‚å¦‚æœä½ ä¸ç¡®å®š ` GOCACHE` ç›®å½•åœ¨æœºå™¨ä¸Šçš„ä½ç½®ï¼Œè¯·è¾“å…¥ ` go env GOCACHE` æ£€æŸ¥ã€‚

ä½ å¯ä»¥ä½¿ç”¨ ` -run` å‚æ•°å°† ` go test` é™åˆ¶ä¸ºåªè¿è¡Œç‰¹å®šæµ‹è¯•ï¼ˆå’Œå­æµ‹è¯•ï¼‰ã€‚ ` -run` å‚æ•°æ¥å—æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”åªè¿è¡Œå…·æœ‰ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„åç§°çš„æµ‹è¯•ã€‚æˆ‘å–œæ¬¢å°†å®ƒä¸ ` -v` å‚æ•°ç»“åˆèµ·æ¥ä»¥å¯ç”¨è¯¦ç»†æ¨¡å¼ï¼Œè¿™æ ·ä¼šæ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„æµ‹è¯•å’Œå­æµ‹è¯•çš„åç§°ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„æ–¹æ³•ï¼Œä»¥ç¡®ä¿æˆ‘æ²¡æœ‰æç ¸æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ç¡®ä¿æˆ‘æœŸæœ›çš„æµ‹è¯•æ­£åœ¨è¿è¡Œï¼

` $ go test -v -run=^TestFooBar$ . # è¿è¡Œåå­—ä¸º TestFooBar çš„æµ‹è¯• $ go test -v -run=^TestFoo . # è¿è¡Œé‚£äº›åå­—ä»¥ TestFoo å¼€å¤´çš„æµ‹è¯• $ go test -v -run=^TestFooBar$/^Baz$ . # åªè¿è¡Œ TestFooBar çš„åä¸º Baz çš„å­æµ‹è¯• å¤åˆ¶ä»£ç `

å€¼å¾—æ³¨æ„çš„ä¸¤ä¸ªå‚æ•°æ˜¯ ` -short` ï¼ˆå¯ä»¥ç”¨æ¥ [è·³è¿‡é•¿æ—¶é—´è¿è¡Œçš„æµ‹è¯•]( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fpkg%2Ftesting%2F%23hdr-Skipping ) ï¼‰å’Œ ` -failfast` ï¼ˆç¬¬ä¸€æ¬¡å¤±è´¥ååœæ­¢è¿è¡Œè¿›ä¸€æ­¥çš„æµ‹è¯•ï¼‰ã€‚è¯·æ³¨æ„ï¼Œ ` -failfast` å°†é˜»æ­¢æµ‹è¯•ç»“æœç¼“å­˜ã€‚

` $ go test -short ./... # è·³è¿‡é•¿æ—¶é—´è¿è¡Œçš„æµ‹è¯• $ go test -failfast ./... # ç¬¬ä¸€æ¬¡å¤±è´¥ååœæ­¢è¿è¡Œè¿›ä¸€æ­¥çš„æµ‹è¯• å¤åˆ¶ä»£ç `

### åˆ†ææµ‹è¯•è¦†ç›–ç‡ ###

å½“ä½ åœ¨è¿è¡Œæµ‹è¯•æ—¶ä½¿ç”¨ ` -cover` å‚æ•°ï¼Œä½ å°±å¯ä»¥å¼€å¯æµ‹è¯•è¦†ç›–ç‡åˆ†æã€‚è¿™å°†æ˜¾ç¤ºæ¯ä¸ªåŒ…çš„è¾“å‡ºä¸­æµ‹è¯•æ‰€æ¶µç›–çš„ä»£ç ç™¾åˆ†æ¯”ï¼Œç±»ä¼¼äºï¼š

` $ go test -cover ./... ok github.com/alexedwards/argon2id 0.467s coverage: 78.6% of statements å¤åˆ¶ä»£ç `

ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ ` -coverprofile` å‚æ•°ç”Ÿæˆè¦†ç›–ç‡æ€»è§ˆï¼Œå¹¶ä½¿ç”¨ ` go tool cover -html` å‘½ä»¤åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚åƒè¿™æ ·ï¼š

` $ go test -coverprofile=/tmp/profile.out ./... $ go tool cover -html=/tmp/profile.out å¤åˆ¶ä»£ç `

![](https://user-gold-cdn.xitu.io/2019/5/17/16ac5b3977daebaa?imageView2/0/w/1280/h/960/ignore-error/1)

è¿™å°†ä¸ºä½ æä¾›æ‰€æœ‰æµ‹è¯•æ–‡ä»¶çš„å¯å¯¼èˆªåˆ—è¡¨ï¼Œå…¶ä¸­ç»¿è‰²ä»£ç æ˜¯è¢«æµ‹è¯•è¦†ç›–åˆ°çš„ï¼Œçº¢è‰²ä»£ç æœªè¢«æµ‹è¯•è¦†ç›–ã€‚

å¦‚æœä½ æ„¿æ„çš„è¯ï¼Œå¯ä»¥å†è¿›ä¸€æ­¥ã€‚è®¾ç½® ` -covermode=count` å‚æ•°ï¼Œä½¿è¦†ç›–ç‡é…ç½®æ–‡ä»¶è®°å½•æµ‹è¯•æœŸé—´æ¯æ¡è¯­å¥æ‰§è¡Œçš„ç¡®åˆ‡ **æ¬¡æ•°** ã€‚

` $ go test -covermode=count -coverprofile=/tmp/profile.out ./... $ go tool cover -html=/tmp/profile.out å¤åˆ¶ä»£ç `

åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹æ—¶ï¼Œæ›´é¢‘ç¹æ‰§è¡Œçš„è¯­å¥ä»¥æ›´é¥±å’Œçš„ç»¿è‰²é˜´å½±æ˜¾ç¤ºï¼Œç±»ä¼¼äºï¼š

![](https://user-gold-cdn.xitu.io/2019/5/17/16ac5b26ac05e6db?imageView2/0/w/1280/h/960/ignore-error/1)

æ³¨æ„ï¼šå¦‚æœä½ åœ¨æµ‹è¯•ä¸­ä½¿ç”¨äº† ` t.Parallel()` å‘½ä»¤ï¼Œä½ åº”è¯¥ç”¨ ` -covermode=atomic` æ›¿æ¢æ‰ ` -covermode=count` ä»¥ç¡®ä¿è®¡æ•°å‡†ç¡®ã€‚

æœ€åï¼Œå¦‚æœä½ æ²¡æœ‰å¯ç”¨äºæŸ¥çœ‹è¦†ç›–ç‡é…ç½®æ–‡ä»¶çš„ Web æµè§ˆå™¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ç»ˆç«¯ä¸­æŒ‰åŠŸèƒ½/æ–¹æ³•æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡çš„ç»†åˆ†ï¼š

` $ go tool cover -func=/tmp/profile.out github.com/alexedwards/argon2id/argon2id.go:77: CreateHash 87.5% github.com/alexedwards/argon2id/argon2id.go:96: ComparePasswordAndHash 85.7% ... å¤åˆ¶ä»£ç `

### å‹åŠ›æµ‹è¯• ###

ä½ å¯ä»¥ä½¿ç”¨ ` go test -count` å‘½ä»¤è¿ç»­å¤šæ¬¡è¿è¡Œæµ‹è¯•ã€‚å¦‚æœæƒ³æ£€æŸ¥å¶å‘æˆ–é—´æ­‡æ€§æ•…éšœï¼Œè¿™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼š

` $ go test -run=^TestFooBar$ -count=500 . å¤åˆ¶ä»£ç `

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ ` TestFooBar` æµ‹è¯•å°†è¿ç»­é‡å¤ 500 æ¬¡ã€‚ä½†æœ‰ä¸€ç‚¹ä½ è¦ç‰¹åˆ«æ³¨æ„ï¼Œæµ‹è¯•å°†ä¸²è¡Œ **é‡å¤** æ‰§è¡Œ â€”â€” å³ä¾¿å®ƒåŒ…å«ä¸€ä¸ª ` t.Parallel()` å‘½ä»¤ã€‚å› æ­¤ï¼Œå¦‚æœä½ çš„æµ‹è¯•è¦åšçš„äº‹ç›¸å¯¹è¾ƒæ…¢ï¼Œä¾‹å¦‚è¯»å†™æ•°æ®åº“ã€ç£ç›˜æˆ–ä¸äº’è”ç½‘æœ‰é¢‘ç¹çš„äº¤äº’ï¼Œé‚£ä¹ˆè¿è¡Œå¤§é‡æµ‹è¯•å¯èƒ½ä¼šéœ€è¦ç›¸å½“é•¿çš„æ—¶é—´ã€‚

è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½å¸Œæœ›ä½¿ç”¨ ` stress` ( https://link.juejin.im?target=golang.org%2Fx%2Ftools%2Fcmd%2Fstress ) å·¥å…·å¹¶è¡Œæ‰§è¡Œé‡å¤ç›¸åŒçš„æµ‹è¯•ã€‚ä½ å¯ä»¥åƒè¿™æ ·å®‰è£…å®ƒï¼š

` $ cd /tmp $ GO111MODULE=on go get golang.org/x/tools/cmd/stress å¤åˆ¶ä»£ç `

è¦ä½¿ç”¨ ` stress` å·¥å…·ï¼Œé¦–å…ˆéœ€è¦ä¸ºè¦æµ‹è¯•çš„ç‰¹å®šåŒ…ç¼–è¯‘ **æµ‹è¯•äºŒè¿›åˆ¶** æ–‡ä»¶ã€‚ä½ å¯ä»¥ä½¿ç”¨ ` go test -c` å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œä¸ºå½“å‰ç›®å½•ä¸­çš„åŒ…åˆ›å»ºæµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶ï¼š

` $ go test -c -o=/tmp/foo.test . å¤åˆ¶ä»£ç `

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶å°†è¾“å‡ºåˆ° ` /tmp/foo.test` ã€‚ä¹‹åä½ å¯ä»¥ä½¿ç”¨ ` stress` å·¥å…·åœ¨è¯¥æ–‡ä»¶ä¸­æ‰§è¡Œç‰¹å®šæµ‹è¯•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

` $ stress -p=4 /tmp/foo.test -test.run=^TestFooBar$ 60 runs so far, 0 failures 120 runs so far, 0 failures ... å¤åˆ¶ä»£ç `

æ³¨æ„ï¼šåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä½¿ç”¨ ` -p` å‚æ•°æ¥é™åˆ¶ ` stress` ä½¿ç”¨çš„å¹¶è¡Œè¿›ç¨‹æ•°ä¸º 4ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªå‚æ•°ï¼Œè¯¥å·¥å…·å°†é»˜è®¤ä½¿ç”¨å’Œ ` runtime.NumCPU()` æ–¹æ³•æ‰§è¡Œç»“æœç›¸åŒæ•°é‡çš„è¿›ç¨‹ï¼ˆå½“å‰ç³»ç»Ÿçš„ CPU æ ¸æ•°é‡çš„è¿›ç¨‹æ•°ï¼‰ã€‚

### æµ‹è¯•å…¨éƒ¨ä¾èµ–å…³ç³» ###

åœ¨ä¸ºå‘å¸ƒæˆ–éƒ¨ç½²æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶æˆ–å…¬å¼€å‘å¸ƒä»£ç ä¹‹å‰ï¼Œä½ å¯èƒ½å¸Œæœ›è¿è¡Œ ` go test all` å‘½ä»¤ï¼š

` $ go test all å¤åˆ¶ä»£ç `

è¿™å°†å¯¹æ¨¡å—ä¸­çš„æ‰€æœ‰åŒ…å’Œä¾èµ–é¡¹è¿è¡Œæµ‹è¯• â€”â€” åŒ…æ‹¬å¯¹ **æµ‹è¯•ä¾èµ–é¡¹** å’Œå¿…è¦çš„ **æ ‡å‡†åº“åŒ…** çš„æµ‹è¯• â€”â€” å®ƒå¯ä»¥å¸®åŠ©éªŒè¯æ‰€ä½¿ç”¨çš„ä¾èµ–é¡¹çš„ç¡®åˆ‡ç‰ˆæœ¬æ˜¯å¦äº’ç›¸å…¼å®¹ã€‚å¯èƒ½éœ€è¦ç›¸å½“é•¿çš„æ—¶é—´æ‰èƒ½è¿è¡Œï¼Œä½†æµ‹è¯•ç»“æœå¯ä»¥å¾ˆå¥½åœ°ç¼“å­˜ï¼Œå› æ­¤ä»»ä½•å°†æ¥çš„åç»­æµ‹è¯•éƒ½ä¼šæ›´å¿«ã€‚å¦‚æœä½ æ„¿æ„ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ ` go test -short all` è·³è¿‡ä»»ä½•éœ€è¦é•¿æ—¶é—´è¿è¡Œçš„æµ‹è¯•ã€‚

## é¢„æäº¤æ£€æŸ¥ ##

### æ ¼å¼åŒ–ä»£ç  ###

Go æä¾›äº†ä¸¤ä¸ªå·¥å…· ` gofmt` å’Œ ` go fmt` æ¥æ ¹æ® Go çº¦å®šè‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ã€‚ä½¿ç”¨è¿™äº›æœ‰åŠ©äºä¿æŒä»£ç åœ¨æ–‡ä»¶å’Œé¡¹ç›®ä¸­ä¿æŒä¸€è‡´ï¼Œå¹¶ä¸” â€”â€” åœ¨æäº¤ä»£ç ä¹‹å‰ä½¿ç”¨å®ƒä»¬ â€”â€” æœ‰åŠ©äºåœ¨æ£€æŸ¥æ–‡ä»¶ç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚æ—¶å‡å°‘å¹²æ‰°é¡¹ã€‚

æˆ‘å–œæ¬¢ä½¿ç”¨å¸¦æœ‰ä»¥ä¸‹å‚æ•°çš„ ` gofmt` å·¥å…·ï¼š

` $ gofmt -w -s -d foo.go # æ ¼å¼åŒ– foo.go æ–‡ä»¶ $ gofmt -w -s -d. # é€’å½’æ ¼å¼åŒ–å½“å‰ç›®å½•å’Œå­ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ å¤åˆ¶ä»£ç `

åœ¨è¿™äº›å‘½ä»¤ä¸­ï¼Œ ` -w` å‚æ•°æŒ‡ç¤ºå·¥å…·é‡å†™æ–‡ä»¶ï¼Œ ` -s` å‚æ•°æŒ‡ç¤ºå·¥å…·å°½å¯èƒ½çš„ [ç®€åŒ–]( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fcmd%2Fgofmt%2F%23hdr-The_simplify_command ) ä»£ç ï¼Œ ` -d` å‚æ•°æŒ‡ç¤ºå·¥å…·è¾“å‡ºå˜åŒ–çš„å·®å¼‚ï¼ˆå› ä¸ºæˆ‘å¾ˆæƒ³çŸ¥é“æ”¹å˜äº†ä»€ä¹ˆï¼‰ã€‚å¦‚æœä½ åªæƒ³æ˜¾ç¤ºå·²æ›´æ”¹æ–‡ä»¶çš„åç§°è€Œä¸æ˜¯å·®å¼‚ï¼Œåˆ™å¯ä»¥å°†å…¶æ›¿æ¢ä¸º ` -l` å‚æ•°ã€‚

æ³¨æ„ï¼š ` gofmt` å‘½ä»¤ä»¥é€’å½’æ–¹å¼å·¥ä½œã€‚å¦‚æœä½ ä¼ é€’ä¸€ä¸ªç±»ä¼¼ `.` æˆ– `./cmd/foo` çš„ç›®å½•ï¼Œå®ƒå°†æ ¼å¼åŒ–ç›®å½•ä¸‹çš„æ‰€æœ‰ `.go` æ–‡ä»¶ã€‚

å¦ä¸€ç§æ ¼å¼åŒ–å·¥å…· ` go fmt` æ˜¯ä¸€ä¸ªåŒ…è£…å™¨ï¼Œå®ƒåœ¨æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•ä¸Šè°ƒç”¨ ` gofmt -l -w` ã€‚ä½ å¯ä»¥åƒè¿™æ ·ä½¿ç”¨å®ƒï¼š

` $ go fmt ./... å¤åˆ¶ä»£ç `

### æ‰§è¡Œé™æ€åˆ†æ ###

` go vet` å·¥å…·å¯¹ä½ çš„ä»£ç è¿›è¡Œé™æ€åˆ†æï¼Œå¹¶å¯¹ä½  **å¯èƒ½** æ˜¯ä»£ç é”™è¯¯ä½†ä¸è¢«ç¼–è¯‘å™¨æŒ‡å‡ºï¼ˆè¯­æ³•æ­£ç¡®ï¼‰çš„ä¸œè¥¿æå‡ºè­¦å‘Šã€‚è¯¸å¦‚æ— æ³•è®¿é—®çš„ä»£ç ï¼Œä¸å¿…è¦çš„åˆ†é…å’Œæ ¼å¼é”™è¯¯çš„æ„å»ºæ ‡è®°ç­‰é—®é¢˜ã€‚ä½ å¯ä»¥åƒè¿™æ ·ä½¿ç”¨å®ƒï¼š

` $ go vet foo.go # å¯¹ foo.go æ–‡ä»¶è¿›è¡Œé™æ€åˆ†æ $ go vet . # å¯¹å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œé™æ€åˆ†æ $ go vet ./... # å¯¹å½“å‰ç›®å½•ä»¥åŠå­ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œé™æ€åˆ†æ $ go vet ./foo/bar # å¯¹ ./foo/bar ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œé™æ€åˆ†æ å¤åˆ¶ä»£ç `

` go vet` åœ¨èƒŒåè¿è¡Œäº†è®¸å¤š [ä¸åŒçš„åˆ†æå™¨]( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fcmd%2Fvet%2F ) ï¼Œä½ å¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µç¦ç”¨ç‰¹å®šçš„åˆ†æå™¨ã€‚ä¾‹å¦‚ï¼Œè¦ç¦ç”¨ ` composite` åˆ†æå™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ï¼š

` $ go vet -composites= false./... å¤åˆ¶ä»£ç `

åœ¨ [golang.org/x/tools]( https://link.juejin.im?target=https%3A%2F%2Fgodoc.org%2Fgolang.org%2Fx%2Ftools ) ä¸­æœ‰å‡ ä¸ªå®éªŒæ€§çš„åˆ†æå™¨ï¼Œä½ å¯èƒ½æƒ³å°è¯•ä¸€ä¸‹ï¼š

* [nilness]( https://link.juejin.im?target=https%3A%2F%2Fgodoc.org%2Fgolang.org%2Fx%2Ftools%2Fgo%2Fanalysis%2Fpasses%2Fnilness%2Fcmd%2Fnilness ) ï¼šæ£€æŸ¥å¤šä½™æˆ–ä¸å¯èƒ½çš„é›¶æ¯”è¾ƒ
* [shadow]( https://link.juejin.im?target=https%3A%2F%2Fgodoc.org%2Fgolang.org%2Fx%2Ftools%2Fgo%2Fanalysis%2Fpasses%2Fshadow%2Fcmd%2Fshadow ) ï¼š æ£€æŸ¥å¯èƒ½çš„éé¢„æœŸå˜é‡é˜´å½±

å¦‚æœè¦ä½¿ç”¨è¿™äº›ï¼Œåˆ™éœ€è¦å•ç‹¬å®‰è£…å’Œè¿è¡Œå®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®‰è£… ` nilness` ï¼Œä½ éœ€è¦è¿è¡Œï¼š

` $ cd /tmp $ GO111MODULE=on go get golang.org/x/tools/go/analysis/passes/nilness/cmd/nilness å¤åˆ¶ä»£ç `

ä¹‹åä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š

` $ go vet -vettool=$( which nilness) ./... å¤åˆ¶ä»£ç `

æ³¨ï¼šè‡ª Go 1.10 ç‰ˆæœ¬èµ·ï¼Œ ` go test` å·¥å…·ä¼šåœ¨è¿è¡Œä»»ä½•æµ‹è¯•ä¹‹å‰è‡ªåŠ¨è¿è¡Œ ` go vet` æ£€æŸ¥çš„ä¸€ä¸ªå°çš„ã€é«˜å¯ä¿¡åº¦çš„å­é›†ã€‚ä½ å¯ä»¥åœ¨è¿è¡Œæµ‹è¯•æ—¶åƒè¿™æ ·å…³é—­æ­¤è¡Œä¸ºï¼š

` $ go test -vet=off ./... å¤åˆ¶ä»£ç `

### Linting ä»£ç  ###

ä½ å¯ä»¥ä½¿ç”¨ ` golint` å·¥å…·è¯†åˆ«ä»£ç ä¸­çš„ **æ ·å¼é”™è¯¯** ã€‚ä¸ ` go vet` ä¸åŒï¼Œè¿™ä¸ä»£ç çš„ **æ­£ç¡®æ€§** æ— å…³ï¼Œä½†å¯ä»¥å¸®åŠ©ä½ å°†ä»£ç ä¸ [Effective Go]( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fdoc%2Feffective_go.html ) å’Œ Go [CodeReviewComments]( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fwiki%2FCodeReviewComments ) ä¸­çš„æ ·å¼çº¦å®šå¯¹é½ã€‚

å®ƒä¸æ˜¯æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œä½ éœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š

` $ cd /tmp $ GO111MODULE=on go get golang.org/x/lint/golint å¤åˆ¶ä»£ç `

ä¹‹åä½ å¯ä»¥è¿™æ ·è¿è¡Œï¼š

` $ golint foo.go # Lint foo.go æ–‡ä»¶ $ golint . # Lint å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ $ golint ./... # Lint å½“å‰ç›®å½•åŠå…¶å­ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ $ golint ./foo/bar # Lint ./foo/bar ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ å¤åˆ¶ä»£ç `

### æ•´ç†å’ŒéªŒè¯ä¾èµ–å…³ç³» ###

åœ¨ä½ å¯¹ä»£ç è¿›è¡Œä»»ä½•æ›´æ”¹ä¹‹å‰ï¼Œæˆ‘å»ºè®®ä½ è¿è¡Œä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤æ¥æ•´ç†å’ŒéªŒè¯ä½ çš„ä¾èµ–é¡¹ï¼š

` $ go mod tidy $ go mod verify å¤åˆ¶ä»£ç `

` go mod tidy` å‘½ä»¤å°†åˆ é™¤ä½ çš„ ` go.mod` å’Œ ` go.sum` æ–‡ä»¶ä¸­ä»»ä½•æœªä½¿ç”¨çš„ä¾èµ–é¡¹ï¼Œå¹¶æ›´æ–°æ–‡ä»¶ä»¥åŒ…å«æ‰€æœ‰å¯èƒ½çš„æ„å»ºæ ‡è®°/ç³»ç»Ÿ/ä½“ç³»ç»“æ„ç»„åˆçš„ä¾èµ–é¡¹ï¼ˆæ³¨æ„ï¼š ` go run` ï¼Œ ` go test` ï¼Œ ` go build` ç­‰å‘½ä»¤æ˜¯â€œæ‡’æƒ°çš„â€ï¼Œåªä¼šè·å–å½“å‰æ„å»ºæ ‡è®°/ç³»ç»Ÿ/ä½“ç³»ç»“æ„æ‰€éœ€çš„åŒ…ã€‚åœ¨æ¯æ¬¡æäº¤ä¹‹å‰è¿è¡Œæ­¤å‘½ä»¤å°†ä½¿ä½ æ›´å®¹æ˜“ç¡®å®šå“ªäº›ä»£ç æ›´æ”¹è´Ÿè´£åœ¨æŸ¥çœ‹ç‰ˆæœ¬æ§åˆ¶å†å²è®°å½•æ—¶æ·»åŠ æˆ–åˆ é™¤å“ªäº›ä¾èµ–é¡¹ã€‚

æˆ‘è¿˜å»ºè®®ä½¿ç”¨ ` go mod verify` å‘½ä»¤æ¥æ£€æŸ¥è®¡ç®—æœºä¸Šçš„ä¾èµ–å…³ç³»æ˜¯å¦å·²è¢«æ„å¤–ï¼ˆæˆ–æ•…æ„ï¼‰æ›´æ”¹ï¼Œå› ä¸ºå®ƒä»¬å·²è¢«ä¸‹è½½å¹¶ä¸”å®ƒä»¬ä¸ ` go.sum` æ–‡ä»¶ä¸­çš„åŠ å¯†å“ˆå¸Œå€¼ç›¸åŒ¹é…ã€‚è¿è¡Œæ­¤å‘½ä»¤æœ‰åŠ©äºç¡®ä¿æ‰€ä½¿ç”¨çš„ä¾èµ–é¡¹æ˜¯ä½ æœŸæœ›çš„å®Œå…¨ä¾èµ–é¡¹ï¼Œå¹¶ä¸”è¯¥æäº¤çš„ä»»ä½•æ„å»ºå°†å¯ä»¥åœ¨ä»¥åé‡ç°ã€‚

## æ„å»ºä¸éƒ¨ç½² ##

### æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶ ###

è¦ç¼–è¯‘ ` main` åŒ…å¹¶åˆ›å»ºå¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ ` go build` å·¥å…·ã€‚é€šå¸¸å¯ä»¥å°†å®ƒä¸ ` -o` å‚æ•°ç»“åˆä½¿ç”¨ï¼Œè¿™å…è®¸ä½ æ˜ç¡®è®¾ç½®è¾“å‡ºç›®å½•å’ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„åç§°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

` $ go build -o=/tmp/foo . # ç¼–è¯‘å½“å‰ç›®å½•ä¸‹çš„åŒ… $ go build -o=/tmp/foo ./cmd/foo # ç¼–è¯‘ ./cmd/foo ç›®å½•ä¸‹çš„åŒ… å¤åˆ¶ä»£ç `

åœ¨è¿™äº›ç¤ºä¾‹ä¸­ï¼Œ ` go build` å°† **ç¼–è¯‘** æŒ‡å®šçš„åŒ…ï¼ˆä»¥åŠä»»ä½•ä¾èµ–åŒ…ï¼‰ï¼Œç„¶åè°ƒç”¨ **é“¾æ¥å™¨** ä»¥ç”Ÿæˆå¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶å°†å…¶è¾“å‡ºåˆ° ` /tmp/foo` ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä» Go 1.10 å¼€å§‹ï¼Œ ` go build` å·¥å…·åœ¨ **æ„å»ºç¼“å­˜** ( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fcmd%2Fgo%2F%23hdr-Build_and_test_caching ) ä¸­è¢«ç¼“å­˜ã€‚æ­¤ç¼“å­˜å°†åœ¨å°†æ¥çš„æ„å»ºä¸­é€‚å½“æ—¶åˆ»é‡ç”¨ï¼Œè¿™å¯ä»¥æ˜¾è‘—åŠ å¿«æ•´ä½“æ„å»ºæ—¶é—´ã€‚è¿™ç§æ–°çš„ç¼“å­˜è¡Œä¸ºæ„å‘³ç€â€œä½¿ç”¨ ` go install` æ›¿æ¢ ` go build` æ”¹è¿›ç¼“å­˜â€çš„ [è€æ—§å‡†åˆ™]( https://link.juejin.im?target=https%3A%2F%2Fpeter.bourgon.org%2Fgo-best-practices-2016%2F%23build-and-deploy ) ä¸å†é€‚ç”¨ã€‚

å¦‚æœä½ ä¸ç¡®å®šæ„å»ºç¼“å­˜çš„ä½ç½®ï¼Œå¯ä»¥é€šè¿‡è¿è¡Œ ` go env GOCACHE` å‘½ä»¤è¿›è¡Œæ£€æŸ¥ï¼š

` $ go env GOCACHE /home/alex/.cache/go-build å¤åˆ¶ä»£ç `

ä½¿ç”¨æ„å»ºç¼“å­˜æœ‰ä¸€ä¸ª [é‡è¦è­¦å‘Š]( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fpkg%2Fcmd%2Fgo%2Finternal%2Fhelp%2F ) - å®ƒä¸ä¼šæ£€æµ‹ç”¨ ` cgo` å¯¼å…¥çš„ C è¯­è¨€åº“çš„æ›´æ”¹ã€‚å› æ­¤ï¼Œå¦‚æœä½ çš„ä»£ç é€šè¿‡ ` cgo` å¯¼å…¥ C è¯­è¨€åº“ï¼Œå¹¶ä¸”è‡ªä¸Šæ¬¡æ„å»ºä»¥æ¥ä½ å¯¹å…¶è¿›è¡Œäº†æ›´æ”¹ï¼Œåˆ™éœ€è¦ä½¿ç”¨ ` -a` å‚æ•°æ¥å¼ºåˆ¶é‡å»ºæ‰€æœ‰åŒ…ã€‚æˆ–è€…ï¼Œä½ å¯ä»¥ä½¿ç”¨ ` go clean` æ¥æ¸…é™¤ç¼“å­˜ï¼š

` $ go build -a -o=/tmp/foo . # å¼ºåˆ¶é‡æ–°æ„å»ºæ‰€æœ‰åŒ… $ go clean -cache # ç§»é™¤æ‰€æœ‰æ„å»ºç¼“å­˜ å¤åˆ¶ä»£ç `

æ³¨æ„ï¼šè¿è¡Œ ` go clean -cache` ä¹Ÿä¼šåˆ é™¤æµ‹è¯•ç¼“å­˜ã€‚

å¦‚æœä½ å¯¹ ` go build` åœ¨èƒŒåæ‰§è¡Œçš„è¿‡ç¨‹æ„Ÿå…´è¶£ï¼Œä½ å¯èƒ½æƒ³ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š

` $ go list -deps . | sort -u # åˆ—å‡ºåœ¨æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶è¿‡ç¨‹ä¸­ç”¨åˆ°çš„æ‰€æœ‰åŒ… $ go build -a -x -o=/tmp/foo . # å…¨éƒ¨é‡æ–°æ„å»ºï¼Œå¹¶å±•ç¤ºè¿è¡Œçš„æ‰€æœ‰å‘½ä»¤ å¤åˆ¶ä»£ç `

æœ€åï¼Œå¦‚æœä½ åœ¨é ` main` åŒ…ä¸Šè¿è¡Œ ` go build` ï¼Œå®ƒå°†è¢«ç¼–è¯‘åœ¨ä¸€ä¸ªä¸´æ—¶ä½ç½®ï¼Œå¹¶ä¸”ç»“æœå°†å†æ¬¡å­˜å‚¨åœ¨æ„å»ºç¼“å­˜ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸ä¼šç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚

### äº¤å‰ç¼–è¯‘ ###

è¿™æ˜¯æˆ‘æœ€å–œæ¬¢çš„ Go åŠŸèƒ½ä¹‹ä¸€ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œ ` go build` å°†è¾“å‡ºé€‚åˆä½ å½“å‰æ“ä½œç³»ç»Ÿå’Œä½“ç³»ç»“æ„çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä½†å®ƒä¹Ÿæ”¯æŒäº¤å‰ç¼–è¯‘ï¼Œå› æ­¤ä½ å¯ä»¥ç”Ÿæˆé€‚åˆåœ¨ä¸åŒæœºå™¨ä¸Šä½¿ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¦‚æœä½ åœ¨ä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸Šè¿›è¡Œå¼€å‘å¹¶åœ¨å¦ä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸Šè¿›è¡Œéƒ¨ç½²ï¼Œè¿™å°†ç‰¹åˆ«æœ‰ç”¨ã€‚

ä½ å¯ä»¥é€šè¿‡åˆ†åˆ«è®¾ç½® ` GOOS` å’Œ ` GOARCH` ç¯å¢ƒå˜é‡æ¥æŒ‡å®šè¦ä¸ºå…¶åˆ›å»ºäºŒè¿›åˆ¶æ–‡ä»¶çš„æ“ä½œç³»ç»Ÿå’Œä½“ç³»ç»“æ„ã€‚ä¾‹å¦‚ï¼š

` $ GOOS=linux GOARCH=amd64 go build -o=/tmp/linux_amd64/foo . $ GOOS=windows GOARCH=amd64 go build -o=/tmp/windows_amd64/foo.exe . å¤åˆ¶ä»£ç `

å¦‚æœæƒ³æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„æ“ä½œç³»ç»Ÿå’Œä½“ç³»ç»“æ„ï¼Œä½ å¯ä»¥è¿è¡Œ ` go tool dist list` ï¼š

` $ go tool dist list aix/ppc64 android/386 android/amd64 android/arm android/arm64 darwin/386 darwin/amd64 ... å¤åˆ¶ä»£ç `

æç¤ºï¼šä½ å¯ä»¥ä½¿ç”¨ Go çš„äº¤å‰ç¼–è¯‘ [åˆ›å»º WebAssembly äºŒè¿›åˆ¶æ–‡ä»¶]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fwiki%2FWebAssembly ) ã€‚

æƒ³äº†è§£æ›´æ·±å…¥çš„äº¤å‰ç¼–è¯‘ä¿¡æ¯ï¼Œæ¨èä½ é˜…è¯» [è¿™ç¯‡ç²¾å½©çš„æ–‡ç« ]( https://link.juejin.im?target=https%3A%2F%2Frakyll.org%2Fcross-compilation%2F ) ã€‚

### ä½¿ç”¨ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨æ ‡è®° ###

åœ¨æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ ` -gcflags` å‚æ•°æ¥æ›´æ”¹ç¼–è¯‘å™¨çš„è¡Œä¸ºï¼Œå¹¶æŸ¥çœ‹æœ‰å…³å®ƒæ­£åœ¨æ‰§è¡Œçš„æ“ä½œçš„æ›´å¤šä¿¡æ¯ã€‚ä½ å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å¯ç”¨ç¼–è¯‘å™¨å‚æ•°çš„å®Œæ•´åˆ—è¡¨ï¼š

` $ go tool compile -help å¤åˆ¶ä»£ç `

ä½ å¯èƒ½ä¼šæ„Ÿå…´è¶£çš„ä¸€ä¸ªå‚æ•°æ˜¯ ` -m` ï¼Œå®ƒä¼šè§¦å‘æ‰“å°æœ‰å…³ç¼–è¯‘æœŸé—´æ‰€åšçš„ä¼˜åŒ–å†³ç­–ä¿¡æ¯ã€‚ä½ å¯ä»¥åƒè¿™æ ·ä½¿ç”¨å®ƒï¼š

` $ go build -gcflags= "-m -m" -o=/tmp/foo . # æ‰“å°ä¼˜åŒ–å†³ç­–ä¿¡æ¯ å¤åˆ¶ä»£ç `

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä¸¤æ¬¡ä½¿ç”¨äº† ` -m` å‚æ•°ï¼Œè¿™è¡¨ç¤ºæˆ‘æƒ³æ‰“å°ä¸¤çº§æ·±åº¦çš„å†³ç­–ä¿¡æ¯ã€‚å¦‚æœåªä½¿ç”¨ä¸€ä¸ªï¼Œå°±å¯ä»¥è·å¾—æ›´ç®€å•çš„è¾“å‡ºã€‚

æ­¤å¤–ï¼Œä» Go 1.10 å¼€å§‹ï¼Œç¼–è¯‘å™¨å‚æ•°ä»…é€‚ç”¨äºä¼ é€’ç»™ ` go build` çš„ç‰¹å®šåŒ… â€”â€” åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå®ƒæ˜¯å½“å‰ç›®å½•ä¸­çš„åŒ…ï¼ˆç”± `.` è¡¨ç¤ºï¼‰ã€‚å¦‚æœè¦ä¸ºæ‰€æœ‰åŒ…ï¼ˆåŒ…æ‹¬ä¾èµ–é¡¹ï¼‰æ‰“å°ä¼˜åŒ–å†³ç­–ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

` $ go build -gcflags= "all=-m" -o=/tmp/foo . å¤åˆ¶ä»£ç `

ä» Go 1.11 å¼€å§‹ï¼Œä½ ä¼šå‘ç° [è°ƒè¯•ä¼˜åŒ–çš„äºŒè¿›åˆ¶æ–‡ä»¶]( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fdoc%2Fgo1.11%23debugging ) æ¯”ä»¥å‰æ›´å®¹æ˜“ã€‚ä½†å¦‚æœæœ‰å¿…è¦çš„è¯ï¼Œä½ ä»ç„¶å¯ä»¥ä½¿ç”¨å‚æ•° ` -N` æ¥ç¦ç”¨ä¼˜åŒ–ï¼Œä½¿ç”¨ ` -l` æ¥ç¦ç”¨å†…è”ã€‚ä¾‹å¦‚ï¼š

` $ go build -gcflags= "all=-N -l" -o=/tmp/foo . # Disable optimizations and inlining å¤åˆ¶ä»£ç `

é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä½ å¯ä»¥çœ‹åˆ°å¯ç”¨é“¾æ¥å‚æ•°åˆ—è¡¨ï¼š

` $ go tool link -help å¤åˆ¶ä»£ç `

å…¶ä¸­æœ€è‘—åçš„å¯èƒ½æ˜¯ ` -X` å‚æ•°ï¼Œå®ƒå…è®¸ä½ å°†ï¼ˆå­—ç¬¦ä¸²ï¼‰å€¼â€œæ’å…¥â€åº”ç”¨ç¨‹åºä¸­çš„ç‰¹å®šå˜é‡ã€‚è¿™é€šå¸¸ç”¨äº [æ·»åŠ ç‰ˆæœ¬å·æˆ–æäº¤ hash]( https://link.juejin.im?target=https%3A%2F%2Fblog.alexellis.io%2Finject-build-time-vars-golang%2F ) ã€‚ä¾‹å¦‚ï¼š

` $ go build -ldflags= "-X main.version=1.2.3" -o=/tmp/foo . å¤åˆ¶ä»£ç `

æœ‰å…³ ` -X` å‚æ•°å’Œç¤ºä¾‹ä»£ç çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… [è¿™ä¸ª StackOverflow é—®é¢˜]( https://link.juejin.im?target=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F11354518%2Fgolang-application-auto-build-versioning ) å’Œ [è¿™ç¯‡æ–‡ç« ]( https://link.juejin.im?target=https%3A%2F%2Fblog.alexellis.io%2Finject-build-time-vars-golang%2F ) ã€‚

ä½ å¯èƒ½è¿˜æœ‰å…´è¶£ä½¿ç”¨ ` -s` å’Œ ` -w` å‚æ•°æ¥ä»äºŒè¿›åˆ¶æ–‡ä»¶ä¸­åˆ é™¤è°ƒè¯•ä¿¡æ¯ã€‚è¿™é€šå¸¸ä¼šå‰Šå‡ 25% çš„æœ€ç»ˆå¤§å°ã€‚ä¾‹å¦‚ï¼š

` $ go build -ldflags= "-s -w" -o=/tmp/foo . # ä»äºŒè¿›åˆ¶æ–‡ä»¶ä¸­åˆ é™¤è°ƒè¯•ä¿¡æ¯ å¤åˆ¶ä»£ç `

æ³¨æ„ï¼šå¦‚æœä½ éœ€è¦ä¼˜åŒ–å¯æ‰§è¡Œæ–‡ä»¶çš„å¤§å°ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ [upx]( https://link.juejin.im?target=https%3A%2F%2Fupx.github.io%2F ) æ¥å‹ç¼©å®ƒã€‚è¯¦ç»†ä¿¡æ¯è¯·å‚é˜… [è¿™ç¯‡æ–‡ç« ]( https://link.juejin.im?target=https%3A%2F%2Fblog.filippo.io%2Fshrink-your-go-binaries-with-this-one-weird-trick%2F ) ã€‚

## è¯Šæ–­é—®é¢˜å’Œä¼˜åŒ– ##

### è¿è¡Œå’Œæ¯”è¾ƒåŸºå‡† ###

Go å¯ä»¥è½»æ¾çš„å¯¹ä»£ç è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åŠŸèƒ½ã€‚å¦‚æœä½ ä¸ç†Ÿæ‚‰ç¼–å†™åŸºå‡†æµ‹è¯•çš„ä¸€èˆ¬è¿‡ç¨‹ï¼Œä½ å¯ä»¥åœ¨ [è¿™é‡Œ]( https://link.juejin.im?target=https%3A%2F%2Fdave.cheney.net%2F2013%2F06%2F30%2Fhow-to-write-benchmarks-in-go ) å’Œ [è¿™é‡Œ]( https://link.juejin.im?target=https%3A%2F%2Fdave.cheney.net%2F2013%2F06%2F30%2Fhow-to-write-benchmarks-in-go ) é˜…è¯»ä¼˜ç§€æŒ‡å—ã€‚

è¦è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼Œä½ éœ€è¦ä½¿ç”¨ ` go test` å·¥å…·ï¼Œå°† ` -bench` å‚æ•°è®¾ç½®ä¸ºä¸ä½ è¦æ‰§è¡Œçš„åŸºå‡†åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼š

` $ go test -bench=. ./... # è¿›è¡ŒåŸºå‡†æ£€æŸ¥å’Œæµ‹è¯• $ go test -run=^$ -bench=. ./... # åªè¿›è¡ŒåŸºå‡†æ£€æŸ¥ï¼Œä¸æµ‹è¯• $ go test -run=^$ -bench=^BenchmarkFoo$ ./... # åªè¿›è¡Œ BenchmarkFoo çš„åŸºå‡†æ£€æŸ¥ï¼Œä¸è¿›è¡Œæµ‹è¯• å¤åˆ¶ä»£ç `

æˆ‘å‡ ä¹æ€»æ˜¯ä½¿ç”¨ ` -benchmem` å‚æ•°è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼Œè¿™ä¼šåœ¨è¾“å‡ºä¸­å¼ºåˆ¶åŒ…å«å†…å­˜åˆ†é…ç»Ÿè®¡ä¿¡æ¯ã€‚

` $ go test -bench=. -benchmem ./... å¤åˆ¶ä»£ç `

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªåŸºå‡†æµ‹è¯•ä¸€æ¬¡è¿è¡Œ **æœ€å°‘** ä¸€ç§’ã€‚ä½ å¯ä»¥ä½¿ç”¨ ` -benchtime` å’Œ ` -count` å‚æ•°æ¥æ›´æ”¹å®ƒï¼š

` $ go test -bench=. -benchtime=5s ./... # æ¯ä¸ªåŸºå‡†æµ‹è¯•è¿è¡Œæœ€å°‘ 5 ç§’ $ go test -bench=. -benchtime=500x ./... # è¿è¡Œæ¯ä¸ªåŸºå‡†æµ‹è¯• 500 æ¬¡ $ go test -bench=. -count=3 ./... # æ¯ä¸ªåŸºå‡†æµ‹è¯•é‡å¤ä¸‰æ¬¡ä»¥ä¸Š å¤åˆ¶ä»£ç `

å¦‚æœä½ å¹¶å‘æ‰§è¡ŒåŸºå‡†æµ‹è¯•çš„ä»£ç ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ ` -cpu` å‚æ•°æ¥æŸ¥çœ‹æ›´æ”¹ ` GOMAXPROCS` å€¼ï¼ˆå®è´¨ä¸Šæ˜¯å¯ä»¥åŒæ—¶æ‰§è¡Œ Go ä»£ç çš„ OS çº¿ç¨‹æ•°ï¼‰å¯¹æ€§èƒ½çš„å½±å“ã€‚ä¾‹å¦‚ï¼Œè¦å°† ` GOMAXPROCS` è®¾ç½®ä¸º 1 ã€4 å’Œ 8 æ¥è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼š

` $ go test -bench=. -cpu=1,4,8 ./... å¤åˆ¶ä»£ç `

è¦æ¯”è¾ƒåŸºå‡†æµ‹è¯•ä¹‹é—´çš„æ›´æ”¹ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ [benchcmp]( https://link.juejin.im?target=https%3A%2F%2Fgodoc.org%2Fgolang.org%2Fx%2Ftools%2Fcmd%2Fbenchcmp ) å·¥å…·ã€‚è¿™ä¸æ˜¯æ ‡å‡† ` Go` å‘½ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ä½ éœ€è¦åƒè¿™æ ·å®‰è£…å®ƒï¼š

` $ cd /tmp $ GO111MODULE=on go get golang.org/x/tools/cmd/benchcmp å¤åˆ¶ä»£ç `

ç„¶åä½ å°±å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š

` $ go test -run=^$ -bench=. -benchmem ./... > /tmp/old.txt # åšå‡ºæ”¹å˜ $ go test -run=^$ -bench=. -benchmem ./... > /tmp/new.txt $ benchcmp /tmp/old.txt /tmp/new.txt benchmark old ns/op new ns/op delta BenchmarkExample-8 21234 5510 -74.05% benchmark old allocs new allocs delta BenchmarkExample-8 17 11 -35.29% benchmark old bytes new bytes delta BenchmarkExample-8 8240 3808 -53.79% å¤åˆ¶ä»£ç `

### åˆ†æå’Œè·Ÿè¸ª ###

Go å¯ä»¥ä¸º CPU ä½¿ç”¨ï¼Œå†…å­˜ä½¿ç”¨ï¼Œgoroutine é˜»å¡å’Œäº’æ–¥äº‰ç”¨åˆ›å»ºè¯Šæ–­ **é…ç½®æ–‡ä»¶** ã€‚ä½ å¯ä»¥ä½¿ç”¨è¿™äº›æ¥æ·±å…¥æŒ–æ˜å¹¶ç¡®åˆ‡äº†è§£ä½ çš„åº”ç”¨ç¨‹åºå¦‚ä½•ä½¿ç”¨ï¼ˆæˆ–ç­‰å¾…ï¼‰èµ„æºã€‚

æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼š

* å¦‚æœä½ æœ‰ä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥å¯¼å…¥ ` net/http/pprof` ( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fpkg%2Fnet%2Fhttp%2Fpprof%2F ) åŒ…ã€‚è¿™å°†ä½¿ç”¨ ` http.DefaultServeMux` æ³¨å†Œä¸€äº›å¤„ç†ç¨‹åºï¼Œç„¶åä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥ä¸ºæ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºç”Ÿæˆå’Œä¸‹è½½é…ç½®æ–‡ä»¶ã€‚ [è¿™ç¯‡æ–‡ç« ]( https://link.juejin.im?target=https%3A%2F%2Fartem.krylysov.com%2Fblog%2F2017%2F03%2F13%2Fprofiling-and-optimizing-go-web-applications%2F ) å¾ˆå¥½çš„æä¾›äº†è§£é‡Šå’Œä¸€äº›ç¤ºä¾‹ä»£ç ã€‚
* å¯¹äºå…¶ä»–ç±»å‹çš„åº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥ä½¿ç”¨ ` pprof.StartCPUProfile()` å’Œ ` pprof.WriteHeapProfile()` å‡½æ•°æ¥åˆ†ææ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åº æœ‰å…³ç¤ºä¾‹ä»£ç ï¼Œè¯·å‚é˜… ` runtime/pprof` ( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fpkg%2Fruntime%2Fpprof%2F ) æ–‡æ¡£ã€‚
* æˆ–è€…ä½ å¯ä»¥åœ¨è¿è¡ŒåŸºå‡†æµ‹è¯•æˆ–æµ‹è¯•æ—¶ä½¿ç”¨å„ç§ ` -***profile` å‚æ•°ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

` $ go test -run=^$ -bench=^BenchmarkFoo$ -cpuprofile=/tmp/cpuprofile.out . $ go test -run=^$ -bench=^BenchmarkFoo$ -memprofile=/tmp/memprofile.out . $ go test -run=^$ -bench=^BenchmarkFoo$ -blockprofile=/tmp/blockprofile.out . $ go test -run=^$ -bench=^BenchmarkFoo$ -mutexprofile=/tmp/mutexprofile.out . å¤åˆ¶ä»£ç `

æ³¨æ„ï¼šè¿è¡ŒåŸºå‡†æµ‹è¯•æˆ–æµ‹è¯•æ—¶ä½¿ç”¨ ` -***profile` å‚æ•°å°†ä¼šæŠŠæµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶è¾“å‡ºåˆ°å½“å‰ç›®å½•ã€‚å¦‚æœè¦å°†å…¶è¾“å‡ºåˆ°å…¶å®ƒä½ç½®ï¼Œåˆ™åº”ä½¿ç”¨ ` -o` å‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

` $ go test -run=^$ -bench=^BenchmarkFoo$ -o=/tmp/foo.test -cpuprofile=/tmp/cpuprofile.out . å¤åˆ¶ä»£ç `

æ— è®ºä½ é€‰æ‹©ä½•ç§æ–¹å¼åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œå¯ç”¨é…ç½®æ–‡ä»¶æ—¶ï¼Œä½ çš„ Go ç¨‹åºå°†æ¯ç§’æš‚åœå¤§çº¦ 100 æ¬¡ï¼Œå¹¶åœ¨è¯¥æ—¶åˆ»æ‹æ‘„å¿«ç…§ã€‚è¿™äº› **æ ·æœ¬** è¢«æ”¶é›†åœ¨ä¸€èµ·å½¢æˆ **è½®å»“** ï¼Œä½ å¯ä»¥ä½¿ç”¨ ` pprof` å·¥å…·è¿›è¡Œåˆ†æã€‚

æˆ‘æœ€å–œæ¬¢æ£€æŸ¥é…ç½®æ–‡ä»¶çš„æ–¹æ³•æ˜¯ä½¿ç”¨ ` go tool pprof -http` å‘½ä»¤åœ¨ Web æµè§ˆå™¨ä¸­æ‰“å¼€å®ƒã€‚ä¾‹å¦‚ï¼š

` $ go tool pprof -http=:5000 /tmp/cpuprofile.out å¤åˆ¶ä»£ç `

![](https://user-gold-cdn.xitu.io/2019/5/17/16ac5b26e4d9ba5e?imageView2/0/w/1280/h/960/ignore-error/1)

è¿™å°†é»˜è®¤æ˜¾ç¤º **å›¾è¡¨** ï¼Œæ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„é‡‡æ ·æ–¹é¢çš„æ‰§è¡Œæ ‘ï¼Œè¿™ä½¿å¾—å¯ä»¥å¿«é€Ÿäº†è§£ä»»ä½•â€œçƒ­é—¨â€ä½¿ç”¨èµ„æºã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° CPU ä½¿ç”¨ç‡æ–¹é¢çš„çƒ­ç‚¹æ˜¯æ¥è‡ª ` ioutil.ReadFile()` çš„ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ã€‚

ä½ è¿˜å¯ä»¥å¯¼èˆªåˆ°é…ç½®æ–‡ä»¶çš„å…¶ä»– **è§†å›¾** ï¼ŒåŒ…æ‹¬åŠŸèƒ½å’Œæºä»£ç çš„æœ€é«˜ä½¿ç”¨æƒ…å†µã€‚

![](https://user-gold-cdn.xitu.io/2019/5/17/16ac5b26aae75f51?imageView2/0/w/1280/h/960/ignore-error/1)

å¦‚æœä¿¡æ¯é‡å¤ªå¤§ï¼Œä½ å¯èƒ½å¸Œæœ›ä½¿ç”¨ ` --nodefraction` å‚æ•°æ¥å¿½ç•¥å å°äºä¸€å®šç™¾åˆ†æ¯”æ ·æœ¬çš„èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œè¦å¿½ç•¥åœ¨å°‘äº 10% çš„æ ·æœ¬ä¸­å‡ºç°çš„èŠ‚ç‚¹ï¼Œä½ å¯ä»¥åƒè¿™æ ·è¿è¡Œ ` pprof` ï¼š

` $ go tool pprof --nodefraction=0.1 -http=:5000 /tmp/cpuprofile.out å¤åˆ¶ä»£ç `

![](https://user-gold-cdn.xitu.io/2019/5/17/16ac5b26adcd5e56?imageView2/0/w/1280/h/960/ignore-error/1)

è¿™è®©å›¾å½¢æ›´åŠ â€œå˜ˆæ‚â€ï¼Œå¦‚æœä½  [æ”¾å¤§è¿™ä¸ªæˆªå›¾]( https://link.juejin.im?target=https%3A%2F%2Fwww.alexedwards.net%2Fstatic%2Fimages%2Ftooling-5b.svg ) ï¼Œå°±å¯ä»¥æ›´æ¸…æ¥šçš„çœ‹åˆ°å’Œäº†è§£ CPU ä½¿ç”¨çš„çƒ­ç‚¹ä½ç½®ã€‚

åˆ†æå’Œä¼˜åŒ–èµ„æºä½¿ç”¨æ˜¯ä¸€ä¸ªåºå¤§ä¸”å¤æ‚çš„é—®é¢˜ï¼Œæˆ‘åœ¨è¿™é‡Œåªæ¶‰åŠåˆ°ä¸€ç‚¹çš®æ¯›ã€‚å¦‚æœä½ æœ‰å…´è¶£äº†è§£æ›´å¤šä¿¡æ¯ï¼Œæˆ‘å»ºè®®ä½ é˜…è¯»ä»¥ä¸‹æ–‡ç« ï¼š

* [åˆ†æå’Œä¼˜åŒ– Go Web åº”ç”¨ç¨‹åº]( https://link.juejin.im?target=https%3A%2F%2Fartem.krylysov.com%2Fblog%2F2017%2F03%2F13%2Fprofiling-and-optimizing-go-web-applications%2F )
* [è°ƒè¯• Go ç¨‹åºä¸­çš„æ€§èƒ½é—®é¢˜]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fwiki%2FPerformance )
* [ä½¿ç”¨åŸºå‡†å’Œåˆ†æçš„æ¯æ—¥ä»£ç ä¼˜åŒ–]( https://link.juejin.im?target=https%3A%2F%2Fmedium.com%2F%40hackintoshrao%2Fdaily-code-optimization-using-benchmarks-and-profiling-in-golang-gophercon-india-2016-talk-874c8b4dc3c5 )
* [ä½¿ç”¨ pprof åˆ†æ Go ç¨‹åº]( https://link.juejin.im?target=https%3A%2F%2Fjvns.ca%2Fblog%2F2017%2F09%2F24%2Fprofiling-go-with-pprof%2F )

å¦ä¸€ä¸ªå¯ä»¥ç”¨æ¥å¸®åŠ©ä½ è¯Šæ–­é—®é¢˜çš„å·¥å…·æ˜¯ **è¿è¡Œæ—¶æ‰§è¡Œè·Ÿè¸ªå™¨** ã€‚è¿™ä½¿ä½ å¯ä»¥äº†è§£ Go å¦‚ä½•åˆ›å»ºå’Œå®‰æ’è¿è¡Œåƒåœ¾æ”¶é›†å™¨æ—¶è¿è¡Œçš„ goroutineï¼Œä»¥åŠæœ‰å…³é˜»æ­¢ç³»ç»Ÿè°ƒç”¨/ç½‘ç»œ/åŒæ­¥æ“ä½œçš„ä¿¡æ¯ã€‚

åŒæ ·ï¼Œä½ å¯ä»¥ä»æµ‹è¯•æˆ–åŸºå‡†æµ‹è¯•ä¸­ç”Ÿæˆè·Ÿè¸ªï¼Œæˆ–ä½¿ç”¨ ` net/http/pprof` ä¸ºä½ çš„ Web åº”ç”¨ç¨‹åºåˆ›å»ºå’Œä¸‹è½½è·Ÿè¸ªã€‚ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨ ` go tool trace` åœ¨ Web æµè§ˆå™¨ä¸­æŸ¥çœ‹è¾“å‡ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

` $ go test -run=^$ -bench=^BenchmarkFoo$ -trace=/tmp/trace.out . $ go tool trace /tmp/trace.out å¤åˆ¶ä»£ç `

é‡è¦æç¤ºï¼šç›®å‰åªèƒ½åœ¨ Chrome/Chromium ä¸­æŸ¥çœ‹ã€‚

![](https://user-gold-cdn.xitu.io/2019/5/17/16ac5b26a34d80ed?imageView2/0/w/1280/h/960/ignore-error/1)

æœ‰å…³ Go çš„æ‰§è¡Œè·Ÿè¸ªå™¨ä»¥åŠå¦‚ä½•è§£é‡Šè¾“å‡ºçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… [Rhys Hiltner çš„ dotGo 2016 æ¼”è®²]( https://link.juejin.im?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DmmqDlbWk_XA ) å’Œ [ä¼˜ç§€åšå®¢æ–‡ç« ]( https://link.juejin.im?target=https%3A%2F%2Fmaking.pusher.com%2Fgo-tool-trace%2F ) ã€‚

### ç«äº‰æ£€æµ‹ ###

æˆ‘ä¹‹å‰è°ˆè¿‡åœ¨æµ‹è¯•æœŸé—´ä½¿ç”¨ ` go test -race` å¯ç”¨ Go çš„ç«äº‰æ£€æµ‹ã€‚ä½†æ˜¯ï¼Œä½ è¿˜å¯ä»¥åœ¨æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶æ—¶å¯ç”¨å®ƒæ¥è¿è¡Œç¨‹åºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

` $ go build -race -o=/tmp/foo . å¤åˆ¶ä»£ç `

å°¤å…¶é‡è¦çš„æ˜¯ï¼Œå¯ç”¨ç«äº‰æ£€æµ‹çš„äºŒè¿›åˆ¶æ–‡ä»¶å°†ä½¿ç”¨æ¯”æ­£å¸¸æƒ…å†µæ›´å¤šçš„ CPU å’Œå†…å­˜ï¼Œå› æ­¤åœ¨æ­£å¸¸æƒ…å†µä¸‹ä¸ºç”Ÿäº§ç¯å¢ƒæ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œä¸åº”ä½¿ç”¨ ` -race` å‚æ•°ã€‚

ä½†æ˜¯ï¼Œä½ å¯èƒ½å¸Œæœ›åœ¨ä¸€å°æœåŠ¡å™¨éƒ¨ç½²å¤šä¸ªå¯ç”¨ç«äº‰æ£€æµ‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ–è€…ä½¿ç”¨å®ƒæ¥å¸®åŠ©è¿½è¸ªå¯ç–‘çš„ç«æ€æ¡ä»¶ã€‚æ–¹æ³•æ˜¯ä½¿ç”¨è´Ÿè½½æµ‹è¯•å·¥å…·åœ¨å¯ç”¨ç«äº‰æ£€æµ‹çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„åŒæ—¶æŠ•æ”¾æµé‡ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœåœ¨äºŒè¿›åˆ¶æ–‡ä»¶è¿è¡Œæ—¶æ£€æµ‹åˆ°ä»»ä½•ç«æ€æ¡ä»¶ï¼Œåˆ™æ—¥å¿—å°†å†™å…¥ ` stderr` ã€‚å¦‚æœ‰å¿…è¦ï¼Œå¯ä»¥ä½¿ç”¨ ` GORACE` ç¯å¢ƒå˜é‡æ¥æ›´æ”¹æ­¤è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œè¦è¿è¡Œä½äº ` /tmp/foo` çš„äºŒè¿›åˆ¶æ–‡ä»¶å¹¶å°†ä»»ä½•ç«æ€æ—¥å¿—è¾“å‡ºåˆ° ` /tmp/race.<pid>` ï¼Œä½ å¯ä»¥ä½¿ç”¨ï¼š

` $ GORACE= "log_path=/tmp/race" /tmp/foo å¤åˆ¶ä»£ç `

## ç®¡ç†ä¾èµ– ##

ä½ å¯ä»¥ä½¿ç”¨ ` go list` å·¥å…·æ£€æŸ¥ç‰¹å®šä¾èµ–é¡¹æ˜¯å¦å…·æœ‰æ›´æ–°ç‰ˆæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

` $ go list -m -u github.com/alecthomas/chroma github.com/alecthomas/chroma v0.6.2 [v0.6.3] å¤åˆ¶ä»£ç `

è¿™å°†è¾“å‡ºä½ å½“å‰æ­£åœ¨ä½¿ç”¨çš„ä¾èµ–é¡¹åç§°å’Œç‰ˆæœ¬ï¼Œå¦‚æœå­˜åœ¨è¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œåˆ™è¾“å‡ºæ–¹æ‹¬å· ` []` ä¸­çš„æœ€æ–°ç‰ˆæœ¬ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨ ` go list` æ¥æ£€æŸ¥æ‰€æœ‰ä¾èµ–é¡¹ï¼ˆå’Œå­ä¾èµ–é¡¹ï¼‰çš„æ›´æ–°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

` $ go list -m -u all å¤åˆ¶ä»£ç `

ä½ å¯ä»¥ä½¿ç”¨ ` go get` å‘½ä»¤å°†ä¾èµ–é¡¹å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€è°ƒæ•´ä¸ºç‰¹å®š tag æˆ– hash çš„ç‰ˆæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

` $ go get github.com/foo/bar@latest $ go get github.com/foo/bar@v1.2.3 $ go get github.com/foo/bar@7e0369f å¤åˆ¶ä»£ç `

å¦‚æœä½ è¦æ›´æ–°çš„ä¾èµ–é¡¹å…·æœ‰ ` go.mod` æ–‡ä»¶ï¼Œé‚£ä¹ˆæ ¹æ®æ­¤ ` go.mod` æ–‡ä»¶ä¸­çš„ä¿¡æ¯ï¼Œå¦‚æœéœ€è¦ï¼Œè¿˜å°†ä¸‹è½½å¯¹ä»»ä½• **å­ä¾èµ–é¡¹** çš„æ›´æ–°ã€‚å¦‚æœä½¿ç”¨ ` go get -u` å‚æ•°ï¼Œ ` go.mod` æ–‡ä»¶çš„å†…å®¹å°†è¢«å¿½ç•¥ï¼Œæ‰€æœ‰å­ä¾èµ–é¡¹å°†å‡çº§åˆ°æœ€æ–°çš„ minor/patch ç‰ˆæœ¬ï¼Œå³ä½¿å·²ç»åœ¨ ` go.mod` ä¸­æŒ‡å®šäº†ä¸åŒçš„ç‰ˆæœ¬ã€‚

åœ¨å‡çº§æˆ–é™çº§ä»»ä½•ä¾èµ–é¡¹åï¼Œæœ€å¥½æ•´ç†ä½ çš„ modfilesã€‚ä½ å¯èƒ½è¿˜å¸Œæœ›ä¸ºæ‰€æœ‰ç¨‹åºåŒ…è¿è¡Œæµ‹è¯•ä»¥å¸®åŠ©æ£€æŸ¥ä¸å…¼å®¹æ€§ã€‚åƒè¿™æ ·ï¼š

` $ go mod tidy $ go test all å¤åˆ¶ä»£ç `

æœ‰æ—¶ï¼Œä½ å¯èƒ½å¸Œæœ›ä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬çš„ä¾èµ–é¡¹ï¼ˆä¾‹å¦‚ï¼Œåœ¨äº‘ç«¯åˆå¹¶ä¿®è¡¥ç¨‹åºä¹‹å‰ï¼Œä½ éœ€è¦ä½¿ç”¨æœ¬åœ°åˆ†æ”¯ï¼‰ã€‚ä¸ºæ­¤ï¼Œä½ å¯ä»¥ä½¿ç”¨ ` go mod edit` å‘½ä»¤å°† ` go.mod` æ–‡ä»¶ä¸­çš„ä¾èµ–é¡¹æ›¿æ¢ä¸ºæœ¬åœ°ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼š

` $ go mod edit -replace=github.com/alexedwards/argon2id=/home/alex/code/argon2id å¤åˆ¶ä»£ç `

è¿™å°†åœ¨ä½ çš„ ` go.mod` æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ª **æ›¿æ¢è§„åˆ™** ï¼Œå¹¶ä¸”å½“ä»¥åè°ƒç”¨ ` go run` ã€ ` go build` ç­‰å‘½ä»¤æ—¶ï¼Œå°†ä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬ä¾èµ–ã€‚

File: go.mod

` module alexedwards.net/example go 1.12 require github.com/alexedwards/argon2id v0.0.0-20190109181859-24206601af6c replace github.com/alexedwards/argon2id => /home/alex/Projects/playground/argon2id å¤åˆ¶ä»£ç `

ä¸€æ—¦ä¸å†éœ€è¦ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ é™¤æ›¿æ¢è§„åˆ™ï¼š

` $ go mod edit -dropreplace=github.com/alexedwards/argon2id å¤åˆ¶ä»£ç `

ä½ å¯ä»¥ä½¿ç”¨ [same general technique]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fwiki%2FModules%23can-i-work-entirely-outside-of-vcs-on-my-local-filesystem ) å¯¼å…¥ **åªåœ¨ä½ è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿä¸Šå­˜åœ¨** çš„åŒ…ã€‚å¦‚æœä½ åŒæ—¶å¤„ç†å¼€å‘ä¸­çš„å¤šä¸ªæ¨¡å—ï¼Œå…¶ä¸­ä¸€ä¸ªæ¨¡å—ä¾èµ–äºå¦ä¸€ä¸ªæ¨¡å—ï¼Œåˆ™æ­¤åŠŸèƒ½éå¸¸æœ‰ç”¨ã€‚

æ³¨æ„ï¼šå¦‚æœä½ ä¸æƒ³ä½¿ç”¨ ` go mod edit` å‘½ä»¤ï¼Œä½ ä¹Ÿå¯ä»¥å¯ä»¥æ‰‹åŠ¨ç¼–è¾‘ ` go.mod` æ–‡ä»¶ä»¥è¿›è¡Œè¿™äº›æ›´æ”¹ã€‚ä¸¤ç§æ–¹å¼éƒ½æ˜¯å¯è¡Œçš„ã€‚

## å‡çº§åˆ°æ–°ç‰ˆæœ¬ ##

` go fix` å·¥å…·æœ€åˆäº 2011 å¹´å‘å¸ƒï¼ˆå½“æ—¶ä»åœ¨å¯¹ Go çš„ API è¿›è¡Œå®šæœŸæ›´æ”¹ï¼‰ï¼Œä»¥å¸®åŠ©ç”¨æˆ·è‡ªåŠ¨æ›´æ–°æ—§ä»£ç ä»¥ä¸æœ€æ–°ç‰ˆçš„ Go å…¼å®¹ã€‚ä»é‚£ä»¥åï¼ŒGo çš„ [å…¼å®¹æ€§æ‰¿è¯º]( https://link.juejin.im?target=https%3A%2F%2Fgolang.org%2Fdoc%2Fgo1compat ) æ„å‘³ç€å¦‚æœä½ ä» Go 1.x ç‰ˆæœ¬å‡çº§åˆ°æ›´æ–°çš„ Go 1.x ç‰ˆæœ¬ï¼Œä¸€åˆ‡éƒ½åº”è¯¥æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”é€šå¸¸æ²¡æœ‰å¿…è¦ä½¿ç”¨ ` go fix`

ä½†æ˜¯ï¼Œåœ¨æŸäº›å…·ä½“çš„é—®é¢˜ä¸Šï¼Œ ` go fix` çš„ç¡®èµ·åˆ°äº†ä½œç”¨ã€‚ä½ å¯ä»¥é€šè¿‡è¿è¡Œ ` go tool fix -help` æ¥æŸ¥çœ‹å‘½ä»¤æ¦‚è¿°ã€‚å¦‚æœä½ å†³å®šåœ¨å‡çº§åéœ€è¦è¿è¡Œ ` go fix` ï¼Œåˆ™åº”è¯¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç„¶ååœ¨æäº¤ä¹‹å‰æ£€æŸ¥æ›´æ”¹çš„å·®å¼‚ã€‚

` $ go fix ./... å¤åˆ¶ä»£ç `

## æŠ¥å‘Šé—®é¢˜ ##

å¦‚æœä½ ç¡®ä¿¡åœ¨ Go çš„æ ‡å‡†åº“ã€å·¥å…·å’Œæ–‡æ¡£ä¸­æ‰¾åˆ°äº†æœªæŠ¥å‘Šçš„é—®é¢˜ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ ` Go bug` å‘½ä»¤æå‡ºæ–°çš„ Github issueã€‚

` $ go bug å¤åˆ¶ä»£ç `

è¿™å°†ä¼šæ‰“å¼€ä¸€ä¸ªåŒ…å«äº†ç³»ç»Ÿä¿¡æ¯å’ŒæŠ¥å‘Šæ¨¡æ¿çš„ issue å¡«å†™é¡µé¢ã€‚

## é€ŸæŸ¥è¡¨ ##

**2019-04-19 æ›´æ–°ï¼š [@FedirFR]( https://link.juejin.im?target=https%3A%2F%2Ftwitter.com%2FFedirFR ) åŸºäºè¿™ç¯‡æ–‡ç« åˆ¶ä½œäº†ä¸€ä¸ªé€ŸæŸ¥è¡¨ã€‚ä½ å¯ä»¥ [ç‚¹å‡»è¿™é‡Œä¸‹è½½]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Ffedir%2Fgo-tooling-cheat-sheet%2Fblob%2Fmaster%2Fgo-tooling-cheat-sheet.pdf ) ã€‚**

( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Ffedir%2Fgo-tooling-cheat-sheet%2Fblob%2Fmaster%2Fgo-tooling-cheat-sheet.pdf )

![](https://user-gold-cdn.xitu.io/2019/5/17/16ac5ba0c946eb54?imageView2/0/w/1280/h/960/ignore-error/1) ( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Ffedir%2Fgo-tooling-cheat-sheet%2Fblob%2Fmaster%2Fgo-tooling-cheat-sheet.pdf )

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ä¸è¦å¿˜è®°æŸ¥çœ‹æˆ‘çš„æ–°ä¹¦ã€Šå¦‚ä½• [ç”¨ Go æ„å»ºä¸“ä¸šçš„ Web åº”ç”¨ç¨‹åº]( https://link.juejin.im?target=https%3A%2F%2Flets-go.alexedwards.net%2F ) ã€‹ã€‚

ä½ å¯ä»¥åœ¨ Twitter ä¸Šå…³æ³¨æˆ‘ [@ajmedwards]( https://link.juejin.im?target=https%3A%2F%2Ftwitter.com%2Fajmedwards ) ã€‚

æ–‡ä¸­çš„æ‰€æœ‰ä»£ç ç‰‡æ®µå‡å¯åœ¨ [MIT è®¸å¯è¯]( https://link.juejin.im?target=http%3A%2F%2Fopensource.org%2Flicenses%2FMIT ) ä¸‹è‡ªç”±ä½¿ç”¨ã€‚

> 
> 
> 
> å¦‚æœå‘ç°è¯‘æ–‡å­˜åœ¨é”™è¯¯æˆ–å…¶ä»–éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œæ¬¢è¿åˆ° [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fxitu%2Fgold-miner
> ) å¯¹è¯‘æ–‡è¿›è¡Œä¿®æ”¹å¹¶ PRï¼Œä¹Ÿå¯è·å¾—ç›¸åº”å¥–åŠ±ç§¯åˆ†ã€‚æ–‡ç« å¼€å¤´çš„ **æœ¬æ–‡æ°¸ä¹…é“¾æ¥** å³ä¸ºæœ¬æ–‡åœ¨ GitHub ä¸Šçš„ MarkDown é“¾æ¥ã€‚
> 
> 

> 
> 
> 
> [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fxitu%2Fgold-miner
> ) æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸º [æ˜é‡‘]( https://juejin.im ) ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– [Android](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fxitu%2Fgold-miner%23android
> ) ã€ [iOS](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fxitu%2Fgold-miner%23ios
> ) ã€ [å‰ç«¯](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fxitu%2Fgold-miner%23%25E5%2589%258D%25E7%25AB%25AF
> ) ã€ [åç«¯](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fxitu%2Fgold-miner%23%25E5%2590%258E%25E7%25AB%25AF
> ) ã€ [åŒºå—é“¾](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fxitu%2Fgold-miner%23%25E5%258C%25BA%25E5%259D%2597%25E9%2593%25BE
> ) ã€ [äº§å“](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fxitu%2Fgold-miner%23%25E4%25BA%25A7%25E5%2593%2581
> ) ã€ [è®¾è®¡](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fxitu%2Fgold-miner%23%25E8%25AE%25BE%25E8%25AE%25A1
> ) ã€ [äººå·¥æ™ºèƒ½](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fxitu%2Fgold-miner%23%25E4%25BA%25BA%25E5%25B7%25A5%25E6%2599%25BA%25E8%2583%25BD
> ) ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨ [æ˜é‡‘ç¿»è¯‘è®¡åˆ’](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fxitu%2Fgold-miner
> ) ã€ [å®˜æ–¹å¾®åš](
> https://link.juejin.im?target=http%3A%2F%2Fweibo.com%2Fjuejinfanyi ) ã€ [çŸ¥ä¹ä¸“æ ](
> https://link.juejin.im?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fjuejinfanyi
> ) ã€‚
> 
>