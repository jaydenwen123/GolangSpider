# ğŸ”¥SharedPreferenceæ€§èƒ½ä¼˜åŒ–çœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† #

## ç®€ä»‹ ##

SharedPreferenceæ˜¯Androidç³»ç»Ÿä¸­ä¸€ç§ç®€å•çš„ã€è½»é‡çº§çš„æ–‡ä»¶å­˜å‚¨ï¼Œå®ƒæ˜¯ä¸€ç§æŒä¹…åŒ–çš„å­˜å‚¨æ–¹å¼ï¼Œä»¥åç§°/å€¼å¯¹ï¼ˆNVPï¼‰æœºåˆ¶å­˜æ”¾åœ¨xmlä¸­mapæ ¹æ ‡ç­¾ä¸‹ï¼Œæ­£å¦‚å…¶åï¼Œå®ƒæ¯”è¾ƒé€‚åˆä¸€äº›ç®€å•æ•°æ®çš„å­˜å‚¨ï¼Œç”¨äºä¿å­˜Intã€longã€booleanã€Stringã€Floatã€Setè¿™äº›æ•°æ®ç±»å‹ï¼Œå¯ä»¥åœ¨data/data/åº”ç”¨ç¨‹åº/shared_prefsçš„ç›®å½•ä¸‹å¯ä»¥æŸ¥æ‰¾åˆ°ä¿å­˜çš„xmlæ–‡ä»¶ã€‚

## ä½¿ç”¨æ–¹å¼ ##

* è·å–SharedPreferenceå¯¹è±¡

` SharedPreferences sp = context.getSharedPreferences(PREFERENCES_NAME,Context.MODE_PRIVATE); å¤åˆ¶ä»£ç `

* è·å– SharedPreferences.Editor

` SharedPreferences.Editor edit = sp.edit(); å¤åˆ¶ä»£ç `

* å­˜å‚¨æ•°æ®

` edit.putString(String key,String value); edit.putStringSet(String key, Set<String> values); edit.putLong(String key,long value); edit.putFloat(String key, float value); edit.putBoolean(String key,boolean value); edit.putInt(String key,int value); edit.commit();//åŒæ­¥å†™å…¥ï¼Œé¢‘ç¹è¯»å–ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œå¼•èµ·ANR edit.apply();//å¼‚æ­¥å†™å…¥ï¼Œä¸å…³å¿ƒç»“æœï¼Œå®˜æ–¹æ¨èï¼Œé€Ÿåº¦ä¸æ€§èƒ½è¾ƒå¥½ å¤åˆ¶ä»£ç `

* è·å–æ•°æ®

` sp.getString(String key,String value); sp.getStringSet(String key, Set<String> values); sp.getLong(String key,long value); sp.getFloat(String key, float value); sp.getBoolean(String key,boolean value); sp.getInt(String key,int value); å¤åˆ¶ä»£ç `

## è€—æ—¶ç»Ÿè®¡ ##

+--------------+----------+---------+
|   å­˜å‚¨æ–¹å¼   | æ•°æ®æ¡æ•° | è€—æ—¶/MS |
+--------------+----------+---------+
| å¤šæ¬¡commit   |     1000 |   15052 |
| ä¸€æ¬¡æ€§commit |     1000 |      24 |
| å¤šæ¬¡apply    |     1000 |     588 |
| ä¸€æ¬¡æ€§apply  |     1000 |      12 |
| json         |     1000 |      73 |
+--------------+----------+---------+

## å…³äºä¼˜åŒ–çš„å»ºè®® ##

* åˆå§‹åŒ–
1.å»ºè®®åœ¨Applicationä¸­åˆå§‹åŒ–ï¼Œé‡å†™attachBaseContextæ–¹æ³•ï¼ŒSharedPreferenceçš„contextä¼ å…¥ Applicationå¯¹è±¡å³å¯ï¼Œæœ€å¥½ä½¿ç”¨å•ä¾‹ï¼Œä¸å¿…æ¯æ¬¡éƒ½è·å–Spå¯¹è±¡ï¼Œå‡å°‘å¼€é”€ã€‚
2.å¦‚æœé¡¹ç›®ä¸­ä½¿ç”¨äº†MultiDexï¼Œå­˜åœ¨åˆ†åŒ…ï¼Œè¯·åœ¨åˆ†åŒ…å‰å³MultiDex.install()ä¹‹å‰æˆ–è€…åœ¨multidexæ‰§ è¡Œçš„è¿™æ®µæ—¶é—´ï¼Œcpuæ˜¯åˆ©ç”¨ä¸æ»¡çš„ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•å……åˆ†åˆ©ç”¨CPUçš„åŸå› ï¼Œæ˜¯å› ä¸ºå¦‚æœæˆ‘ä»¬åœ¨Multidexä¹‹ å‰æ‰§è¡Œä¸€äº›æ“ä½œï¼Œæˆ‘ä»¬å¾ˆæœ‰å¯èƒ½å› ä¸ºè¿™æ ·ä¸€äº›æ“ä½œçš„ç±»æˆ–è€…æ˜¯ç›¸å…³çš„ç±»ä¸åœ¨æˆ‘ä»¬çš„ä¸»dexå½“ä¸­ï¼Œåœ¨å››ç‚¹ å‡ çš„ç±»ä¸­ä¼šç›´æ¥å´©æºƒï¼Œä½†æ˜¯ç”±äºsharePreferenceä¸ä¼šäº§ç”Ÿè¿™ç§å´©æºƒï¼Œæ˜¯ç”±äºä»–æ˜¯ç³»ç»Ÿçš„ç±»
* ä½¿ç”¨
1.è¯·ä¸è¦ä½¿ç”¨SharedPreferenceå­˜å‚¨å¤§æ–‡ä»¶åŠå­˜å‚¨å¤§é‡çš„keyå’Œvalueï¼Œè¿™æ ·çš„è¯ä¼šé€ æˆç•Œé¢å¡é¡¿æˆ–è€…ANR æ¯”è¾ƒå å†…å­˜ï¼Œè®°ä½å®ƒæ˜¯ç®€å•å­˜å‚¨ï¼Œå¦‚æœæœ‰ç±»ä¼¼çš„éœ€æ±‚è¯·è€ƒè™‘æ•°æ®åº“ã€ç£ç›˜æ–‡ä»¶å­˜å‚¨ç­‰ç­‰ã€‚
2.æ¨èä½¿ç”¨applyè¿›è¡Œå­˜å‚¨ï¼Œè¿™ä¹Ÿæ˜¯å®˜æ–¹æ¨èï¼Œå½“è¯»å…¥å†…å­˜åï¼Œå› ä¸ºå®ƒæ˜¯å¼‚æ­¥å†™å…¥ç£ç›˜çš„ï¼Œæ‰€ä»¥æ•ˆç‡ä¸Šä¼š æ¯”commitå¥½ï¼Œå½“ç„¶å¦‚æœä½ å¯¹å­˜å‚¨çš„ç»“æœéå¸¸å…³å¿ƒçš„è¯é‚£å°±ä½¿ç”¨commitå§ã€‚
3.è¯·ä¸è¦é¢‘ç¹ä½¿ç”¨applyä¸commitï¼Œå¦‚æœå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œè¯·åˆå¹¶ä¸€æ¬¡æ€§applyä¸commit,å¯ä»¥å‚è€ƒå°è£…ä¸€ä¸ªmapçš„ç»“åˆï¼Œä¸€æ¬¡æ€§æäº¤ï¼Œå› ä¸ºSharedPreferenceå¯èƒ½ä¼šå­˜åœ¨IOç“¶é¢ˆå’Œé”æ€§èƒ½å·®çš„é—®é¢˜ã€‚
4.å°½é‡ä¸è¦å­˜æ”¾JsonåŠhtmlï¼Œæ•°æ®å°‘è¿˜å¯ä»¥æ¥å—ï¼Œå¤§é‡çš„è¯è¯·æ”¾å¼ƒã€‚
5.è·¨è¿›ç¨‹æ“ä½œä¸è¦ä½¿ç”¨MULTI_PROCESSæ ‡å¿—ï¼Œè€Œæ˜¯ä½¿ç”¨contentprovideç­‰è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼
6.å¦‚æœä½ çš„é¡¹ç›®å¯¹äºå­˜å‚¨æ€§èƒ½è¦æ±‚éå¸¸é«˜çš„æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘æ”¾å¼ƒç³»ç»Ÿçš„SharedPreferenceå­˜å‚¨ï¼Œå¯ä»¥æ¨èä½ ä½¿ç”¨è…¾è®¯çš„é«˜æ€§èƒ½ç»„ä»¶ [MMKV]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FTencent%2FMMKV ) ï¼Œç›®å‰è¶…è¿‡7k+çš„starã€‚ ![](https://user-gold-cdn.xitu.io/2019/6/5/16b270b488df81bf?imageView2/0/w/1280/h/960/ignore-error/1)

## å°è£…å·¥å…·ç±» ##

å°è£…æ˜¯åŸºäº [Blankj]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FBlankj ) çš„ [AndroidUtilCode]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2FBlankj%2FAndroidUtilCode ) è¿›è¡Œçš„éƒ¨åˆ†æ”¹é€ ï¼Œå¢åŠ äº†æäº¤Mapçš„æ“ä½œï¼Œæ–¹ä¾¿ä¸€æ¬¡æ€§commitä¸applyï¼Œæ“ä½œæ—¶è¯·ç›´æ¥ä½¿ç”¨SpHelpUtilsè¾…åŠ©ç±»ã€‚

` public class SpHelpUtils { /** * ç®€å•å­˜å‚¨å·¥å…·ç±» */ private static SpUtils sDefaultSpUtils; /** * Set the default instance of {@link SpUtils}. * * @param spUtils The default instance of {@link SpUtils}. */ public static void set DefaultSpUtils(final SpUtils spUtils) { sDefaultSpUtils = spUtils; } /** * Put the string value in sp. * * @param key The key of sp. * @param value The value of sp. */ public static void put(@NonNull final String key, final String value) { put(key, value, getDefaultSpUtils()); } /** * æäº¤map,ä¸€æ¬¡æ€§commit,å‡å°‘é¢‘ç¹è¯»å†™IO * * @param hashmap å­˜å‚¨é›†åˆ */ public static void put(@NotNull final Map<String, Object> hashmap) { put(hashmap, getDefaultSpUtils()); } /** * Put the string value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} */ public static void put(@NonNull final String key, final String value, final boolean isCommit) { put(key, value, isCommit, getDefaultSpUtils()); } /** * æäº¤map,ä¸€æ¬¡æ€§commit,å‡å°‘é¢‘ç¹è¯»å†™IO * * @param hashmap å­˜å‚¨é›†åˆ * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} */ public static void put(final Map<String, Object> hashmap, final boolean isCommit) { put(hashmap, isCommit, getDefaultSpUtils()); } /** * Return the string value in sp. * * @param key The key of sp. * @ return the string value if sp exists or {@code "" } otherwise */ public static String getString(@NonNull final String key) { return getString(key, getDefaultSpUtils()); } /** * Return the string value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn 't exist. * @return the string value if sp exists or {@code defaultValue} otherwise */ public static String getString(@NonNull final String key, final String defaultValue) { return getString(key, defaultValue, getDefaultSpUtils()); } /** * Put the int value in sp. * * @param key The key of sp. * @param value The value of sp. */ public static void put(@NonNull final String key, final int value) { put(key, value, getDefaultSpUtils()); } /** * Put the int value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor#commit()}, * false to use {@link SharedPreferences.Editor#apply()} */ public static void put(@NonNull final String key, final int value, final boolean isCommit) { put(key, value, isCommit, getDefaultSpUtils()); } /** * Return the int value in sp. * * @param key The key of sp. * @return the int value if sp exists or {@code -1} otherwise */ public static int getInt(@NonNull final String key) { return getInt(key, getDefaultSpUtils()); } /** * Return the int value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn' t exist. * @ return the int value if sp exists or {@code defaultValue} otherwise */ public static int getInt(@NonNull final String key, final int defaultValue) { return getInt(key, defaultValue, getDefaultSpUtils()); } /** * Put the long value in sp. * * @param key The key of sp. * @param value The value of sp. */ public static void put(@NonNull final String key, final long value) { put(key, value, getDefaultSpUtils()); } /** * Put the long value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} */ public static void put(@NonNull final String key, final long value, final boolean isCommit) { put(key, value, isCommit, getDefaultSpUtils()); } /** * Return the long value in sp. * * @param key The key of sp. * @ return the long value if sp exists or {@code -1} otherwise */ public static long getLong(@NonNull final String key) { return getLong(key, getDefaultSpUtils()); } /** * Return the long value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn 't exist. * @return the long value if sp exists or {@code defaultValue} otherwise */ public static long getLong(@NonNull final String key, final long defaultValue) { return getLong(key, defaultValue, getDefaultSpUtils()); } /** * Put the float value in sp. * * @param key The key of sp. * @param value The value of sp. */ public static void put(@NonNull final String key, final float value) { put(key, value, getDefaultSpUtils()); } /** * Put the float value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor#commit()}, * false to use {@link SharedPreferences.Editor#apply()} */ public static void put(@NonNull final String key, final float value, final boolean isCommit) { put(key, value, isCommit, getDefaultSpUtils()); } /** * Return the float value in sp. * * @param key The key of sp. * @return the float value if sp exists or {@code -1f} otherwise */ public static float getFloat(@NonNull final String key) { return getFloat(key, getDefaultSpUtils()); } /** * Return the float value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn' t exist. * @ return the float value if sp exists or {@code defaultValue} otherwise */ public static float getFloat(@NonNull final String key, final float defaultValue) { return getFloat(key, defaultValue, getDefaultSpUtils()); } /** * Put the boolean value in sp. * * @param key The key of sp. * @param value The value of sp. */ public static void put(@NonNull final String key, final boolean value) { put(key, value, getDefaultSpUtils()); } /** * Put the boolean value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} */ public static void put(@NonNull final String key, final boolean value, final boolean isCommit) { put(key, value, isCommit, getDefaultSpUtils()); } /** * Return the boolean value in sp. * * @param key The key of sp. * @ return the boolean value if sp exists or {@code false } otherwise */ public static boolean getBoolean(@NonNull final String key) { return getBoolean(key, getDefaultSpUtils()); } /** * Return the boolean value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn 't exist. * @return the boolean value if sp exists or {@code defaultValue} otherwise */ public static boolean getBoolean(@NonNull final String key, final boolean defaultValue) { return getBoolean(key, defaultValue, getDefaultSpUtils()); } /** * Put the set of string value in sp. * * @param key The key of sp. * @param value The value of sp. */ public static void put(@NonNull final String key, final Set<String> value) { put(key, value, getDefaultSpUtils()); } /** * Put the set of string value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor#commit()}, * false to use {@link SharedPreferences.Editor#apply()} */ public static void put(@NonNull final String key, final Set<String> value, final boolean isCommit) { put(key, value, isCommit, getDefaultSpUtils()); } /** * Return the set of string value in sp. * * @param key The key of sp. * @return the set of string value if sp exists * or {@code Collections.<String>emptySet()} otherwise */ public static Set<String> getStringSet(@NonNull final String key) { return getStringSet(key, getDefaultSpUtils()); } /** * Return the set of string value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn' t exist. * @ return the set of string value if sp exists or {@code defaultValue} otherwise */ public static Set<String> getStringSet(@NonNull final String key, final Set<String> defaultValue) { return getStringSet(key, defaultValue, getDefaultSpUtils()); } /** * Return all values in sp. * * @ return all values in sp */ public static Map<String, ?> getAll () { return getAll(getDefaultSpUtils()); } /** * Return whether the sp contains the preference. * * @param key The key of sp. * @ return {@code true }: yes<br>{@code false }: no */ public static boolean contains(@NonNull final String key) { return contains(key, getDefaultSpUtils()); } /** * Remove the preference in sp. * * @param key The key of sp. */ public static void remove(@NonNull final String key) { remove(key, getDefaultSpUtils()); } /** * Remove the preference in sp. * * @param key The key of sp. * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} */ public static void remove(@NonNull final String key, final boolean isCommit) { remove(key, isCommit, getDefaultSpUtils()); } /** * Remove all preferences in sp. */ public static void clear () { clear(getDefaultSpUtils()); } /** * Remove all preferences in sp. * * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} */ public static void clear(final boolean isCommit) { clear(isCommit, getDefaultSpUtils()); } /////////////////////////////////////////////////////////////////////////// // dividing line /////////////////////////////////////////////////////////////////////////// /** * Put the string value in sp. * * @param key The key of sp. * @param value The value of sp. * @param spUtils The instance of {@link SpUtils}. */ public static void put(@NonNull final String key, final String value, @NonNull final SpUtils spUtils) { spUtils.put(key, value); } /** * ä¸€æ¬¡æ€§æäº¤ * * @param map å­˜å‚¨é›†åˆ * @param spUtils The instance of {@link SpUtils}. */ public static void put(@NonNull final Map<String, Object> map, @NonNull final SpUtils spUtils) { spUtils.put(map); } /** * Put the string value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} * @param spUtils The instance of {@link SpUtils}. */ public static void put(@NonNull final String key, final String value, final boolean isCommit, @NonNull final SpUtils spUtils) { spUtils.put(key, value, isCommit); } /** * ä¸€æ¬¡æ€§æäº¤ * * @param map å­˜å‚¨é›†åˆ * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} * @param spUtils The instance of {@link SpUtils}. */ public static void put(@NonNull final Map<String, Object> map, final boolean isCommit, @NonNull final SpUtils spUtils) { spUtils.put(map, isCommit); } /** * Return the string value in sp. * * @param key The key of sp. * @param spUtils The instance of {@link SpUtils}. * @ return the string value if sp exists or {@code "" } otherwise */ public static String getString(@NonNull final String key, @NonNull final SpUtils spUtils) { return spUtils.getString(key); } /** * Return the string value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn 't exist. * @param spUtils The instance of {@link SpUtils}. * @return the string value if sp exists or {@code defaultValue} otherwise */ public static String getString(@NonNull final String key, final String defaultValue, @NonNull final SpUtils spUtils) { return spUtils.getString(key, defaultValue); } /** * Put the int value in sp. * * @param key The key of sp. * @param value The value of sp. * @param spUtils The instance of {@link SpUtils}. */ public static void put(@NonNull final String key, final int value, @NonNull final SpUtils spUtils) { spUtils.put(key, value); } /** * Put the int value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor#commit()}, * false to use {@link SharedPreferences.Editor#apply()} * @param spUtils The instance of {@link SpUtils}. */ public static void put(@NonNull final String key, final int value, final boolean isCommit, @NonNull final SpUtils spUtils) { spUtils.put(key, value, isCommit); } /** * Return the int value in sp. * * @param key The key of sp. * @param spUtils The instance of {@link SpUtils}. * @return the int value if sp exists or {@code -1} otherwise */ public static int getInt(@NonNull final String key, @NonNull final SpUtils spUtils) { return spUtils.getInt(key); } /** * Return the int value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn' t exist. * @param spUtils The instance of {@link SpUtils}. * @ return the int value if sp exists or {@code defaultValue} otherwise */ public static int getInt(@NonNull final String key, final int defaultValue, @NonNull final SpUtils spUtils) { return spUtils.getInt(key, defaultValue); } /** * Put the long value in sp. * * @param key The key of sp. * @param value The value of sp. * @param spUtils The instance of {@link SpUtils}. */ public static void put(@NonNull final String key, final long value, @NonNull final SpUtils spUtils) { spUtils.put(key, value); } /** * Put the long value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} * @param spUtils The instance of {@link SpUtils}. */ public static void put(@NonNull final String key, final long value, final boolean isCommit, @NonNull final SpUtils spUtils) { spUtils.put(key, value, isCommit); } /** * Return the long value in sp. * * @param key The key of sp. * @param spUtils The instance of {@link SpUtils}. * @ return the long value if sp exists or {@code -1} otherwise */ private static long getLong(@NonNull final String key, @NonNull final SpUtils spUtils) { return spUtils.getLong(key); } /** * Return the long value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn 't exist. * @param spUtils The instance of {@link SpUtils}. * @return the long value if sp exists or {@code defaultValue} otherwise */ private static long getLong(@NonNull final String key, final long defaultValue, @NonNull final SpUtils spUtils) { return spUtils.getLong(key, defaultValue); } /** * Put the float value in sp. * * @param key The key of sp. * @param value The value of sp. * @param spUtils The instance of {@link SpUtils}. */ public static void put(@NonNull final String key, final float value, @NonNull final SpUtils spUtils) { spUtils.put(key, value); } /** * Put the float value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor#commit()}, * false to use {@link SharedPreferences.Editor#apply()} * @param spUtils The instance of {@link SpUtils}. */ public static void put(@NonNull final String key, final float value, final boolean isCommit, @NonNull final SpUtils spUtils) { spUtils.put(key, value, isCommit); } /** * Return the float value in sp. * * @param key The key of sp. * @param spUtils The instance of {@link SpUtils}. * @return the float value if sp exists or {@code -1f} otherwise */ private static float getFloat(@NonNull final String key, @NonNull final SpUtils spUtils) { return spUtils.getFloat(key); } /** * Return the float value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn' t exist. * @param spUtils The instance of {@link SpUtils}. * @ return the float value if sp exists or {@code defaultValue} otherwise */ private static float getFloat(@NonNull final String key, final float defaultValue, @NonNull final SpUtils spUtils) { return spUtils.getFloat(key, defaultValue); } /** * Put the boolean value in sp. * * @param key The key of sp. * @param value The value of sp. * @param spUtils The instance of {@link SpUtils}. */ public static void put(@NonNull final String key, final boolean value, @NonNull final SpUtils spUtils) { spUtils.put(key, value); } /** * Put the boolean value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} * @param spUtils The instance of {@link SpUtils}. */ public static void put(@NonNull final String key, final boolean value, final boolean isCommit, @NonNull final SpUtils spUtils) { spUtils.put(key, value, isCommit); } /** * Return the boolean value in sp. * * @param key The key of sp. * @param spUtils The instance of {@link SpUtils}. * @ return the boolean value if sp exists or {@code false } otherwise */ public static boolean getBoolean(@NonNull final String key, @NonNull final SpUtils spUtils) { return spUtils.getBoolean(key); } /** * Return the boolean value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn 't exist. * @param spUtils The instance of {@link SpUtils}. * @return the boolean value if sp exists or {@code defaultValue} otherwise */ public static boolean getBoolean(@NonNull final String key, final boolean defaultValue, @NonNull final SpUtils spUtils) { return spUtils.getBoolean(key, defaultValue); } /** * Put the set of string value in sp. * * @param key The key of sp. * @param value The value of sp. * @param spUtils The instance of {@link SpUtils}. */ public static void put(@NonNull final String key, final Set<String> value, @NonNull final SpUtils spUtils) { spUtils.put(key, value); } /** * Put the set of string value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor#commit()}, * false to use {@link SharedPreferences.Editor#apply()} * @param spUtils The instance of {@link SpUtils}. */ public static void put(@NonNull final String key, final Set<String> value, final boolean isCommit, @NonNull final SpUtils spUtils) { spUtils.put(key, value, isCommit); } /** * Return the set of string value in sp. * * @param key The key of sp. * @param spUtils The instance of {@link SpUtils}. * @return the set of string value if sp exists * or {@code Collections.<String>emptySet()} otherwise */ private static Set<String> getStringSet(@NonNull final String key, @NonNull final SpUtils spUtils) { return spUtils.getStringSet(key); } /** * Return the set of string value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn' t exist. * @param spUtils The instance of {@link SpUtils}. * @ return the set of string value if sp exists or {@code defaultValue} otherwise */ private static Set<String> getStringSet(@NonNull final String key, final Set<String> defaultValue, @NonNull final SpUtils spUtils) { return spUtils.getStringSet(key, defaultValue); } /** * Return all values in sp. * * @param spUtils The instance of {@link SpUtils}. * @ return all values in sp */ private static Map<String, ?> getAll(@NonNull final SpUtils spUtils) { return spUtils.getAll(); } /** * Return whether the sp contains the preference. * * @param key The key of sp. * @param spUtils The instance of {@link SpUtils}. * @ return {@code true }: yes<br>{@code false }: no */ public static boolean contains(@NonNull final String key, @NonNull final SpUtils spUtils) { return spUtils.contains(key); } /** * Remove the preference in sp. * * @param key The key of sp. * @param spUtils The instance of {@link SpUtils}. */ public static void remove(@NonNull final String key, @NonNull final SpUtils spUtils) { spUtils.remove(key); } /** * Remove the preference in sp. * * @param key The key of sp. * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} * @param spUtils The instance of {@link SpUtils}. */ public static void remove(@NonNull final String key, final boolean isCommit, @NonNull final SpUtils spUtils) { spUtils.remove(key, isCommit); } /** * Remove all preferences in sp. * * @param spUtils The instance of {@link SpUtils}. */ public static void clear(@NonNull final SpUtils spUtils) { spUtils.clear(); } /** * Remove all preferences in sp. * * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} * @param spUtils The instance of {@link SpUtils}. */ public static void clear(final boolean isCommit, @NonNull final SpUtils spUtils) { spUtils.clear(isCommit); } /** * è·å–ç®€å•å­˜å‚¨å·¥å…·ç±» SpUtils * * @ return SpUtils */ private static SpUtils getDefaultSpUtils () { return sDefaultSpUtils != null ? sDefaultSpUtils : SpUtils.getInstance(getApplicationByReflect()); } /** * å¦‚æœä½ æ²¡æœ‰åˆå§‹åŒ–è¯¥å·¥å…·ç±»ï¼Œé‚£ä¹ˆæˆ‘ä¼šé€šè¿‡åå°„è·å–å½“å‰çš„applicationContext() * * @ return Application */ private static Application getApplicationByReflect () { try { @SuppressLint( "PrivateApi" ) Class<?> activityThread = Class.forName( "android.app.ActivityThread" ); Object thread = activityThread.getMethod( "currentActivityThread" ).invoke(null); Object app = activityThread.getMethod( "getApplication" ).invoke(thread); if (app == null) { throw new NullPointerException( "u should init first" ); } return (Application) app; } catch (NoSuchMethodException e) { e.printStackTrace(); } catch (IllegalAccessException e) { e.printStackTrace(); } catch (InvocationTargetException e) { e.printStackTrace(); } catch (ClassNotFoundException e) { e.printStackTrace(); } throw new NullPointerException( "u should init first" ); } } å¤åˆ¶ä»£ç ` ` public class SpUtils { private static final Map<String, SpUtils> SP_UTILS_MAP = new HashMap<>(); private SharedPreferences sp; /** * Return the single {@link SpUtils} instance * * @param context context * @ return the single {@link SpUtils} instance */ public static SpUtils getInstance(Context context) { return getInstance(context, "" , Context.MODE_PRIVATE); } /** * Return the single {@link SpUtils} instance * * @param context context * @param mode Operating mode. * @ return the single {@link SpUtils} instance */ public static SpUtils getInstance(Context context, final int mode) { return getInstance(context, "" , mode); } /** * Return the single {@link SpUtils} instance * * @param context context * @param spName The name of sp. * @ return the single {@link SpUtils} instance */ public static SpUtils getInstance(Context context, String spName) { return getInstance(context, spName, Context.MODE_PRIVATE); } /** * Return the single {@link SpUtils} instance * * @param context context * @param spName The name of sp. * @param mode Operating mode. * @ return the single {@link SpUtils} instance */ public static SpUtils getInstance(Context context, String spName, final int mode) { if (context == null) { throw new UnsupportedOperationException( "context can't empty, please init me in SpHelpUtils.class" ); } if (isSpace(spName)) { spName = context.getPackageName() + "_preferences" ; } SpUtils spUtils = SP_UTILS_MAP.get(spName); if (spUtils == null) { synchronized (SpUtils.class) { spUtils = SP_UTILS_MAP.get(spName); if (spUtils == null) { spUtils = new SpUtils(context, spName, mode); SP_UTILS_MAP.put(spName, spUtils); } } } return spUtils; } private SpUtils(Context context, final String spName) { sp = context.getSharedPreferences(spName, Context.MODE_PRIVATE); } private SpUtils(final Context context, final String spName, final int mode) { sp = context.getSharedPreferences(spName, mode); } /** * Put the string value in sp. * * @param key The key of sp. * @param value The value of sp. */ public void put(@NonNull final String key, final String value) { // TODO ç”±äºé¡¹ç›®çš„åŠŸèƒ½éœ€æ±‚ï¼Œè¿™ä¸ªåœ°æ–¹æ ‡å¿—ä½ç»Ÿä¸€æ”¹ä¸ºèµ°commitæ–¹å¼,åæœŸéœ€è¦é€ä¸€ä¼˜åŒ–æˆapply put(key, value, true ); } /** * æäº¤Mapç»“åˆï¼Œç”¨äºä¸€æ¬¡æ€§çš„commitæˆ–è€…applyï¼Œå‡å°‘å¹³å‡¡è¯»å†™IO * * @param map å­˜å‚¨é›†åˆ */ public void put(@NonNull final Map<String, Object> map) { put(map, true ); } /** * Put the string value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} */ public void put(@NonNull final String key, final String value, final boolean isCommit) { if (isCommit) { sp.edit().putString(key, value).commit(); } else { sp.edit().putString(key, value).apply(); } } /** * @param map å­˜å‚¨é›†åˆ * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} */ public void put(@NonNull final Map<String, Object> map, final boolean isCommit) { SharedPreferences.Editor edit = sp.edit(); for (Map.Entry<String, Object> next : map.entrySet()) { if (next.getValue() instanceof String) { edit.putString(next.getKey(), String.valueOf(next.getValue())); } else if (next.getValue() instanceof Boolean) { edit.putBoolean(next.getKey(), (Boolean) next.getValue()); } else if (next.getValue() instanceof Integer) { edit.putInt(next.getKey(), (Integer) next.getValue()); } else if (next.getValue() instanceof Float) { edit.putFloat(next.getKey(), (Float) next.getValue()); } else if (next.getValue() instanceof Long) { edit.putLong(next.getKey(), (Long) next.getValue()); } else { throw new UnsupportedOperationException( "parameter Unsupported type!" ); } } if (isCommit) { edit.commit(); } else { edit.apply(); } } /** * Return the string value in sp. * * @param key The key of sp. * @ return the string value if sp exists or {@code "" } otherwise */ public String getString(@NonNull final String key) { return getString(key, "" ); } /** * Return the string value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn 't exist. * @return the string value if sp exists or {@code defaultValue} otherwise */ public String getString(@NonNull final String key, final String defaultValue) { return sp.getString(key, defaultValue); } /** * Put the int value in sp. * * @param key The key of sp. * @param value The value of sp. */ public void put(@NonNull final String key, final int value) { put(key, value, false); } /** * Put the int value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor#commit()}, * false to use {@link SharedPreferences.Editor#apply()} */ public void put(@NonNull final String key, final int value, final boolean isCommit) { if (isCommit) { sp.edit().putInt(key, value).commit(); } else { sp.edit().putInt(key, value).apply(); } } /** * Return the int value in sp. * * @param key The key of sp. * @return the int value if sp exists or {@code -1} otherwise */ public int getInt(@NonNull final String key) { return getInt(key, -1); } /** * Return the int value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn' t exist. * @ return the int value if sp exists or {@code defaultValue} otherwise */ public int getInt(@NonNull final String key, final int defaultValue) { return sp.getInt(key, defaultValue); } /** * Put the long value in sp. * * @param key The key of sp. * @param value The value of sp. */ public void put(@NonNull final String key, final long value) { put(key, value, false ); } /** * Put the long value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} */ public void put(@NonNull final String key, final long value, final boolean isCommit) { if (isCommit) { sp.edit().putLong(key, value).commit(); } else { sp.edit().putLong(key, value).apply(); } } /** * Return the long value in sp. * * @param key The key of sp. * @ return the long value if sp exists or {@code -1} otherwise */ public long getLong(@NonNull final String key) { return getLong(key, -1L); } /** * Return the long value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn 't exist. * @return the long value if sp exists or {@code defaultValue} otherwise */ public long getLong(@NonNull final String key, final long defaultValue) { return sp.getLong(key, defaultValue); } /** * Put the float value in sp. * * @param key The key of sp. * @param value The value of sp. */ public void put(@NonNull final String key, final float value) { put(key, value, false); } /** * Put the float value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor#commit()}, * false to use {@link SharedPreferences.Editor#apply()} */ public void put(@NonNull final String key, final float value, final boolean isCommit) { if (isCommit) { sp.edit().putFloat(key, value).commit(); } else { sp.edit().putFloat(key, value).apply(); } } /** * Return the float value in sp. * * @param key The key of sp. * @return the float value if sp exists or {@code -1f} otherwise */ public float getFloat(@NonNull final String key) { return getFloat(key, -1f); } /** * Return the float value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn' t exist. * @ return the float value if sp exists or {@code defaultValue} otherwise */ public float getFloat(@NonNull final String key, final float defaultValue) { return sp.getFloat(key, defaultValue); } /** * Put the boolean value in sp. * * @param key The key of sp. * @param value The value of sp. */ public void put(@NonNull final String key, final boolean value) { put(key, value, false ); } /** * Put the boolean value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} */ public void put(@NonNull final String key, final boolean value, final boolean isCommit) { if (isCommit) { sp.edit().putBoolean(key, value).commit(); } else { sp.edit().putBoolean(key, value).apply(); } } /** * Return the boolean value in sp. * * @param key The key of sp. * @ return the boolean value if sp exists or {@code false } otherwise */ public boolean getBoolean(@NonNull final String key) { return getBoolean(key, false ); } /** * Return the boolean value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn 't exist. * @return the boolean value if sp exists or {@code defaultValue} otherwise */ public boolean getBoolean(@NonNull final String key, final boolean defaultValue) { return sp.getBoolean(key, defaultValue); } /** * Put the set of string value in sp. * * @param key The key of sp. * @param value The value of sp. */ public void put(@NonNull final String key, final Set<String> value) { put(key, value, false); } /** * Put the set of string value in sp. * * @param key The key of sp. * @param value The value of sp. * @param isCommit True to use {@link SharedPreferences.Editor#commit()}, * false to use {@link SharedPreferences.Editor#apply()} */ public void put(@NonNull final String key, final Set<String> value, final boolean isCommit) { if (isCommit) { sp.edit().putStringSet(key, value).commit(); } else { sp.edit().putStringSet(key, value).apply(); } } /** * Return the set of string value in sp. * * @param key The key of sp. * @return the set of string value if sp exists * or {@code Collections.<String>emptySet()} otherwise */ public Set<String> getStringSet(@NonNull final String key) { return getStringSet(key, Collections.emptySet()); } /** * Return the set of string value in sp. * * @param key The key of sp. * @param defaultValue The default value if the sp doesn' t exist. * @ return the set of string value if sp exists or {@code defaultValue} otherwise */ public Set<String> getStringSet(@NonNull final String key, final Set<String> defaultValue) { return sp.getStringSet(key, defaultValue); } /** * Return all values in sp. * * @ return all values in sp */ public Map<String, ?> getAll () { return sp.getAll(); } /** * Return whether the sp contains the preference. * * @param key The key of sp. * @ return {@code true }: yes<br>{@code false }: no */ public boolean contains(@NonNull final String key) { return sp.contains(key); } /** * Remove the preference in sp. * * @param key The key of sp. */ public void remove(@NonNull final String key) { remove(key, false ); } /** * Remove the preference in sp. * * @param key The key of sp. * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} */ public void remove(@NonNull final String key, final boolean isCommit) { if (isCommit) { sp.edit().remove(key).commit(); } else { sp.edit().remove(key).apply(); } } /** * Remove all preferences in sp. */ public void clear () { clear( false ); } /** * Remove all preferences in sp. * * @param isCommit True to use {@link SharedPreferences.Editor #commit()}, * false to use {@link SharedPreferences.Editor #apply()} */ public void clear(final boolean isCommit) { if (isCommit) { sp.edit().clear().commit(); } else { sp.edit().clear().apply(); } } private static boolean isSpace(final String s) { if (s == null) { return true ; } for (int i = 0, len = s.length(); i < len; ++i) { if (!Character.isWhitespace(s.charAt(i))) { return false ; } } return true ; } } å¤åˆ¶ä»£ç `

## å†™åœ¨æœ€å ##

æ„Ÿè°¢å„ä½å¤§ä½¬çš„é˜…è¯»ï¼Œå¦‚æœå­˜åœ¨ä¸è¶³çš„åœ°æ–¹æˆ–è€…æœ‰æ›´å¥½çš„å»ºè®®ï¼Œè¯·ç•™è¨€å›å¤ï¼Œæˆ‘ä¼šå°½é‡æŠŠæ–‡ç« çš„è´¨é‡åšåˆ°æ›´å¥½ä»¥åˆ†äº«ç»™æ›´å¤šçš„è¯»è€…ï¼Œè°¢è°¢ï¼