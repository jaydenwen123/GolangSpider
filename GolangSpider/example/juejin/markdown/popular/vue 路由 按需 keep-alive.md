# vue è·¯ç”± æŒ‰éœ€ keep-alive #

![banner](https://user-gold-cdn.xitu.io/2019/5/19/16acfee7031de2c7?imageslim)

# situation #

ä¸€ä¸ªå¸¸è§çš„çš„åœºæ™¯ï¼Œ

ä¸»é¡µ --> å‰è¿› åˆ—è¡¨é¡µ --> å‰è¿› è¯¦æƒ…é¡µï¼Œè¯¦æƒ…é¡µ --> è¿”å› ä¸»é¡µ --> è¿”å› åˆ—è¡¨é¡µ

æˆ‘ä»¬å¸Œæœ›ï¼Œ

ä» è¯¦æƒ…é¡µ --> è¿”å› åˆ—è¡¨é¡µ çš„æ—¶å€™é¡µé¢çš„çŠ¶æ€æ˜¯ç¼“å­˜ï¼Œä¸ç”¨é‡æ–°è¯·æ±‚æ•°æ®ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚

ä» åˆ—è¡¨é¡µ --> è¿”å› ä¸»é¡µ çš„æ—¶å€™é¡µé¢ï¼Œæ³¨é”€æ‰åˆ—è¡¨é¡µï¼Œä»¥åœ¨è¿›å…¥ä¸åŒçš„åˆ—è¡¨é¡µçš„æ—¶å€™ï¼Œè·å–æœ€æ–°çš„æ•°æ®ã€‚

# task #

ä»Šå¤© è®©æˆ‘ä»¬æ¥å®ç°è¿™ä¸ªéœ€æ±‚ã€‚

åœ¨ ä»£ç çš„ä¸–ç•Œé‡Œ è§£å†³é—®é¢˜çš„ æ–¹æ³• ä»æ¥éƒ½ä¸æ­¢ä¸€ç§ã€‚

æ¯”å¦‚ï¼Œä»æ•°ç»„ä¸­æ‰¾åˆ°ä¸€ä¸ªçš„å€¼ç´¢å¼•ï¼š

å¯ä»¥ç”¨æœ€åŸºç¡€çš„ forå¾ªç¯ éå†ï¼Œä¹Ÿå¯ä»¥ç”¨indexOfè¿™ç§å·¥å…·å‡½æ•°ï¼Œè¿˜å¯ä»¥ç”¨findIndex forEachç­‰æ›´è¯­ä¹‰åŒ–çš„é«˜é˜¶å‡½æ•°æ¥éå†ã€‚

æˆ‘å‚è€ƒäº†å¤§é‡çš„æ–‡ç« ï¼Œçˆ¬äº†å®˜æ–¹çš„æ–‡æ¡£ï¼Œä¹‹åï¼Œæ‰¾åˆ°äº†å¥½å‡ ç§åŠæ³•ï¼Œä¸‹é¢ï¼Œè®©æˆ‘ä»¬æ¥ä¸€ä¸ªä¸ªåˆ†æã€‚

**let's begin** ï¼Œ æˆ‘ä»¬å¼€å§‹å§ã€‚ğŸ™Œ

* 

è§£å†³æ‰æéœ€æ±‚çš„äºº

ğŸ˜‚ emm... ï¼Œç›¸å¯¹äºæˆ‘ä»¬çš„äººç”Ÿï¼Œå¯èƒ½ä»£ç ä¼šæ›´å¥½æŒæ§å§ã€‚

> 
> 
> 
> ç¨‹åºå‘˜æ´»åœ¨è‡ªå·±æƒ³è±¡çš„ç‹å›½é‡Œ
> 
> 
> 
> æˆ‘åˆšæ¥è§¦ç”µè„‘å°±å‘ç°ç”µè„‘çš„å¦™å¤„ï¼Œç”µè„‘è¿œæ²¡æœ‰äººé‚£ä¹ˆå¤æ‚ã€‚å¦‚æœä½ çš„ç¨‹åºå†™å¾—å¥½ï¼Œä½ å°±å¯ä»¥å’Œç”µè„‘å¤„å¥½å…³ç³»ï¼Œå°±å¯ä»¥æŒ‡æŒ¥ç”µè„‘å¹²ä½ 
> æƒ³å¹²çš„äº‹ã€‚è¿™ä¸ªæ—¶å€™ä½ æ˜¯åè¶³çš„ä¸»å®°ã€‚ æ¯æ¯ä½ ååœ¨ç”µè„‘é¢å‰ï¼Œä½ å°±æ˜¯åœ¨ä½ çš„ç‹å›½é‡Œå·¡è¡Œï¼Œè¿™æ ·çš„æ—¥å­ç®€ç›´å°±æ˜¯å¤©å ‚èˆ¬çš„æ—¥å­ã€‚
> ç”µè„‘é‡Œçš„ä¸–ç•Œå¾ˆå¤§ï¼Œç¼–ç¨‹äººæ˜¯æ´»åœ¨è‡ªå·±æƒ³è±¡çš„ç‹å›½é‡Œã€‚ä½ å¯ä»¥æƒ³è±¡åˆ°ç”µè„‘é‡Œç»†å¾®åˆ°æ¯ä¸€ä¸ªå­—èŠ‚ã€æ¯ä¸€ä¸ªæ¯”ç‰¹çš„ä¸œè¥¿ã€‚
> 
> 

> 
> 
> 
> -- é›·å†›(æ²¡é”™å°±æ˜¯å°ç±³é‚£ä¸ªé›·å†›)
> 
> 

æˆ‘å¾ˆè®¤åŒé›·å†›çš„è¯´æ³•ï¼Œ

äººç”Ÿèƒ½æ‰¾åˆ°ä¸€ä¸ª çƒ­çˆ± çš„ä¸œè¥¿å¾ˆéš¾å¾—ï¼Œä½  çƒ­çˆ±ä»£ç  å¹¶ ä¸“æ³¨äºå®ƒçš„è¯ï¼Œ

ç»ˆæœ‰ä¸€å¤©ï¼Œ

å®ƒä¼šä»¥å„ç§å„æ ·çš„æ–¹å¼å›æŠ¥ç»™ä½ ï¼šå·¥èµ„ï¼Œè®¤åŒæ„Ÿï¼Œæˆå°±æ„Ÿï¼Œå’Œä½ ä¸€èµ·è¿›æ­¥ï¼Œå¿ƒé‡Œå…±é¸£çš„äººã€‚

ä½ è‹¥ç››å¼€ï¼Œè´è¶è‡ªæ¥ã€‚è¯¸å›å…±å‹‰ (èƒ½éª—ä¸€ä¸ªç›¸ä¿¡ï¼Œå°±å°‘ä¸€ä¸ªæ²™é›•å’Œæˆ‘æŠ¢å¦¹å­ğŸ¤£)

![æ²™é›•](https://user-gold-cdn.xitu.io/2019/5/19/16acfef91567de63?imageslim)

* 

ç¡æœâ™‚æéœ€æ±‚çš„äºº

ğŸ˜‚emm..., çœ‹ç€é•œå­é‡Œé‚£å¼ çš„è„¸ï¼Œè¿™è¾ˆå­åº”è¯¥æ˜¯æ²¡åŠæ³•ä»è„¸ä¸Šå¾—åˆ°ä»»ä½•çš„ä¾¿åˆ©äº†...

![å¯Œå©†](https://user-gold-cdn.xitu.io/2019/5/19/16acff5d30ff80d6?imageView2/0/w/1280/h/960/ignore-error/1)

* 

keep-alive

` keep-alive` æ˜¯ ` Vue` æä¾›çš„ä¸€ä¸ªæŠ½è±¡ç»„ä»¶ï¼Œä¸»è¦ç”¨äºä¿ç•™ç»„ä»¶çŠ¶æ€æˆ–é¿å…é‡æ–°æ¸²æŸ“ã€‚

![](https://user-gold-cdn.xitu.io/2019/5/19/16acff709701145a?imageView2/0/w/1280/h/960/ignore-error/1)

ä½†æ˜¯ ` keep-alive` ä¼šæŠŠå…¶åŒ…è£¹çš„æ‰€æœ‰ç»„ä»¶éƒ½ç¼“å­˜èµ·æ¥ã€‚

# action #

æˆ‘ä»¬æŠŠéœ€æ±‚åˆ†è§£æˆ2æ­¥æ¥å®ç°

## 1.æŠŠéœ€è¦ç¼“å­˜å’Œä¸éœ€è¦ç¼“å­˜çš„è§†å›¾ç»„ä»¶åŒºåˆ†å¼€ ##

æ€è·¯å¦‚ä¸‹å›¾:

![routeråŒºåˆ†](https://user-gold-cdn.xitu.io/2019/5/19/16acffc9192eb757?imageView2/0/w/1280/h/960/ignore-error/1)

* å†™2ä¸ª ` router-view` å‡ºå£
` < keep-alive > <!-- éœ€è¦ç¼“å­˜çš„è§†å›¾ç»„ä»¶ --> < router-view v-if = "$route.meta.keepAlive" > </ router-view > </ keep-alive > <!-- ä¸éœ€è¦ç¼“å­˜çš„è§†å›¾ç»„ä»¶ --> < router-view v-if = "!$route.meta.keepAlive" > </ router-view > å¤åˆ¶ä»£ç ` * åœ¨ ` Router` é‡Œå®šä¹‰å¥½éœ€è¦ç¼“å­˜çš„è§†å›¾ç»„ä»¶
` new Router({ routes : [ { path : '/' , name : 'index' , component : () => import ( './views/keep-alive/index.vue' ), meta : { deepth : 0.5 } }, { path : '/list' , name : 'list' , component : () => import ( './views/keep-alive/list.vue' ), meta : { deepth : 1 keepAlive: true //éœ€è¦è¢«ç¼“å­˜ } }, { path : '/detail' , name : 'detail' , component : () => import ( './views/keep-alive/detail.vue' ), meta : { deepth : 2 } } ] }) å¤åˆ¶ä»£ç `

## 2.æŒ‰éœ€keep-alive ##

![keep-alive](https://user-gold-cdn.xitu.io/2019/5/19/16ad00649bb73773?imageView2/0/w/1280/h/960/ignore-error/1)

![include](https://user-gold-cdn.xitu.io/2019/5/19/16ad008732ddf825?imageView2/0/w/1280/h/960/ignore-error/1)

æˆ‘ä»¬ä»å®˜æ–¹æ–‡æ¡£æä¾›çš„apiå…¥æ‰‹,

` keep-alive` ç»„ä»¶å¦‚æœè®¾ç½®äº† ` include` ï¼Œå°±åªæœ‰å’Œ ` include` åŒ¹é…çš„ç»„ä»¶ä¼šè¢«ç¼“å­˜ï¼Œ

æ‰€ä»¥æ€è·¯å°±æ˜¯ï¼ŒåŠ¨æ€ä¿®æ”¹ ` include` æ•°ç»„æ¥å®ç°æŒ‰éœ€ç¼“å­˜ã€‚

![include](https://user-gold-cdn.xitu.io/2019/5/19/16ad009cfdc4879b?imageView2/0/w/1280/h/960/ignore-error/1)

` < keep-alive :include = "include" > <!-- éœ€è¦ç¼“å­˜çš„è§†å›¾ç»„ä»¶ --> < router-view v-if = "$route.meta.keepAlive" > </ router-view > </ keep-alive > <!-- ä¸éœ€è¦ç¼“å­˜çš„è§†å›¾ç»„ä»¶ --> < router-view v-if = "!$route.meta.keepAlive" > </ router-view > å¤åˆ¶ä»£ç `

è®©æˆ‘ä»¬åœ¨app.vueé‡Œç›‘å¬è·¯ç”±çš„å˜åŒ–,

` export default { name : "app" , data : () => ({ include : [] }), watch : { $route(to, from ) { //å¦‚æœ è¦ to(è¿›å…¥) çš„é¡µé¢æ˜¯éœ€è¦ keepAlive ç¼“å­˜çš„ï¼ŒæŠŠ name push è¿› includeæ•°ç»„ if (to.meta.keepAlive) { ! this.include.includes(to.name) && this.include.push(to.name); } //å¦‚æœ è¦ form(ç¦»å¼€) çš„é¡µé¢æ˜¯ keepAliveç¼“å­˜çš„ï¼Œ //å†æ ¹æ® deepth æ¥åˆ¤æ–­æ˜¯å‰è¿›è¿˜æ˜¯åé€€ //å¦‚æœæ˜¯åé€€ if ( from.meta.keepAlive && to.meta.deepth < from.meta.deepth) { var index = this.include.indexOf( from.name); index !== -1 && this.include.splice(index, 1 ); } } } }; å¤åˆ¶ä»£ç `

éœ€è¦æ³¨æ„çš„æ˜¯

![](https://user-gold-cdn.xitu.io/2019/5/19/16ad018aed5b0a02?imageView2/0/w/1280/h/960/ignore-error/1) ` keep-alive` éœ€è¦å…¶åŒ…è£¹çš„ç»„ä»¶æœ‰nameå±æ€§ï¼Œ

æˆ‘ä»¬ä¸Šé¢çš„ä»£ç ä¸­çš„ ` push` å’Œ ` splice` çš„æ˜¯ ` router` çš„ ` name` ã€‚

æ‰€ä»¥å»ºè®®å¤§å®¶æŠŠ ` route` çš„ ` name` å±æ€§è®¾ç½®å’Œ ` route` å¯¹åº” ` component` çš„ ` name` è®¾æˆä¸€æ ·çš„ã€‚

![å°±æ˜¯è¿™ä¸ªæ„æ€](https://user-gold-cdn.xitu.io/2019/5/19/16ad01ec0d57e21d?imageView2/0/w/1280/h/960/ignore-error/1)

# result #

è®©æˆ‘ä»¬éªŒè¯ä¸€ä¸‹æˆ‘ä»¬çš„æˆæœ

![banner](https://user-gold-cdn.xitu.io/2019/5/19/16acfee7031de2c7?imageslim)

![](https://user-gold-cdn.xitu.io/2019/5/19/16ad0240ea84a2e8?imageView2/0/w/1280/h/960/ignore-error/1)

åœ¨ [vue-devtool]( https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fvue-devtools ) é‡Œï¼Œç°è‰²çš„ç»„ä»¶ï¼Œä»£è¡¨æ˜¯ç¼“å­˜çŠ¶æ€çš„ç»„ä»¶ï¼Œæ³¨æ„è§‚å¯Ÿ ` list` çš„å˜åŒ–ã€‚

# å†™åœ¨æœ€å #

* å®ç°æŒ‰éœ€ ` keep-alive` ï¼Œç½‘ä¸Šæœ‰æ–¹æ³•ï¼Œé€šè¿‡ä¿®æ”¹ ` route` é…ç½®é‡Œçš„ ` meta` é‡Œçš„ ` keepAlive` å€¼æ¥å®ç°ã€‚

![](https://user-gold-cdn.xitu.io/2019/5/19/16ad02b3cd17da4f?imageView2/0/w/1280/h/960/ignore-error/1)

ç›´æ¥ä¿®æ”¹ ` meta` çš„å€¼ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸Šå›¾çš„æƒ…å†µï¼Œkeep-aliveé‡Œæœ‰ä¸€ç›´æœ‰ä¸€ä¸ªç¼“å­˜çš„ list,æ­£å¸¸çš„ ` rotuer-view` é‡Œä¹Ÿæœ‰ä¸€ä¸ª,

å¤ç°è¿™ä¸ªé—®é¢˜éœ€è¦å¾ˆé•¿å¾—ç¯‡å¹…ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªå·±å»çˆ¬ä¸€ä¸‹å‘ã€‚

* è¿˜æœ‰å¾—æ–¹æ³•æ˜¯ é€šè¿‡åœ¨keep-alive çš„è§†å›¾ç»„ä»¶åœ¨é€€å‡º rotuer çš„æ—¶å€™ï¼Œè°ƒç”¨this.$destory() ç›´æ¥æ‘§æ¯ç»„ä»¶ï¼Œè¿™ä¼šå¯¼è‡´ç»„ä»¶æ²¡æ³•åœ¨ç¼“å­˜ï¼Œè¿™ä¸ªbug ï¼Œåœ¨å®˜æ–¹issueæœ‰æåˆ°ã€‚

# å‚è€ƒèµ„æ–™ #

> 
> 
> 
> [å®˜æ–¹issue](
> https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fvue%2Fissues%2F6509
> )
> 
> 

> 
> 
> 
> [Vueé¡¹ç›®å…¨å±€é…ç½®é¡µé¢ç¼“å­˜ï¼Œå®ç°æŒ‰éœ€è¯»å–ç¼“å­˜
> ]( https://juejin.im/post/5b5eb85d6fb9a04fb745e8f8
> )
> 
> 

# å…³äºåŠ¨ç”» #

è°¢è°¢å¤§å®¶çš„ç‚¹èµå’Œå›å¤ï¼Œæˆ‘çœ‹å¥½å¤šäººæƒ³è¦demoçš„æºç è¿™é‡Œåˆ†äº«ä¸€ä¸‹ã€‚

å› ä¸ºæˆ‘å…¬å¸ç›®å‰è¿˜æ²¡æœ‰,vueçš„é¡¹ç›®ç»™æˆ‘æ–½å±•æ‹³è„šã€‚æˆ‘å½“æ—¶å†™demoçš„æ—¶å€™ï¼Œæƒ³çš„ä¹Ÿä¸æ˜¯åŠ¨ç”»æ–¹é¢çš„å°è£…å’Œä¼˜åŒ–ï¼Œ

æ‰€ä»¥åˆ†äº«çš„demoé‡Œçš„ä»£ç é‡Œï¼Œå…³äºåŠ¨ç”»ï¼Œä¼šæœ‰å¾ˆå¤šé‡å¤çš„ä»£ç å’Œä¸‘é™‹çš„å®ç°ã€‚è¿˜è¯·å¤šè§è°…

[æºç é“¾æ¥]( https://link.juejin.im?target=https%3A%2F%2Fshare.weiyun.com%2F5XiSQDy )

å…³äºdemoåŠ¨ç”»çš„ä¸€äº›åˆ†æï¼Œå¯ä»¥çœ‹æˆ‘çš„å‰2ç¯‡æ–‡ç« 